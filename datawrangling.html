<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Data Wrangling | R Cookbook for reproducible social science</title>
  <meta name="description" content="This page contains tips to make your R code reproducible." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Data Wrangling | R Cookbook for reproducible social science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains tips to make your R code reproducible." />
  <meta name="github-repo" content="kleuveld/r_cheatsheet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Wrangling | R Cookbook for reproducible social science" />
  
  <meta name="twitter:description" content="This page contains tips to make your R code reproducible." />
  

<meta name="author" content="Koen" />


<meta name="date" content="2025-11-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="programming.html"/>
<link rel="next" href="reporting.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Cheat Sheet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i>Setting up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html"><i class="fa fa-check"></i>Reproducible Workflows</a>
<ul>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#projects"><i class="fa fa-check"></i>Projects</a>
<ul>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#here"><i class="fa fa-check"></i>Here</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#using-machine-specific-paths"><i class="fa fa-check"></i>Using machine-specific paths</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#renv"><i class="fa fa-check"></i>renv</a>
<ul>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#starting-a-project-with-renv"><i class="fa fa-check"></i>Starting a project with Renv</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#installing-new-pacakges-with-renv"><i class="fa fa-check"></i>Installing new Pacakges with Renv</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#restoring-a-project"><i class="fa fa-check"></i>Restoring a project</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i>Programming with R</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#loops"><i class="fa fa-check"></i>Loops</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#basic-functions"><i class="fa fa-check"></i>Basic Functions</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions-and-the-tidyverse"><i class="fa fa-check"></i>Functions and the tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#map"><i class="fa fa-check"></i>Map()</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#making-functions-re-usable-with-box"><i class="fa fa-check"></i>Making functions re-usable with box</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i>Data Wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#basic-data-manipulation"><i class="fa fa-check"></i>Basic Data Manipulation</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-or-reshaping"><i class="fa fa-check"></i>Pivoting (or reshaping)</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#creating-fake-data"><i class="fa fa-check"></i>Creating fake data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-long-to-wide"><i class="fa fa-check"></i>Pivoting long to wide</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-wide-to-long"><i class="fa fa-check"></i>Pivoting wide to long</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#joining-or-merging-data"><i class="fa fa-check"></i>Joining (or merging) data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#summarizing-over-groups-or-collapsing-data"><i class="fa fa-check"></i>Summarizing over groups (or collapsing data)</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#row-wise-operations"><i class="fa fa-check"></i>Row-wise Operations</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#across-doing-the-same-operations-on-multiple-variables-using-across"><i class="fa fa-check"></i>across(): doing the same operations on multiple variables using across</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#c_across-passing-values-from-multiple-variables-to-summarizing-functions"><i class="fa fa-check"></i>c_across(): passing values from multiple variables to summarizing functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#seperate_longer"><i class="fa fa-check"></i>Splitting multi-response variable into dummies</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#renaming-many-variables"><i class="fa fa-check"></i>Renaming many variables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i>Estimating and reporting</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#generating-some-fake-data"><i class="fa fa-check"></i>Generating some fake data</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#making-a-table-of-summary-statistics"><i class="fa fa-check"></i>Making a table of summary statistics</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#using-modelsummary-and-flextable"><i class="fa fa-check"></i>Using modelsummary and flextable</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#balance-table"><i class="fa fa-check"></i>Balance Table</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#advanced-using-only-flextable"><i class="fa fa-check"></i>Advanced: Using only Flextable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#simple-regression"><i class="fa fa-check"></i>Simple regression</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#robust-standard-errors"><i class="fa fa-check"></i>Robust standard errors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i>Plotting using ggplot</a>
<ul>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#introduction-2"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#scatter-plot"><i class="fa fa-check"></i>Scatter plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#bar-chart"><i class="fa fa-check"></i>Bar chart</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#faceting"><i class="fa fa-check"></i>Faceting</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#stacked-wur"><i class="fa fa-check"></i>Stacked bar chart with WUR template and observation counts</a>
<ul>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#as-a-re-usable-function"><i class="fa fa-check"></i>As a re-usable function</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#ordering-of-labels"><i class="fa fa-check"></i>Ordering of labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#lollipop-plot"><i class="fa fa-check"></i>Lollipop plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#maps"><i class="fa fa-check"></i>Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html"><i class="fa fa-check"></i>Power Analysis using DeclareDesign</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#simple-power-calculation"><i class="fa fa-check"></i>Simple Power Calculation</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#loading-data"><i class="fa fa-check"></i>Loading data</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#diagnosing-design-and-calculating-power"><i class="fa fa-check"></i>Diagnosing Design and calculating power</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#dif-in-diff"><i class="fa fa-check"></i>Dif in diff</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#propsensity-score-matching"><i class="fa fa-check"></i>Propsensity score matching</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design-1"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#checking-balance"><i class="fa fa-check"></i>Checking balance</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#bias"><i class="fa fa-check"></i>Bias</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#power"><i class="fa fa-check"></i>Power</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Cookbook for reproducible social science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datawrangling" class="section level1 hasAnchor">
<h1>Data Wrangling<a href="datawrangling.html#datawrangling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Make sure you have the <code>tidyverse</code> installed, and the SAFI data set
downloaded to your data folder by running the code from the <a href="index.html#setup">Set-up section</a></p>
<div id="basic-data-manipulation" class="section level2 hasAnchor">
<h2>Basic Data Manipulation<a href="datawrangling.html#basic-data-manipulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="datawrangling.html#cb49-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb49-2"><a href="datawrangling.html#cb49-2" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb49-3"><a href="datawrangling.html#cb49-3" tabindex="-1"></a></span>
<span id="cb49-4"><a href="datawrangling.html#cb49-4" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-5"><a href="datawrangling.html#cb49-5" tabindex="-1"></a>    <span class="fu">filter</span>(village <span class="sc">==</span> <span class="st">&quot;Chirodzo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="datawrangling.html#cb49-6" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">people_per_room =</span> no_membrs <span class="sc">/</span> rooms,</span>
<span id="cb49-7"><a href="datawrangling.html#cb49-7" tabindex="-1"></a>           <span class="at">years_liv =</span> <span class="fu">if_else</span>(years_liv <span class="sc">&gt;</span> <span class="dv">90</span>, <span class="cn">NA</span>, years_liv),</span>
<span id="cb49-8"><a href="datawrangling.html#cb49-8" tabindex="-1"></a>           <span class="at">respondent_wall_type =</span> <span class="fu">as_factor</span>(respondent_wall_type),</span>
<span id="cb49-9"><a href="datawrangling.html#cb49-9" tabindex="-1"></a>           <span class="at">respondent_wall_type =</span> <span class="fu">fct_recode</span>(respondent_wall_type, </span>
<span id="cb49-10"><a href="datawrangling.html#cb49-10" tabindex="-1"></a>                                             <span class="st">&quot;Burned bricks&quot;</span> <span class="ot">=</span> <span class="st">&quot;burntbricks&quot;</span>,</span>
<span id="cb49-11"><a href="datawrangling.html#cb49-11" tabindex="-1"></a>                                             <span class="st">&quot;Mud Daub&quot;</span> <span class="ot">=</span> <span class="st">&quot;muddaub&quot;</span>,</span>
<span id="cb49-12"><a href="datawrangling.html#cb49-12" tabindex="-1"></a>                                             <span class="st">&quot;Sun bricks&quot;</span> <span class="ot">=</span> <span class="st">&quot;sunbricks&quot;</span>),</span>
<span id="cb49-13"><a href="datawrangling.html#cb49-13" tabindex="-1"></a>           <span class="at">conflict_yn =</span> <span class="fu">case_when</span>(affect_conflicts <span class="sc">==</span> <span class="st">&quot;frequently&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb49-14"><a href="datawrangling.html#cb49-14" tabindex="-1"></a>                                   affect_conflicts <span class="sc">==</span> <span class="st">&quot;more_once&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb49-15"><a href="datawrangling.html#cb49-15" tabindex="-1"></a>                                   affect_conflicts <span class="sc">==</span> <span class="st">&quot;once&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb49-16"><a href="datawrangling.html#cb49-16" tabindex="-1"></a>                                   affect_conflicts <span class="sc">==</span> <span class="st">&quot;never&quot;</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb49-17"><a href="datawrangling.html#cb49-17" tabindex="-1"></a>                                   <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb49-18"><a href="datawrangling.html#cb49-18" tabindex="-1"></a>           <span class="at">day =</span> <span class="fu">day</span>(interview_date),</span>
<span id="cb49-19"><a href="datawrangling.html#cb49-19" tabindex="-1"></a>           <span class="at">month =</span> <span class="fu">month</span>(interview_date),</span>
<span id="cb49-20"><a href="datawrangling.html#cb49-20" tabindex="-1"></a>           <span class="at">year =</span> <span class="fu">year</span>(interview_date)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-21"><a href="datawrangling.html#cb49-21" tabindex="-1"></a>    <span class="fu">select</span>(key_ID<span class="sc">:</span>rooms, day<span class="sc">:</span>people_per_room, <span class="sc">-</span>village) <span class="sc">%&gt;%</span></span>
<span id="cb49-22"><a href="datawrangling.html#cb49-22" tabindex="-1"></a>    <span class="fu">filter</span>(interview_date <span class="sc">&gt;</span> <span class="st">&quot;2016-11-16&quot;</span> <span class="sc">&amp;</span> interview_date <span class="sc">&lt;</span> <span class="st">&#39;2017-01-01&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 9
##    key_ID interview_date      no_membrs years_liv respondent_wall_type rooms
##     &lt;dbl&gt; &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;                &lt;dbl&gt;
##  1     10 2016-12-16 00:00:00        12        23 Burned bricks            5
##  2     34 2016-11-17 00:00:00         8        18 Burned bricks            3
##  3     35 2016-11-17 00:00:00         5        45 Mud Daub                 1
##  4     36 2016-11-17 00:00:00         6        23 Sun bricks               1
##  5     37 2016-11-17 00:00:00         3         8 Burned bricks            1
##  6     43 2016-11-17 00:00:00         7        29 Mud Daub                 1
##  7     44 2016-11-17 00:00:00         2         6 Mud Daub                 1
##  8     45 2016-11-17 00:00:00         9         7 Mud Daub                 1
##  9     46 2016-11-17 00:00:00        10        42 Burned bricks            2
## 10     47 2016-11-17 00:00:00         2         2 Mud Daub                 1
## # ℹ 3 more variables: day &lt;int&gt;, conflict_yn &lt;dbl&gt;, people_per_room &lt;dbl&gt;</code></pre>
</div>
<div id="pivoting-or-reshaping" class="section level2 hasAnchor">
<h2>Pivoting (or reshaping)<a href="datawrangling.html#pivoting-or-reshaping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In tidyverse, reshaping is called pivoting. Here’s how you
pivot a household roster (reshape wider) so you can merge
it with the household data.</p>
<div id="creating-fake-data" class="section level3 hasAnchor">
<h3>Creating fake data<a href="datawrangling.html#creating-fake-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, I create sa fake household roster, based on the SAFI data,
making sure that the household roster has a number of lines
for each household that is equal to the household size, and has two
randomly generated variables: <code>female</code> and <code>age</code>. Note that <code>age</code> may
be <code>-99</code>, which should be considered missing.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="datawrangling.html#cb51-1" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> </span>
<span id="cb51-2"><a href="datawrangling.html#cb51-2" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="datawrangling.html#cb51-3" tabindex="-1"></a>    <span class="fu">select</span>(key_ID,no_membrs ) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="datawrangling.html#cb51-4" tabindex="-1"></a>    <span class="fu">uncount</span>(no_membrs) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="datawrangling.html#cb51-5" tabindex="-1"></a>    <span class="fu">group_by</span>(key_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb51-6"><a href="datawrangling.html#cb51-6" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">member_ID =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="datawrangling.html#cb51-7" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="datawrangling.html#cb51-8" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">female =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb51-9"><a href="datawrangling.html#cb51-9" tabindex="-1"></a>           <span class="at">age =</span> <span class="fu">case_when</span>(member_ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">86</span>,<span class="dv">1</span>),</span>
<span id="cb51-10"><a href="datawrangling.html#cb51-10" tabindex="-1"></a>                          <span class="at">.default =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">86</span>,<span class="sc">-</span><span class="dv">99</span>),<span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb51-11"><a href="datawrangling.html#cb51-11" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb51-12"><a href="datawrangling.html#cb51-12" tabindex="-1"></a></span>
<span id="cb51-13"><a href="datawrangling.html#cb51-13" tabindex="-1"></a>long_data</span></code></pre></div>
<pre><code>## # A tibble: 942 × 4
##    key_ID member_ID female   age
##     &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
##  1      1         1      1    46
##  2      1         2      1    37
##  3      1         3      0    16
##  4      2         1      1    62
##  5      2         2      1    69
##  6      2         3      0    39
##  7      2         4      0     0
##  8      2         5      1    32
##  9      2         6      1     3
## 10      2         7      1     5
## # ℹ 932 more rows</code></pre>
</div>
<div id="pivoting-long-to-wide" class="section level3 hasAnchor">
<h3>Pivoting long to wide<a href="datawrangling.html#pivoting-long-to-wide" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To merge this into our main data set, we need to make sure we go back to having 1 observation per household. We will do this by using <code>pivot_wider()</code>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="datawrangling.html#cb53-1" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="datawrangling.html#cb53-2" tabindex="-1"></a>    long_data <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="datawrangling.html#cb53-3" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> member_ID,</span>
<span id="cb53-4"><a href="datawrangling.html#cb53-4" tabindex="-1"></a>                <span class="at">values_from =</span> <span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_ID&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-5"><a href="datawrangling.html#cb53-5" tabindex="-1"></a>    <span class="fu">relocate</span>(key_ID, <span class="fu">ends_with</span>(<span class="fu">paste0</span>(<span class="st">&quot;_&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>)))</span>
<span id="cb53-6"><a href="datawrangling.html#cb53-6" tabindex="-1"></a></span>
<span id="cb53-7"><a href="datawrangling.html#cb53-7" tabindex="-1"></a>wide_data </span></code></pre></div>
<pre><code>## # A tibble: 131 × 39
##    key_ID female_1 age_1 female_2 age_2 female_3 age_3 female_4 age_4 female_5
##     &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt;
##  1      1        1    46        1    37        0    16       NA    NA       NA
##  2      2        1    62        1    69        0    39        0     0        1
##  3      3        0    52        0    23        0    78        1    66        1
##  4      4        0    65        0     4        1     6        0    56        0
##  5      5        0    81        1    15        1   -99        1    65        1
##  6      6        1    51        1    33        1    32       NA    NA       NA
##  7      7        1    29        0    25        0     3        1    77        1
##  8      8        1    63        0    79        1    46        0    61        1
##  9      9        0    50        0     5        0    24        1     4        0
## 10     10        1    74        0    14        0    69        0    24        0
## # ℹ 121 more rows
## # ℹ 29 more variables: age_5 &lt;dbl&gt;, female_6 &lt;int&gt;, age_6 &lt;dbl&gt;,
## #   female_7 &lt;int&gt;, age_7 &lt;dbl&gt;, female_8 &lt;int&gt;, age_8 &lt;dbl&gt;, female_9 &lt;int&gt;,
## #   age_9 &lt;dbl&gt;, female_10 &lt;int&gt;, age_10 &lt;dbl&gt;, female_11 &lt;int&gt;, age_11 &lt;dbl&gt;,
## #   female_12 &lt;int&gt;, age_12 &lt;dbl&gt;, female_13 &lt;int&gt;, age_13 &lt;dbl&gt;,
## #   female_14 &lt;int&gt;, age_14 &lt;dbl&gt;, female_15 &lt;int&gt;, age_15 &lt;dbl&gt;,
## #   female_16 &lt;int&gt;, age_16 &lt;dbl&gt;, female_17 &lt;int&gt;, age_17 &lt;dbl&gt;, …</code></pre>
<p>We only needed to specify two options:</p>
<ul>
<li>names_from: this is the column that contains the names (or usually numbers)
for each of our units of analysis. In this case, the <code>member_ID</code>.</li>
<li>values_from: the variables containing the data. All variables you specify
here, will get one column for each possible value of names_from.
In our case, these variables <code>female</code> and <code>age</code>.
I used <a href="https://tidyr.tidyverse.org/reference/tidyr_tidy_select.html">tidy select syntax</a>
to specify all variables except the ones ending in <code>_ID</code>.</li>
<li>I use <code>relocate()</code> to reorder the variables.</li>
</ul>
</div>
<div id="pivoting-wide-to-long" class="section level3 hasAnchor">
<h3>Pivoting wide to long<a href="datawrangling.html#pivoting-wide-to-long" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we had started with wide data, and had wanted to transform to
long data, we’d have to use <code>pivot_longer()</code>:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="datawrangling.html#cb55-1" tabindex="-1"></a>wide_data <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">!</span>key_ID, <span class="at">names_to =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4,978 × 3
##    key_ID name     value
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1      1 female_1     1
##  2      1 age_1       46
##  3      1 female_2     1
##  4      1 age_2       37
##  5      1 female_3     0
##  6      1 age_3       16
##  7      1 female_4    NA
##  8      1 age_4       NA
##  9      1 female_5    NA
## 10      1 age_5       NA
## # ℹ 4,968 more rows</code></pre>
<p>This was easy since the syntax of <code>pivot_longer()</code> is the exact opposite of
<code>pivot_wider()</code>, but the result is pretty useless:</p>
<ul>
<li>The <code>name</code> column contains two things: a variable name and a <code>member_ID</code>;</li>
<li>The data is too long: I’d like <code>age</code> and <code>female</code> to be two separate variables
; and</li>
<li>There’s many empty rows: there’s and age and female row for 19 possible members
for each household, but most households are smaller than that.</li>
</ul>
<p>I could use <a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html"><code>separate_wider_delim()</code></a>,
<code>pivot_wider()</code>, and <code>filter(!is.na())</code> to address those, but that’s not elegant
at all.
I can do all of this within the <code>pivot_longer()</code> call by using the <code>names_to</code>
and <code>names_sep</code> options:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="datawrangling.html#cb57-1" tabindex="-1"></a>wide_data <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="datawrangling.html#cb57-2" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">!</span>key_ID, </span>
<span id="cb57-3"><a href="datawrangling.html#cb57-3" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;member_ID&quot;</span>),</span>
<span id="cb57-4"><a href="datawrangling.html#cb57-4" tabindex="-1"></a>                 <span class="at">names_sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb57-5"><a href="datawrangling.html#cb57-5" tabindex="-1"></a>                 <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-6"><a href="datawrangling.html#cb57-6" tabindex="-1"></a>                 <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">member_ID =</span> as.integer))</span></code></pre></div>
<pre><code>## # A tibble: 942 × 4
##    key_ID member_ID female   age
##     &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
##  1      1         1      1    46
##  2      1         2      1    37
##  3      1         3      0    16
##  4      2         1      1    62
##  5      2         2      1    69
##  6      2         3      0    39
##  7      2         4      0     0
##  8      2         5      1    32
##  9      2         6      1     3
## 10      2         7      1     5
## # ℹ 932 more rows</code></pre>
<p>In this case, the syntax is a bit harder to understand. It’s good to think first
what the original data looks like, and how I intend to transform it.
The wide data has columns key_ID, age_1-19 and female_1-19.
I don’t really want to touch the key_ID column.
I want to turn the columns age_1-19 and female_1-19 into three columns:
<code>female</code>, <code>age</code> and <code>member_ID</code>.
This translates to the options we passed to <code>pivot_longer()</code> as follows:</p>
<ul>
<li><code>!key_ID</code>: We want to pivot the data that’s in all columns except key_ID.</li>
<li><code>names_to = c(".value", "member_ID")</code>: this specifies the new columns we want
to create. It basically says that the existing column names consist of two parts:
one part (i.e. female and age) that we wish to keep as column names of variables
that will contain my values, and one part (i.e. the numbers 1-19) which should
be put into a new column which we will “member_ID”.</li>
<li><code>names_sep=</code>: this indicates how the two parts mentioned above are
separated. In more difficult cases, you’ll have to use the <code>names_pattern</code> option.
This requires some knowledge of
<a href="https://www.datacamp.com/tutorial/regex-r-regular-expressions-guide">regular expressions</a>,
so here’s two examples:
<ul>
<li>If there is no seperator (<code>age1</code>,<code>female1</code> etc…): <code>names_pattern = "(.*\\D)([0-9]+)$"</code>.
In this regular expression, <code>.*\\D</code> matches a string of any length, of any characters,
as long as it ends with something other than a digit.
The <code>[0-9]+$</code> matches any number of digits at the end of the string.
The parentheses indicate how the string should be separated to form variable names and member_ID.</li>
<li>If the separator is used in other places in variable names (<code>member_age_1</code> etc…):
<code>names_pattern = "(.*)_([0-9]+)$"</code>.</li>
</ul></li>
<li><code>values_drop_na = TRUE</code>: tells R to drop rows that have missing data for
all variables. This prevents the issue where we hadd too many rows.</li>
<li><code>names_transform</code>: by default, all <code>name</code> columns will be character types, but
<code>member_ID</code> only contains integers, so we transform it to integer. This is
completely optional.</li>
</ul>
</div>
</div>
<div id="joining-or-merging-data" class="section level2 hasAnchor">
<h2>Joining (or merging) data<a href="datawrangling.html#joining-or-merging-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Tidyverse has four functions to join (or merge, as Stata calls it) two
data sets. The functions that differ in the way they treat observations that are in one data set but not the other.
Consider the diagram below.
It has two data sets, <code>x</code> (in Stata terms, this is the master data set) and <code>y</code> (the using
data set in Stata terms). They have overlapping rows (area B), but also
rows that are only in <code>x</code> (area A) or only in <code>y</code> (area C).</p>
<p><img src="images/join_venn.png" /></p>
<p>The four join functions work as follows:</p>
<ul>
<li><code>inner_join(x,y)</code> will only keep area B.</li>
<li><code>left_join(x,y)</code> will keep areas A and B.</li>
<li><code>right_join(x,y)</code> will keep areas B and C.</li>
<li><code>full_join(x,y)</code> will keep areas A, B, and C.</li>
</ul>
<p>In our case, the data sets match perfectly, i.e. we only have an area B, so there is no practical difference. I chose <code>left_join()</code> so the number of
observations in my household survey is guaranteed to remain the same.
To merge the roster to the household data, we use the join_by function:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="datawrangling.html#cb59-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="datawrangling.html#cb59-2" tabindex="-1"></a>    <span class="fu">left_join</span>(wide_data)</span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Joining with `by = join_by(key_ID)`</code></pre>
<pre><code>## # A tibble: 131 × 52
##    key_ID village  interview_date      no_membrs years_liv respondent_wall_type
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
##  1      1 God      2016-11-17 00:00:00         3         4 muddaub             
##  2      2 God      2016-11-17 00:00:00         7         9 muddaub             
##  3      3 God      2016-11-17 00:00:00        10        15 burntbricks         
##  4      4 God      2016-11-17 00:00:00         7         6 burntbricks         
##  5      5 God      2016-11-17 00:00:00         7        40 burntbricks         
##  6      6 God      2016-11-17 00:00:00         3         3 muddaub             
##  7      7 God      2016-11-17 00:00:00         6        38 muddaub             
##  8      8 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
##  9      9 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
## 10     10 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
## # ℹ 121 more rows
## # ℹ 46 more variables: rooms &lt;dbl&gt;, memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
## #   liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;,
## #   instanceID &lt;chr&gt;, female_1 &lt;int&gt;, age_1 &lt;dbl&gt;, female_2 &lt;int&gt;, age_2 &lt;dbl&gt;,
## #   female_3 &lt;int&gt;, age_3 &lt;dbl&gt;, female_4 &lt;int&gt;, age_4 &lt;dbl&gt;, female_5 &lt;int&gt;,
## #   age_5 &lt;dbl&gt;, female_6 &lt;int&gt;, age_6 &lt;dbl&gt;, female_7 &lt;int&gt;, age_7 &lt;dbl&gt;,
## #   female_8 &lt;int&gt;, age_8 &lt;dbl&gt;, female_9 &lt;int&gt;, age_9 &lt;dbl&gt;, …</code></pre>
<p>Note that we didn’t specify identifiers, like we would in Stata. R
assumed that the variables that appear in both data frames are the
identifiers, in this case <code>key_ID</code>. Use the <code>by</code> option to change this.</p>
<p>Going the other way around, joining the household data to the
roster data, is equally easy:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="datawrangling.html#cb62-1" tabindex="-1"></a>long_data <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="datawrangling.html#cb62-2" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb62-3"><a href="datawrangling.html#cb62-3" tabindex="-1"></a>        <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href="datawrangling.html#cb62-4" tabindex="-1"></a>            <span class="fu">select</span>(key_ID,village,interview_date))</span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Joining with `by = join_by(key_ID)`</code></pre>
<pre><code>## # A tibble: 942 × 6
##    key_ID member_ID female   age village interview_date     
##     &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dttm&gt;             
##  1      1         1      1    46 God     2016-11-17 00:00:00
##  2      1         2      1    37 God     2016-11-17 00:00:00
##  3      1         3      0    16 God     2016-11-17 00:00:00
##  4      2         1      1    62 God     2016-11-17 00:00:00
##  5      2         2      1    69 God     2016-11-17 00:00:00
##  6      2         3      0    39 God     2016-11-17 00:00:00
##  7      2         4      0     0 God     2016-11-17 00:00:00
##  8      2         5      1    32 God     2016-11-17 00:00:00
##  9      2         6      1     3 God     2016-11-17 00:00:00
## 10      2         7      1     5 God     2016-11-17 00:00:00
## # ℹ 932 more rows</code></pre>
<p>Note that here I only merged in two variables, by using <code>select</code> and a pipe within the <code>left_join()</code> function.</p>
</div>
<div id="summarizing-over-groups-or-collapsing-data" class="section level2 hasAnchor">
<h2>Summarizing over groups (or collapsing data)<a href="datawrangling.html#summarizing-over-groups-or-collapsing-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To compute summary statistics (sums, counts, means etc.) over a group,
we use the <code>group_by()</code> and <code>summarize()</code> functions. For example, to
compute the household size, number of women and average age in each household.
But before doing anything, I make sure the <code>-99</code>s in the <code>age</code> variable are treated
as missing, using a simple <code>mutate()</code> to conver them to <code>NA</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="datawrangling.html#cb65-1" tabindex="-1"></a>long_data <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="datawrangling.html#cb65-2" tabindex="-1"></a>    <span class="fu">group_by</span>(key_ID) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="datawrangling.html#cb65-3" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">if_else</span>(age <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,<span class="cn">NA</span>,age)) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="datawrangling.html#cb65-4" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">hh_size =</span> <span class="fu">n</span>(), <span class="at">num_women =</span> <span class="fu">sum</span>(female), <span class="at">mean_age =</span> <span class="fu">mean</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 131 × 4
##    key_ID hh_size num_women mean_age
##     &lt;dbl&gt;   &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1      1       3         2     33  
##  2      2       7         5     30  
##  3      3      10         2     48.9
##  4      4       7         2     29.4
##  5      5       7         5     52.2
##  6      6       3         3     38.7
##  7      7       6         4     34.3
##  8      8      12         6     38.7
##  9      9       8         3     23.2
## 10     10      12         5     38.2
## # ℹ 121 more rows</code></pre>
</div>
<div id="row-wise-operations" class="section level2 hasAnchor">
<h2>Row-wise Operations<a href="datawrangling.html#row-wise-operations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose we wanted to run an operation over multiple variables. For example to
get the household size, number of women and average age from our wide data.
The easiest, and probably best, way to do this in R is by reshaping to long,
and then use summarize, like we did above. But in Stata you would probably use some sort of
<code>egen</code> function, so that may come natural.
You can do similar things in R. It’s just a bit more complex than in Stata.</p>
<div id="across-doing-the-same-operations-on-multiple-variables-using-across" class="section level3 hasAnchor">
<h3>across(): doing the same operations on multiple variables using across<a href="datawrangling.html#across-doing-the-same-operations-on-multiple-variables-using-across" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, we need to make sure we update <code>-99</code> to <code>NA</code> in <em>all</em> <code>age_</code> variables.
I use the <code>across()</code> function, which takes two arguments: a column specifcation
(for which I use <a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html">tidy select</a>
syntax), and a <a href="programming.html#functions">function</a>: basically, the syntax is the same as in the <code>mutate()</code>
step above, but with a tilde (<code>~</code>) in front of <code>ifelse()</code> and <code>.x</code> instead of the variable name.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="datawrangling.html#cb67-1" tabindex="-1"></a>wide_data <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="datawrangling.html#cb67-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;age_&quot;</span>),</span>
<span id="cb67-3"><a href="datawrangling.html#cb67-3" tabindex="-1"></a>                  <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">if_else</span>(.x <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,<span class="cn">NA</span>,.x)))</span></code></pre></div>
<pre><code>## # A tibble: 131 × 39
##    key_ID female_1 age_1 female_2 age_2 female_3 age_3 female_4 age_4 female_5
##     &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;int&gt;
##  1      1        1    46        1    37        0    16       NA    NA       NA
##  2      2        1    62        1    69        0    39        0     0        1
##  3      3        0    52        0    23        0    78        1    66        1
##  4      4        0    65        0     4        1     6        0    56        0
##  5      5        0    81        1    15        1    NA        1    65        1
##  6      6        1    51        1    33        1    32       NA    NA       NA
##  7      7        1    29        0    25        0     3        1    77        1
##  8      8        1    63        0    79        1    46        0    61        1
##  9      9        0    50        0     5        0    24        1     4        0
## 10     10        1    74        0    14        0    69        0    24        0
## # ℹ 121 more rows
## # ℹ 29 more variables: age_5 &lt;dbl&gt;, female_6 &lt;int&gt;, age_6 &lt;dbl&gt;,
## #   female_7 &lt;int&gt;, age_7 &lt;dbl&gt;, female_8 &lt;int&gt;, age_8 &lt;dbl&gt;, female_9 &lt;int&gt;,
## #   age_9 &lt;dbl&gt;, female_10 &lt;int&gt;, age_10 &lt;dbl&gt;, female_11 &lt;int&gt;, age_11 &lt;dbl&gt;,
## #   female_12 &lt;int&gt;, age_12 &lt;dbl&gt;, female_13 &lt;int&gt;, age_13 &lt;dbl&gt;,
## #   female_14 &lt;int&gt;, age_14 &lt;dbl&gt;, female_15 &lt;int&gt;, age_15 &lt;dbl&gt;,
## #   female_16 &lt;int&gt;, age_16 &lt;dbl&gt;, female_17 &lt;int&gt;, age_17 &lt;dbl&gt;, …</code></pre>
<p>Notes:</p>
<ul>
<li>You can use <code>across(.cols = where(is.numeric), .fn = ...)</code> to apply a function to all numeric variables.</li>
<li>You can also combine <code>across()</code> with <code>summarize()</code> to summarize multiple variables more easily. See the
section on <a href="plotting.html#faceting">faceting</a> for an example.</li>
</ul>
</div>
<div id="c_across-passing-values-from-multiple-variables-to-summarizing-functions" class="section level3 hasAnchor">
<h3>c_across(): passing values from multiple variables to summarizing functions<a href="datawrangling.html#c_across-passing-values-from-multiple-variables-to-summarizing-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Then I have to pass all the <code>female_</code> and <code>age_</code> variables to <code>sum()</code> and <code>mean()</code>:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="datawrangling.html#cb69-1" tabindex="-1"></a>wide_data <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="datawrangling.html#cb69-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;age_&quot;</span>),</span>
<span id="cb69-3"><a href="datawrangling.html#cb69-3" tabindex="-1"></a>                  <span class="at">.fn =</span> <span class="sc">~</span><span class="fu">if_else</span>(.x <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,<span class="cn">NA</span>,.x))) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="datawrangling.html#cb69-4" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="datawrangling.html#cb69-5" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;age_&quot;</span>)),</span>
<span id="cb69-6"><a href="datawrangling.html#cb69-6" tabindex="-1"></a>                           <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb69-7"><a href="datawrangling.html#cb69-7" tabindex="-1"></a>           <span class="at">num_women =</span>  <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;female_&quot;</span>)),</span>
<span id="cb69-8"><a href="datawrangling.html#cb69-8" tabindex="-1"></a>                            <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb69-9"><a href="datawrangling.html#cb69-9" tabindex="-1"></a>           <span class="at">hh_size =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;female_&quot;</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb69-10"><a href="datawrangling.html#cb69-10" tabindex="-1"></a>    <span class="fu">select</span>(key_ID,hh_size,num_women, mean_age) <span class="sc">%&gt;%</span></span>
<span id="cb69-11"><a href="datawrangling.html#cb69-11" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 131 × 4
##    key_ID hh_size num_women mean_age
##     &lt;dbl&gt;   &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1      1       3         2     33  
##  2      2       7         5     30  
##  3      3      10         2     48.9
##  4      4       7         2     29.4
##  5      5       7         5     52.2
##  6      6       3         3     38.7
##  7      7       6         4     34.3
##  8      8      12         6     38.7
##  9      9       8         3     23.2
## 10     10      12         5     38.2
## # ℹ 121 more rows</code></pre>
<p>The key trick here is the combination of <code>rowwise()</code> and <code>c_across()</code>.
<code>rowwise()</code> ensures all summaries are computed per row, and <code>c_across()</code>
allows you to use <a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html">tidy select</a> syntax within the <code>mean()</code> and <code>sum()</code> functions.</p>
<p>Do not that this is very flexible, but it can be EXTREMLY slow.
If you have a large dataset, <code>rowSums()</code>and <code>rowMeans()</code> are fast and may just be
what you need.</p>
</div>
</div>
<div id="seperate_longer" class="section level2 hasAnchor">
<h2>Splitting multi-response variable into dummies<a href="datawrangling.html#seperate_longer" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The SAFI data contains a number of columns that contain all responses selected
in a multiple response questions. For example, the variables <code>items_owned</code> can
contain something like <code>"bicycle;television;solar_panel;table"</code>. We want to
split this into dummies: one for each possible answers. There’s a number of
ways to do this, but the most convenient is using <code>sepate_longer()</code></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="datawrangling.html#cb71-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="datawrangling.html#cb71-2" tabindex="-1"></a>    <span class="fu">separate_longer_delim</span>(items_owned, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="datawrangling.html#cb71-3" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="datawrangling.html#cb71-4" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> items_owned,</span>
<span id="cb71-5"><a href="datawrangling.html#cb71-5" tabindex="-1"></a>                <span class="at">values_from =</span> value,</span>
<span id="cb71-6"><a href="datawrangling.html#cb71-6" tabindex="-1"></a>                <span class="at">names_glue =</span> <span class="st">&quot;owns_{items_owned}&quot;</span>,</span>
<span id="cb71-7"><a href="datawrangling.html#cb71-7" tabindex="-1"></a>                <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-8"><a href="datawrangling.html#cb71-8" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb71-9"><a href="datawrangling.html#cb71-9" tabindex="-1"></a>        <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-10"><a href="datawrangling.html#cb71-10" tabindex="-1"></a>            <span class="fu">select</span>(key_ID,items_owned)) <span class="sc">%&gt;%</span></span>
<span id="cb71-11"><a href="datawrangling.html#cb71-11" tabindex="-1"></a>            <span class="fu">select</span>(items_owned, <span class="fu">starts_with</span>(<span class="st">&quot;owns_&quot;</span>)</span>
<span id="cb71-12"><a href="datawrangling.html#cb71-12" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb71-13"><a href="datawrangling.html#cb71-13" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 19
##   items_owned           owns_bicycle owns_television owns_solar_panel owns_table
##   &lt;chr&gt;                        &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;
## 1 bicycle;television;s…            1               1                1          1
## 2 cow_cart;bicycle;rad…            1               0                1          1
## 3 solar_torch                      0               0                0          0
## 4 bicycle;radio;cow_pl…            1               0                1          0
## 5 motorcyle;radio;cow_…            0               0                0          0
## 6 &lt;NA&gt;                             0               0                0          0
## # ℹ 14 more variables: owns_cow_cart &lt;dbl&gt;, owns_radio &lt;dbl&gt;,
## #   owns_cow_plough &lt;dbl&gt;, owns_solar_torch &lt;dbl&gt;, owns_mobile_phone &lt;dbl&gt;,
## #   owns_motorcyle &lt;dbl&gt;, owns_NA &lt;dbl&gt;, owns_fridge &lt;dbl&gt;,
## #   owns_electricity &lt;dbl&gt;, owns_sofa_set &lt;dbl&gt;, owns_lorry &lt;dbl&gt;,
## #   owns_sterio &lt;dbl&gt;, owns_computer &lt;dbl&gt;, owns_car &lt;dbl&gt;</code></pre>
<p>Note that the original <code>items_owned</code> variable is lost during the <code>separate_longer_delim()</code>
step, so I used <code>left_join()</code> to merge it back in for demonstration purposes.</p>
<p>If you need to do this to many columns (wich is likely),
it is worth creating a <a href="programming.html#functions">function</a>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="datawrangling.html#cb73-1" tabindex="-1"></a>create_dummies <span class="ot">&lt;-</span> <span class="cf">function</span>(df,stringvar,<span class="at">prefix=</span><span class="st">&quot;&quot;</span>,<span class="at">delim =</span> <span class="st">&quot;;&quot;</span>) {</span>
<span id="cb73-2"><a href="datawrangling.html#cb73-2" tabindex="-1"></a>  <span class="co">#Function that generates dummies from a string variable</span></span>
<span id="cb73-3"><a href="datawrangling.html#cb73-3" tabindex="-1"></a>  <span class="co">#containing multi-response answers</span></span>
<span id="cb73-4"><a href="datawrangling.html#cb73-4" tabindex="-1"></a>  <span class="co">#returns dataset without original var, but with dummies.</span></span>
<span id="cb73-5"><a href="datawrangling.html#cb73-5" tabindex="-1"></a></span>
<span id="cb73-6"><a href="datawrangling.html#cb73-6" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb73-7"><a href="datawrangling.html#cb73-7" tabindex="-1"></a>    <span class="fu">separate_longer_delim</span>({{ stringvar }}, <span class="at">delim =</span> delim) <span class="sc">%&gt;%</span></span>
<span id="cb73-8"><a href="datawrangling.html#cb73-8" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">value =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-9"><a href="datawrangling.html#cb73-9" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> {{stringvar}},</span>
<span id="cb73-10"><a href="datawrangling.html#cb73-10" tabindex="-1"></a>                  <span class="at">values_from =</span> value,</span>
<span id="cb73-11"><a href="datawrangling.html#cb73-11" tabindex="-1"></a>                  <span class="at">names_prefix =</span> prefix,</span>
<span id="cb73-12"><a href="datawrangling.html#cb73-12" tabindex="-1"></a>                  <span class="at">values_fill =</span> <span class="dv">0</span>) </span>
<span id="cb73-13"><a href="datawrangling.html#cb73-13" tabindex="-1"></a>}</span>
<span id="cb73-14"><a href="datawrangling.html#cb73-14" tabindex="-1"></a></span>
<span id="cb73-15"><a href="datawrangling.html#cb73-15" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-16"><a href="datawrangling.html#cb73-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">items_owned =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(items_owned),<span class="st">&quot;None&quot;</span>,items_owned)) <span class="sc">%&gt;%</span></span>
<span id="cb73-17"><a href="datawrangling.html#cb73-17" tabindex="-1"></a>  <span class="fu">create_dummies</span>(<span class="at">stringvar =</span> items_owned, <span class="at">prefix =</span> <span class="st">&quot;owns_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-18"><a href="datawrangling.html#cb73-18" tabindex="-1"></a>  <span class="fu">create_dummies</span>(months_lack_food,<span class="st">&quot;lack_food_&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 131 × 43
##    key_ID village  interview_date      no_membrs years_liv respondent_wall_type
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
##  1      1 God      2016-11-17 00:00:00         3         4 muddaub             
##  2      2 God      2016-11-17 00:00:00         7         9 muddaub             
##  3      3 God      2016-11-17 00:00:00        10        15 burntbricks         
##  4      4 God      2016-11-17 00:00:00         7         6 burntbricks         
##  5      5 God      2016-11-17 00:00:00         7        40 burntbricks         
##  6      6 God      2016-11-17 00:00:00         3         3 muddaub             
##  7      7 God      2016-11-17 00:00:00         6        38 muddaub             
##  8      8 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
##  9      9 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
## 10     10 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
## # ℹ 121 more rows
## # ℹ 37 more variables: rooms &lt;dbl&gt;, memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
## #   liv_count &lt;dbl&gt;, no_meals &lt;dbl&gt;, instanceID &lt;chr&gt;, owns_bicycle &lt;dbl&gt;,
## #   owns_television &lt;dbl&gt;, owns_solar_panel &lt;dbl&gt;, owns_table &lt;dbl&gt;,
## #   owns_cow_cart &lt;dbl&gt;, owns_radio &lt;dbl&gt;, owns_cow_plough &lt;dbl&gt;,
## #   owns_solar_torch &lt;dbl&gt;, owns_mobile_phone &lt;dbl&gt;, owns_motorcyle &lt;dbl&gt;,
## #   owns_None &lt;dbl&gt;, owns_fridge &lt;dbl&gt;, owns_electricity &lt;dbl&gt;, …</code></pre>
</div>
<div id="renaming-many-variables" class="section level2 hasAnchor">
<h2>Renaming many variables<a href="datawrangling.html#renaming-many-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s say we need to rename a bunch of variables.</p>
<p>One way is to use a named list:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="datawrangling.html#cb76-1" tabindex="-1"></a><span class="co"># this follows the pattern new_name = old_name</span></span>
<span id="cb76-2"><a href="datawrangling.html#cb76-2" tabindex="-1"></a>newnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;no_livestock&quot;</span> <span class="ot">=</span> <span class="st">&quot;liv_count&quot;</span>, </span>
<span id="cb76-3"><a href="datawrangling.html#cb76-3" tabindex="-1"></a>              <span class="st">&quot;no_rooms&quot;</span> <span class="ot">=</span> <span class="st">&quot;rooms&quot;</span>,</span>
<span id="cb76-4"><a href="datawrangling.html#cb76-4" tabindex="-1"></a>               <span class="st">&quot;affect_conflicts&quot;</span> <span class="ot">=</span> <span class="st">&quot;ffect_conflicts&quot;</span>)</span>
<span id="cb76-5"><a href="datawrangling.html#cb76-5" tabindex="-1"></a></span>
<span id="cb76-6"><a href="datawrangling.html#cb76-6" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb76-7"><a href="datawrangling.html#cb76-7" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">any_of</span>(newnames)) <span class="sc">%&gt;%</span></span>
<span id="cb76-8"><a href="datawrangling.html#cb76-8" tabindex="-1"></a>    <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 131
## Columns: 14
## $ key_ID               &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…
## $ village              &lt;chr&gt; &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, …
## $ interview_date       &lt;dttm&gt; 2016-11-17, 2016-11-17, 2016-11-17, 2016-11-17, …
## $ no_membrs            &lt;dbl&gt; 3, 7, 10, 7, 7, 3, 6, 12, 8, 12, 6, 7, 6, 10, 5, …
## $ years_liv            &lt;dbl&gt; 4, 9, 15, 6, 40, 3, 38, 70, 6, 23, 20, 20, 8, 20,…
## $ respondent_wall_type &lt;chr&gt; &quot;muddaub&quot;, &quot;muddaub&quot;, &quot;burntbricks&quot;, &quot;burntbricks…
## $ no_rooms             &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 3, 1, 5, 1, 3, 1, 3, 2, 1, 1…
## $ memb_assoc           &lt;chr&gt; NA, &quot;yes&quot;, NA, NA, NA, NA, &quot;no&quot;, &quot;yes&quot;, &quot;no&quot;, &quot;no…
## $ affect_conflicts     &lt;chr&gt; NA, &quot;once&quot;, NA, NA, NA, NA, &quot;never&quot;, &quot;never&quot;, &quot;ne…
## $ no_livestock         &lt;dbl&gt; 1, 3, 1, 2, 4, 1, 1, 2, 3, 2, 2, 2, 3, 3, 3, 4, 1…
## $ items_owned          &lt;chr&gt; &quot;bicycle;television;solar_panel;table&quot;, &quot;cow_cart…
## $ no_meals             &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 2, 3, 2, 3, 2, 3, 2…
## $ months_lack_food     &lt;chr&gt; &quot;Jan&quot;, &quot;Jan;Sept;Oct;Nov;Dec&quot;, &quot;Jan;Feb;Mar;Oct;N…
## $ instanceID           &lt;chr&gt; &quot;uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef&quot;, &quot;uui…</code></pre>
<p>Note that <code>"affect_conflicts" = "ffect_conflicts"</code> didn’t do anything,
as there is no <code>ffect_conflicts</code> variable.
<code>any_of()</code> just ignored any variables not present in the data.
This can be useful in data pipelines using multiple files,
where some files have mistyped variable names.</p>
<p>What if we want to do the same thing to many variables?
For example, turning them all to uppercase?</p>
<p>We could use <code>newnames = c(KEY_ID = key_ID, VILLAGE = village)</code>
etc. etc.,
but that’d be extremely tedious.
Instead, there is <code>rename_with()</code>, which takes two arugments:</p>
<ul>
<li><code>.fn</code>: A <a href="programming.html#functions">function</a> that takes the variable names of your dataset as an argument.</li>
<li><code>.cols</code>: a tidy select statement defining which columns to change. Defaults
to all columns.</li>
</ul>
<p>This is what it’d look like:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="datawrangling.html#cb78-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="datawrangling.html#cb78-2" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="at">.fn =</span> toupper) <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="datawrangling.html#cb78-3" tabindex="-1"></a>    <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 131
## Columns: 14
## $ KEY_ID               &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…
## $ VILLAGE              &lt;chr&gt; &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, …
## $ INTERVIEW_DATE       &lt;dttm&gt; 2016-11-17, 2016-11-17, 2016-11-17, 2016-11-17, …
## $ NO_MEMBRS            &lt;dbl&gt; 3, 7, 10, 7, 7, 3, 6, 12, 8, 12, 6, 7, 6, 10, 5, …
## $ YEARS_LIV            &lt;dbl&gt; 4, 9, 15, 6, 40, 3, 38, 70, 6, 23, 20, 20, 8, 20,…
## $ RESPONDENT_WALL_TYPE &lt;chr&gt; &quot;muddaub&quot;, &quot;muddaub&quot;, &quot;burntbricks&quot;, &quot;burntbricks…
## $ ROOMS                &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 3, 1, 5, 1, 3, 1, 3, 2, 1, 1…
## $ MEMB_ASSOC           &lt;chr&gt; NA, &quot;yes&quot;, NA, NA, NA, NA, &quot;no&quot;, &quot;yes&quot;, &quot;no&quot;, &quot;no…
## $ AFFECT_CONFLICTS     &lt;chr&gt; NA, &quot;once&quot;, NA, NA, NA, NA, &quot;never&quot;, &quot;never&quot;, &quot;ne…
## $ LIV_COUNT            &lt;dbl&gt; 1, 3, 1, 2, 4, 1, 1, 2, 3, 2, 2, 2, 3, 3, 3, 4, 1…
## $ ITEMS_OWNED          &lt;chr&gt; &quot;bicycle;television;solar_panel;table&quot;, &quot;cow_cart…
## $ NO_MEALS             &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 2, 3, 2, 3, 2, 3, 2…
## $ MONTHS_LACK_FOOD     &lt;chr&gt; &quot;Jan&quot;, &quot;Jan;Sept;Oct;Nov;Dec&quot;, &quot;Jan;Feb;Mar;Oct;N…
## $ INSTANCEID           &lt;chr&gt; &quot;uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef&quot;, &quot;uui…</code></pre>
<p>The variables names are used as the argument to <code>toupper()</code>,
which returns them in upper case.</p>
<p>But what if we need to provide more arguments?
Let’s say we want to append <code>_0</code> to all columns,
except the ID columns,
to indicate this is baseline data.</p>
<p>We use <code>paste0()</code> which takes two arguments,
the variable name and string we wish to append:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="datawrangling.html#cb80-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="datawrangling.html#cb80-2" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="at">.fn =</span> <span class="sc">~</span><span class="fu">paste0</span>(.x, <span class="st">&quot;_0&quot;</span>), <span class="at">.cols =</span> <span class="sc">!</span>key_ID) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="datawrangling.html#cb80-3" tabindex="-1"></a>    <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 131
## Columns: 14
## $ key_ID                 &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, …
## $ village_0              &lt;chr&gt; &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;…
## $ interview_date_0       &lt;dttm&gt; 2016-11-17, 2016-11-17, 2016-11-17, 2016-11-17…
## $ no_membrs_0            &lt;dbl&gt; 3, 7, 10, 7, 7, 3, 6, 12, 8, 12, 6, 7, 6, 10, 5…
## $ years_liv_0            &lt;dbl&gt; 4, 9, 15, 6, 40, 3, 38, 70, 6, 23, 20, 20, 8, 2…
## $ respondent_wall_type_0 &lt;chr&gt; &quot;muddaub&quot;, &quot;muddaub&quot;, &quot;burntbricks&quot;, &quot;burntbric…
## $ rooms_0                &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 3, 1, 5, 1, 3, 1, 3, 2, 1,…
## $ memb_assoc_0           &lt;chr&gt; NA, &quot;yes&quot;, NA, NA, NA, NA, &quot;no&quot;, &quot;yes&quot;, &quot;no&quot;, &quot;…
## $ affect_conflicts_0     &lt;chr&gt; NA, &quot;once&quot;, NA, NA, NA, NA, &quot;never&quot;, &quot;never&quot;, &quot;…
## $ liv_count_0            &lt;dbl&gt; 1, 3, 1, 2, 4, 1, 1, 2, 3, 2, 2, 2, 3, 3, 3, 4,…
## $ items_owned_0          &lt;chr&gt; &quot;bicycle;television;solar_panel;table&quot;, &quot;cow_ca…
## $ no_meals_0             &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 2, 3, 2, 3, 2, 3,…
## $ months_lack_food_0     &lt;chr&gt; &quot;Jan&quot;, &quot;Jan;Sept;Oct;Nov;Dec&quot;, &quot;Jan;Feb;Mar;Oct…
## $ instanceID_0           &lt;chr&gt; &quot;uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef&quot;, &quot;u…</code></pre>
<p>In this case, we specify the function as a
<a href="https://adv-r.hadley.nz/functionals.html#purrr-shortcuts">a purrr-style inline anonymous function</a>
(i.e. preceded by a <code>~</code>), and we supply the variable names as <code>.x</code>.
(This all works the same as <code>across()</code> above.)</p>
<p>Now, let’s replace all instances of <code>membrs</code> or <code>memb</code> in variable names with
<code>members</code> (so <code>no_membrs</code> becomes <code>no_members</code>,
and <code>memb_assoc</code> becomes <code>members_assoc</code>.
For this I will use <code>gsub()</code>,
which takes three arguments:</p>
<ul>
<li>A pattern (expressed as a <a href="https://www.datacamp.com/tutorial/regex-r-regular-expressions-guide">regular expression</a>) to look for;</li>
<li>a replacement for all matches of the pattern; and,</li>
<li>the data to look in (in this case the varaible names).</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="datawrangling.html#cb82-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="datawrangling.html#cb82-2" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="at">.fn =</span> <span class="sc">~</span><span class="fu">gsub</span>(<span class="st">&quot;membrs|memb&quot;</span>, <span class="st">&quot;members&quot;</span>,.x)) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="datawrangling.html#cb82-3" tabindex="-1"></a>    <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 131
## Columns: 14
## $ key_ID               &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…
## $ village              &lt;chr&gt; &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, &quot;God&quot;, …
## $ interview_date       &lt;dttm&gt; 2016-11-17, 2016-11-17, 2016-11-17, 2016-11-17, …
## $ no_members           &lt;dbl&gt; 3, 7, 10, 7, 7, 3, 6, 12, 8, 12, 6, 7, 6, 10, 5, …
## $ years_liv            &lt;dbl&gt; 4, 9, 15, 6, 40, 3, 38, 70, 6, 23, 20, 20, 8, 20,…
## $ respondent_wall_type &lt;chr&gt; &quot;muddaub&quot;, &quot;muddaub&quot;, &quot;burntbricks&quot;, &quot;burntbricks…
## $ rooms                &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 3, 1, 5, 1, 3, 1, 3, 2, 1, 1…
## $ members_assoc        &lt;chr&gt; NA, &quot;yes&quot;, NA, NA, NA, NA, &quot;no&quot;, &quot;yes&quot;, &quot;no&quot;, &quot;no…
## $ affect_conflicts     &lt;chr&gt; NA, &quot;once&quot;, NA, NA, NA, NA, &quot;never&quot;, &quot;never&quot;, &quot;ne…
## $ liv_count            &lt;dbl&gt; 1, 3, 1, 2, 4, 1, 1, 2, 3, 2, 2, 2, 3, 3, 3, 4, 1…
## $ items_owned          &lt;chr&gt; &quot;bicycle;television;solar_panel;table&quot;, &quot;cow_cart…
## $ no_meals             &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 2, 3, 2, 3, 2, 3, 2…
## $ months_lack_food     &lt;chr&gt; &quot;Jan&quot;, &quot;Jan;Sept;Oct;Nov;Dec&quot;, &quot;Jan;Feb;Mar;Oct;N…
## $ instanceID           &lt;chr&gt; &quot;uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef&quot;, &quot;uui…</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="programming.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reporting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": false,
    "twitter": false,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/kleuveld/r_cheatsheet/edit/main/chapters/03-datawrangling.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "none"
  }
});
});
</script>

</body>

</html>
