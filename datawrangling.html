<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Data Wrangling | R Cheat Sheet</title>
  <meta name="description" content="This page contains some quick R tips." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Data Wrangling | R Cheat Sheet" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains some quick R tips." />
  <meta name="github-repo" content="kleuveld/r_cheatsheet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Wrangling | R Cheat Sheet" />
  
  <meta name="twitter:description" content="This page contains some quick R tips." />
  

<meta name="author" content="Koen" />


<meta name="date" content="2024-01-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="reporting.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Cheat Sheet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i>Setting up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i>Data Wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#basic-data-manipulation"><i class="fa fa-check"></i>Basic Data Manipulation</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-or-reshaping"><i class="fa fa-check"></i>Pivoting (or reshaping)</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#creating-fake-data"><i class="fa fa-check"></i>Creating fake data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-long-to-wide"><i class="fa fa-check"></i>Pivoting long to wide</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-wide-to-long"><i class="fa fa-check"></i>Pivoting wide to long</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#joining-or-merging-data"><i class="fa fa-check"></i>Joining (or merging) data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#summarizing-over-groups-or-collapsing-data"><i class="fa fa-check"></i>Summarizing over groups (or collapsing data)</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#row-wise-operations"><i class="fa fa-check"></i>Row-wise Operations</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#splitting-multi-response-variable-into-dummies"><i class="fa fa-check"></i>Splitting multi-response variable into dummies</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#using-loops"><i class="fa fa-check"></i>Using loops</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#using-map-and-pmap"><i class="fa fa-check"></i>Using map() and pmap()</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#using-rowwise-mutate-and-unnest"><i class="fa fa-check"></i>Using rowwise(), mutate() and unnest()</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#using-separate_longer"><i class="fa fa-check"></i>Using separate_longer()</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i>Estimating and reporting</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#generating-some-fake-data"><i class="fa fa-check"></i>Generating some fake data</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#making-a-table-of-summary-statistics"><i class="fa fa-check"></i>Making a table of summary statistics</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#simple-regression"><i class="fa fa-check"></i>Simple regression</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#robust-standard-errors"><i class="fa fa-check"></i>Robust standard errors</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#exporting-to-word"><i class="fa fa-check"></i>Exporting to word</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html"><i class="fa fa-check"></i>Power Analysis using DeclareDesign</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#diff-in-diff"><i class="fa fa-check"></i>Diff-in-Diff</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#basic-structure"><i class="fa fa-check"></i>Basic structure</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#using-functions-in-a-pipe"><i class="fa fa-check"></i>Using functions in a pipe</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#passing-variables-to-a-function"><i class="fa fa-check"></i>Passing variables to a function</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#function-to-create-dummies-from-text"><i class="fa fa-check"></i>Function to create dummies from text</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Cheat Sheet</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datawrangling" class="section level1 hasAnchor">
<h1>Data Wrangling<a href="datawrangling.html#datawrangling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Make sure you have the <code>tidyverse</code> installed, and the SAFI data set
downloaded to your data folder by running the code from the <a href="index.html#setup">Set-up section</a></p>
<div id="basic-data-manipulation" class="section level2 hasAnchor">
<h2>Basic Data Manipulation<a href="datawrangling.html#basic-data-manipulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="datawrangling.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="datawrangling.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb2-3"><a href="datawrangling.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="datawrangling.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="datawrangling.html#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(village <span class="sc">==</span> <span class="st">&quot;Chirodzo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="datawrangling.html#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">people_per_room =</span> no_membrs <span class="sc">/</span> rooms,</span>
<span id="cb2-7"><a href="datawrangling.html#cb2-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">day =</span> <span class="fu">day</span>(interview_date),</span>
<span id="cb2-8"><a href="datawrangling.html#cb2-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">month =</span> <span class="fu">month</span>(interview_date),</span>
<span id="cb2-9"><a href="datawrangling.html#cb2-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">year =</span> <span class="fu">year</span>(interview_date)) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="datawrangling.html#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(key_ID<span class="sc">:</span>rooms, day<span class="sc">:</span>people_per_room, <span class="sc">-</span>village) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="datawrangling.html#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(interview_date <span class="sc">&gt;</span> <span class="st">&quot;2016-12-1&quot;</span> <span class="sc">&amp;</span> interview_date <span class="sc">&lt;</span> <span class="st">&#39;2017-01-01&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   key_ID interview_date      no_membrs years_liv respondent_wall_type rooms
##    &lt;dbl&gt; &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
## 1     10 2016-12-16 00:00:00        12        23 burntbricks              5
## # ℹ 2 more variables: day &lt;int&gt;, people_per_room &lt;dbl&gt;</code></pre>
</div>
<div id="pivoting-or-reshaping" class="section level2 hasAnchor">
<h2>Pivoting (or reshaping)<a href="datawrangling.html#pivoting-or-reshaping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In tidyverse, reshaping is called pivoting. Here’s how you
pivot a household roster (reshape wider) so you can merge
it with the household data.</p>
<div id="creating-fake-data" class="section level3 hasAnchor">
<h3>Creating fake data<a href="datawrangling.html#creating-fake-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, I create sa fake household roster, based on the SAFI data,
making sure that the household roster has a number of lines
for each household that is equal to the household size, and has two
randomly generated variables: <code>female</code> and <code>age</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="datawrangling.html#cb4-1" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> </span>
<span id="cb4-2"><a href="datawrangling.html#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="datawrangling.html#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(key_ID,no_membrs ) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="datawrangling.html#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">uncount</span>(no_membrs) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="datawrangling.html#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(key_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="datawrangling.html#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">member_ID =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="datawrangling.html#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="datawrangling.html#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">female =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb4-9"><a href="datawrangling.html#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">age =</span> <span class="fu">case_when</span>(member_ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">86</span>,<span class="dv">1</span>),</span>
<span id="cb4-10"><a href="datawrangling.html#cb4-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.default =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">86</span>,<span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="datawrangling.html#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb4-12"><a href="datawrangling.html#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="datawrangling.html#cb4-13" aria-hidden="true" tabindex="-1"></a>long_data</span></code></pre></div>
<pre><code>## # A tibble: 942 × 4
##    key_ID member_ID female   age
##     &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt;
##  1      1         1      0    81
##  2      1         2      1    45
##  3      1         3      0    43
##  4      2         1      0    80
##  5      2         2      1     7
##  6      2         3      1    15
##  7      2         4      1     4
##  8      2         5      1    61
##  9      2         6      1    15
## 10      2         7      0    83
## # ℹ 932 more rows</code></pre>
</div>
<div id="pivoting-long-to-wide" class="section level3 hasAnchor">
<h3>Pivoting long to wide<a href="datawrangling.html#pivoting-long-to-wide" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To merge this into our main data set, we need to make sure we go back to having 1 observation per household. We will do this by using <code>pivot_wider()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="datawrangling.html#cb6-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="datawrangling.html#cb6-2" aria-hidden="true" tabindex="-1"></a>    long_data <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="datawrangling.html#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> member_ID,</span>
<span id="cb6-4"><a href="datawrangling.html#cb6-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_from =</span> <span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_ID&quot;</span>))</span>
<span id="cb6-5"><a href="datawrangling.html#cb6-5" aria-hidden="true" tabindex="-1"></a>wide_data</span></code></pre></div>
<pre><code>## # A tibble: 131 × 39
##    key_ID female_1 female_2 female_3 female_4 female_5 female_6 female_7
##     &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
##  1      1        0        1        0       NA       NA       NA       NA
##  2      2        0        1        1        1        1        1        0
##  3      3        0        0        0        0        0        0        1
##  4      4        0        0        0        1        1        0        0
##  5      5        1        1        1        1        1        0        1
##  6      6        1        1        0       NA       NA       NA       NA
##  7      7        0        1        1        1        0        1       NA
##  8      8        0        1        0        1        0        1        0
##  9      9        0        0        1        1        1        1        1
## 10     10        0        0        0        0        0        0        0
## # ℹ 121 more rows
## # ℹ 31 more variables: female_8 &lt;int&gt;, female_9 &lt;int&gt;, female_10 &lt;int&gt;,
## #   female_11 &lt;int&gt;, female_12 &lt;int&gt;, female_13 &lt;int&gt;, female_14 &lt;int&gt;,
## #   female_15 &lt;int&gt;, female_16 &lt;int&gt;, female_17 &lt;int&gt;, female_18 &lt;int&gt;,
## #   female_19 &lt;int&gt;, age_1 &lt;int&gt;, age_2 &lt;int&gt;, age_3 &lt;int&gt;, age_4 &lt;int&gt;,
## #   age_5 &lt;int&gt;, age_6 &lt;int&gt;, age_7 &lt;int&gt;, age_8 &lt;int&gt;, age_9 &lt;int&gt;,
## #   age_10 &lt;int&gt;, age_11 &lt;int&gt;, age_12 &lt;int&gt;, age_13 &lt;int&gt;, age_14 &lt;int&gt;, …</code></pre>
<p>We only needed to specify two options:</p>
<ul>
<li>names_from: this is the column that contains the names (or usually numbers)
for each of our units of analysis. In this case, the <code>member_ID</code>.</li>
<li>values_from: the variables containing the data. All variables you specify here, will get one column for each possible value of names_from. In our case, these variables <code>female</code> and <code>age</code>. I used <a href="https://tidyr.tidyverse.org/reference/tidyr_tidy_select.html">tidy select syntax</a> to specify all variables except the ones ending in “_ID”.</li>
</ul>
</div>
<div id="pivoting-wide-to-long" class="section level3 hasAnchor">
<h3>Pivoting wide to long<a href="datawrangling.html#pivoting-wide-to-long" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we had started with wide data, and had wanted to transform to
long data, we’d have to use <code>pivot_longer()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="datawrangling.html#cb8-1" aria-hidden="true" tabindex="-1"></a>recreated_long_data <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="datawrangling.html#cb8-2" aria-hidden="true" tabindex="-1"></a>    wide_data <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="datawrangling.html#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">!</span>key_ID, </span>
<span id="cb8-4"><a href="datawrangling.html#cb8-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;member_ID&quot;</span>),</span>
<span id="cb8-5"><a href="datawrangling.html#cb8-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb8-6"><a href="datawrangling.html#cb8-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-7"><a href="datawrangling.html#cb8-7" aria-hidden="true" tabindex="-1"></a>long_data</span></code></pre></div>
<pre><code>## # A tibble: 942 × 4
##    key_ID member_ID female   age
##     &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt;
##  1      1         1      0    81
##  2      1         2      1    45
##  3      1         3      0    43
##  4      2         1      0    80
##  5      2         2      1     7
##  6      2         3      1    15
##  7      2         4      1     4
##  8      2         5      1    61
##  9      2         6      1    15
## 10      2         7      0    83
## # ℹ 932 more rows</code></pre>
<p>In this case, the syntax is a bit harder to understand than that of pivot wider. It’s good to think first what the original data looks like, and
how I intend to transform it. The wide data has columns key_ID, age_1-19 and female_1-19. I don’t really want to touch the key_ID
column. I want to turn the columns age_1-19 and female_1-19 into three columns: female, age and Member_ID, which contains the values 1-19. This translates to the options we passed to <code>pivot_longer()</code> as follows:</p>
<ul>
<li><code>!key_ID</code>: We want to pivot the data that’s in all columns except key_ID.</li>
<li><code>names_to = c(".value", "member_ID")</code>: this specifies the new columns we want to create. It basically says that the existing column names consist of two parts: one part (i.e. female and age) that we wish to keep as column names , and one part (i.e. the numbers 1-19) which should be put into a new column which we will “member_ID”.</li>
<li><code>"names_sep="</code>: this indicates how the two parts mentioned above are
separated. If there is no separator (for example your variables are called age1, age2, etc.) you’ll have to use the<code>names_pattern</code> option.</li>
<li><code>values_drop_na = TRUE</code>: tells R to drop rows that have missing data for
all variables. If we had set this to FALSE, we’d have 19 rows for each
household, with a lot of missing data in all households smaller than 19 people.</li>
</ul>
</div>
</div>
<div id="joining-or-merging-data" class="section level2 hasAnchor">
<h2>Joining (or merging) data<a href="datawrangling.html#joining-or-merging-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Tidyverse has four functions to join (or merge, as Stata calls it) two
data sets. The functions that differ in the way they treat observations that are in one data set but not the other.
Consider the diagram below.
It has two data sets, <code>x</code> (in Stata terms, this is the master data set) and <code>y</code> (the using
data set in Stata terms). They have overlapping rows (area B), but also
rows that are only in <code>x</code> (area A) or only in <code>y</code> (area C).</p>
<p><img src="images/join_venn.png" /></p>
<p>The four join functions work as follows:</p>
<ul>
<li><code>inner_join()</code> will only keep area B.</li>
<li><code>left_join()</code> will keep areas A and B.</li>
<li><code>right_join()</code> will keep areas B and C.</li>
<li><code>full_join()</code> will keep areas A, B, and C.</li>
</ul>
<p>In our case, the data sets match perfectly, i.e. we only have an area B, so there is no practical difference. I chose <code>left_join()</code> so the number of
observations in my household survey is guaranteed to remain the same.
To merge the roster to the household data, we use the join_by function:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="datawrangling.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="datawrangling.html#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(wide_data)</span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Joining with `by = join_by(key_ID)`</code></pre>
<pre><code>## # A tibble: 131 × 52
##    key_ID village  interview_date      no_membrs years_liv respondent_wall_type
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
##  1      1 God      2016-11-17 00:00:00         3         4 muddaub             
##  2      2 God      2016-11-17 00:00:00         7         9 muddaub             
##  3      3 God      2016-11-17 00:00:00        10        15 burntbricks         
##  4      4 God      2016-11-17 00:00:00         7         6 burntbricks         
##  5      5 God      2016-11-17 00:00:00         7        40 burntbricks         
##  6      6 God      2016-11-17 00:00:00         3         3 muddaub             
##  7      7 God      2016-11-17 00:00:00         6        38 muddaub             
##  8      8 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
##  9      9 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
## 10     10 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
## # ℹ 121 more rows
## # ℹ 46 more variables: rooms &lt;dbl&gt;, memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
## #   liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;,
## #   instanceID &lt;chr&gt;, female_1 &lt;int&gt;, female_2 &lt;int&gt;, female_3 &lt;int&gt;,
## #   female_4 &lt;int&gt;, female_5 &lt;int&gt;, female_6 &lt;int&gt;, female_7 &lt;int&gt;,
## #   female_8 &lt;int&gt;, female_9 &lt;int&gt;, female_10 &lt;int&gt;, female_11 &lt;int&gt;,
## #   female_12 &lt;int&gt;, female_13 &lt;int&gt;, female_14 &lt;int&gt;, female_15 &lt;int&gt;, …</code></pre>
<p>Note that we didn’t specify identifiers, like we would in Stata. R
assumed that the variables that appear in both data frames are the
identifiers, in this case <code>key_ID</code>. Use the <code>by</code> option to change this.</p>
<p>Going the other way around, joining the household data to the
roster data, is equally easy:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="datawrangling.html#cb13-1" aria-hidden="true" tabindex="-1"></a>long_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="datawrangling.html#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb13-3"><a href="datawrangling.html#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="datawrangling.html#cb13-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(key_ID,village,interview_date))</span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
## Joining with `by = join_by(key_ID)`</code></pre>
<pre><code>## # A tibble: 942 × 6
##    key_ID member_ID female   age village interview_date     
##     &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;dttm&gt;             
##  1      1         1      0    81 God     2016-11-17 00:00:00
##  2      1         2      1    45 God     2016-11-17 00:00:00
##  3      1         3      0    43 God     2016-11-17 00:00:00
##  4      2         1      0    80 God     2016-11-17 00:00:00
##  5      2         2      1     7 God     2016-11-17 00:00:00
##  6      2         3      1    15 God     2016-11-17 00:00:00
##  7      2         4      1     4 God     2016-11-17 00:00:00
##  8      2         5      1    61 God     2016-11-17 00:00:00
##  9      2         6      1    15 God     2016-11-17 00:00:00
## 10      2         7      0    83 God     2016-11-17 00:00:00
## # ℹ 932 more rows</code></pre>
<p>Note that here I only merged in two variables, by using <code>select</code> and a pipe within the <code>left_join()</code> function.</p>
</div>
<div id="summarizing-over-groups-or-collapsing-data" class="section level2 hasAnchor">
<h2>Summarizing over groups (or collapsing data)<a href="datawrangling.html#summarizing-over-groups-or-collapsing-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To compute summary statistics (sums, counts, means etc.) over a group,
we use the <code>group_by()</code> and <code>summarize()</code> functions. For example, to
compute the household size, number of women and average age in each household:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="datawrangling.html#cb16-1" aria-hidden="true" tabindex="-1"></a>long_data <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="datawrangling.html#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(key_ID) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="datawrangling.html#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">hh_size =</span> <span class="fu">n</span>(), <span class="at">num_women =</span> <span class="fu">sum</span>(female), <span class="at">mean_age =</span> <span class="fu">mean</span>(age))    </span></code></pre></div>
<pre><code>## # A tibble: 131 × 4
##    key_ID hh_size num_women mean_age
##     &lt;dbl&gt;   &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1      1       3         1     56.3
##  2      2       7         5     37.9
##  3      3      10         4     49  
##  4      4       7         2     49.6
##  5      5       7         6     44.1
##  6      6       3         2     38.7
##  7      7       6         4     34.7
##  8      8      12         4     56.6
##  9      9       8         6     41  
## 10     10      12         2     46.5
## # ℹ 121 more rows</code></pre>
</div>
<div id="row-wise-operations" class="section level2 hasAnchor">
<h2>Row-wise Operations<a href="datawrangling.html#row-wise-operations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose we wanted to run an operation over multiple variables. For example to
get the household size, number of women and average age. The easiest,
and probably best, way to do this in R is by reshaping to long, and the use
summarize, like we did above. But in Stata you would probably use some sort of
<code>egen</code> function, so that may come natural.
You can do similar things in R. It’s just a bit more complex than in Stata:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="datawrangling.html#cb18-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="datawrangling.html#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="datawrangling.html#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;age_&quot;</span>)),</span>
<span id="cb18-4"><a href="datawrangling.html#cb18-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb18-5"><a href="datawrangling.html#cb18-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_women =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;female_&quot;</span>)),</span>
<span id="cb18-6"><a href="datawrangling.html#cb18-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb18-7"><a href="datawrangling.html#cb18-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">hh_size =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;female_&quot;</span>))),</span>
<span id="cb18-8"><a href="datawrangling.html#cb18-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="datawrangling.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(key_ID,hh_size,num_women,mean_age) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="datawrangling.html#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 131 × 4
##    key_ID hh_size num_women mean_age
##     &lt;dbl&gt;   &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1      1       3         1     56.3
##  2      2       7         5     37.9
##  3      3      10         4     49  
##  4      4       7         2     49.6
##  5      5       7         6     44.1
##  6      6       3         2     38.7
##  7      7       6         4     34.7
##  8      8      12         4     56.6
##  9      9       8         6     41  
## 10     10      12         2     46.5
## # ℹ 121 more rows</code></pre>
<p>The key trick here is the combination of <code>rowwise()</code> and <code>c_across()</code>.
<code>rowwise()</code> ensure all summaries are computed per row, and <code>c_across()</code>
allows you to use <a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html">tidy select</a> syntax within the <code>mean()</code> and <code>sum()</code> functions.
<code>sum(!is.na())</code> simply counts the non-missing values.</p>
</div>
<div id="splitting-multi-response-variable-into-dummies" class="section level2 hasAnchor">
<h2>Splitting multi-response variable into dummies<a href="datawrangling.html#splitting-multi-response-variable-into-dummies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The SAFI data contains a number of columns that contain all responses selected
in a multiple response questions. For example, the variables <code>items_owned</code> can
contain something like <code>"bicycle;television;solar_panel;table"</code>. We want to
split this into dummies: one for each possible answers. There’s a number of
ways to do this:</p>
<p>First, you can use <code>str_count()</code> for each possible answer:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="datawrangling.html#cb20-1" aria-hidden="true" tabindex="-1"></a>split_without_loop <span class="ot">&lt;-</span> </span>
<span id="cb20-2"><a href="datawrangling.html#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="datawrangling.html#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(items_owned) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="datawrangling.html#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">owns_bicycle =</span> <span class="fu">str_count</span>(.data<span class="sc">$</span>items_owned,<span class="st">&quot;bicycle&quot;</span>), </span>
<span id="cb20-5"><a href="datawrangling.html#cb20-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">owns_television =</span> <span class="fu">str_count</span>(.data<span class="sc">$</span>items_owned,<span class="st">&quot;television&quot;</span>)) </span>
<span id="cb20-6"><a href="datawrangling.html#cb20-6" aria-hidden="true" tabindex="-1"></a>           <span class="co">#etc etc.</span></span>
<span id="cb20-7"><a href="datawrangling.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="datawrangling.html#cb20-8" aria-hidden="true" tabindex="-1"></a>split_without_loop</span></code></pre></div>
<pre><code>## # A tibble: 131 × 3
##    items_owned                                      owns_bicycle owns_television
##    &lt;chr&gt;                                                   &lt;int&gt;           &lt;int&gt;
##  1 bicycle;television;solar_panel;table                        1               1
##  2 cow_cart;bicycle;radio;cow_plough;solar_panel;s…            1               0
##  3 solar_torch                                                 0               0
##  4 bicycle;radio;cow_plough;solar_panel;mobile_pho…            1               0
##  5 motorcyle;radio;cow_plough;mobile_phone                     0               0
##  6 &lt;NA&gt;                                                       NA              NA
##  7 motorcyle;cow_plough                                        0               0
##  8 motorcyle;bicycle;television;radio;cow_plough;s…            1               1
##  9 television;solar_panel;solar_torch                          0               1
## 10 cow_cart;motorcyle;bicycle;television;radio;cow…            1               1
## # ℹ 121 more rows</code></pre>
<div id="using-loops" class="section level3 hasAnchor">
<h3>Using loops<a href="datawrangling.html#using-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This gets extremely tedious, better to put everything in a loop:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="datawrangling.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define the vector to loop over</span></span>
<span id="cb22-2"><a href="datawrangling.html#cb22-2" aria-hidden="true" tabindex="-1"></a>items <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;bicycle&quot;</span>,<span class="st">&quot;television&quot;</span>,<span class="st">&quot;solar_panel&quot;</span>,<span class="st">&quot;table&quot;</span>,<span class="st">&quot;cow_cart&quot;</span>,<span class="st">&quot;radio&quot;</span>,</span>
<span id="cb22-3"><a href="datawrangling.html#cb22-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;cow_plough&quot;</span>,<span class="st">&quot;solar_torch&quot;</span>,<span class="st">&quot;mobile_phone&quot;</span>,<span class="st">&quot;motor_cycle&quot;</span>,<span class="st">&quot;fridge&quot;</span>,</span>
<span id="cb22-4"><a href="datawrangling.html#cb22-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;electricity&quot;</span>,<span class="st">&quot;sofa_set&quot;</span>,<span class="st">&quot;lorry&quot;</span>,<span class="st">&quot;sterio&quot;</span>,<span class="st">&quot;computer&quot;</span>,<span class="st">&quot;car&quot;</span>)</span>
<span id="cb22-5"><a href="datawrangling.html#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="datawrangling.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare the data</span></span>
<span id="cb22-7"><a href="datawrangling.html#cb22-7" aria-hidden="true" tabindex="-1"></a>split_with_loop <span class="ot">&lt;-</span> </span>
<span id="cb22-8"><a href="datawrangling.html#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="datawrangling.html#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(items_owned)</span>
<span id="cb22-10"><a href="datawrangling.html#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="datawrangling.html#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#and add to the data each iteration of a loop</span></span>
<span id="cb22-12"><a href="datawrangling.html#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> items){</span>
<span id="cb22-13"><a href="datawrangling.html#cb22-13" aria-hidden="true" tabindex="-1"></a>    split_with_loop <span class="ot">&lt;-</span></span>
<span id="cb22-14"><a href="datawrangling.html#cb22-14" aria-hidden="true" tabindex="-1"></a>        split_with_loop <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="datawrangling.html#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="st">&quot;owns_{i}&quot;</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">str_count</span>(.data<span class="sc">$</span>items_owned,i))</span>
<span id="cb22-16"><a href="datawrangling.html#cb22-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-17"><a href="datawrangling.html#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="datawrangling.html#cb22-18" aria-hidden="true" tabindex="-1"></a>split_with_loop</span></code></pre></div>
<pre><code>## # A tibble: 131 × 18
##    items_owned          owns_bicycle owns_television owns_solar_panel owns_table
##    &lt;chr&gt;                       &lt;int&gt;           &lt;int&gt;            &lt;int&gt;      &lt;int&gt;
##  1 bicycle;television;…            1               1                1          1
##  2 cow_cart;bicycle;ra…            1               0                1          1
##  3 solar_torch                     0               0                0          0
##  4 bicycle;radio;cow_p…            1               0                1          0
##  5 motorcyle;radio;cow…            0               0                0          0
##  6 &lt;NA&gt;                           NA              NA               NA         NA
##  7 motorcyle;cow_plough            0               0                0          0
##  8 motorcyle;bicycle;t…            1               1                1          1
##  9 television;solar_pa…            0               1                1          0
## 10 cow_cart;motorcyle;…            1               1                1          1
## # ℹ 121 more rows
## # ℹ 13 more variables: owns_cow_cart &lt;int&gt;, owns_radio &lt;int&gt;,
## #   owns_cow_plough &lt;int&gt;, owns_solar_torch &lt;int&gt;, owns_mobile_phone &lt;int&gt;,
## #   owns_motor_cycle &lt;int&gt;, owns_fridge &lt;int&gt;, owns_electricity &lt;int&gt;,
## #   owns_sofa_set &lt;int&gt;, owns_lorry &lt;int&gt;, owns_sterio &lt;int&gt;,
## #   owns_computer &lt;int&gt;, owns_car &lt;int&gt;</code></pre>
<p>Note how we used <code>"owns_{i}" :=</code> to dynamically create variable names in the <code>mutate()</code> function.</p>
</div>
<div id="using-map-and-pmap" class="section level3 hasAnchor">
<h3>Using map() and pmap()<a href="datawrangling.html#using-map-and-pmap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Loops have the reputation of being slow, so if performance is important
you can also use
<code>map()</code> to repeat a function for every element in a vector. It returns a list
where each list item is the output of one iteration (i.e. one new column):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="datawrangling.html#cb24-1" aria-hidden="true" tabindex="-1"></a>split_with_map <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="datawrangling.html#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>)</span>
<span id="cb24-3"><a href="datawrangling.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="datawrangling.html#cb24-4" aria-hidden="true" tabindex="-1"></a>items <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="datawrangling.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) <span class="fu">str_count</span>(split_with_map<span class="sc">$</span>items_owned,x))<span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="datawrangling.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
##   [1]  1  1  0  1  0 NA  0  1  0  1  0  1  1  1  1  0  0  1  1  1 NA  0  1  0  0
##  [26]  0  1 NA  1  1 NA  0  0  0  1  1  1  1 NA  1  1  0  0  0  1  0  0  0  1  0
##  [51]  0  0  1 NA  0  1  0  1 NA  0  1  1 NA  1  0  1  0  0  1  1  0  0  1  1 NA
##  [76]  0  0  0  0  1  0  0  1  1  0  1 NA  1  0  1  1  1  0  0  1  1  0  0  0  1
## [101]  1  0  1  1  1  1  0  1  1  1  1  1  0  0  0  0  0  0  1  1  0  0  1  0  0
## [126]  1  0  0  0  0  0
## 
## [[2]]
##   [1]  1  0  0  0  0 NA  0  1  1  1  0  0  0  0  0  0  0  0  0  0 NA  0  1  0  1
##  [26]  0  0 NA  0  0 NA  0  0  1  0  0  1  0 NA  0  0  0  0  0  1  1  0  0  0  0
##  [51]  0  1  0 NA  1  0  0  1 NA  0  1  0 NA  0  0  1  0  1  0  0  0  0  1  0 NA
##  [76]  0  0  1  0  1  0  0  1  0  0  1 NA  0  0  0  1  0  0  0  0  0  0  0  0  0
## [101]  0  0  0  0  0  0  0  0  0  1  0  1  1  1  1  0  0  0  1  0  0  0  0  0  0
## [126]  1  0  1  0  1  0</code></pre>
<p>A list isn’t really great in this case. <code>map_df()</code> returns its
items as columns in a dataframe. For this
to work, I make sure the vector has names, which will then become
the column names:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="datawrangling.html#cb26-1" aria-hidden="true" tabindex="-1"></a>items <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="datawrangling.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste0</span>(<span class="st">&quot;owns_&quot;</span>,items)) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="datawrangling.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_df</span>(\(x) <span class="fu">str_count</span>(split_with_map<span class="sc">$</span>items_owned,x)) </span></code></pre></div>
<pre><code>## # A tibble: 131 × 17
##    owns_bicycle owns_television owns_solar_panel owns_table owns_cow_cart
##           &lt;int&gt;           &lt;int&gt;            &lt;int&gt;      &lt;int&gt;         &lt;int&gt;
##  1            1               1                1          1             0
##  2            1               0                1          1             1
##  3            0               0                0          0             0
##  4            1               0                1          0             0
##  5            0               0                0          0             0
##  6           NA              NA               NA         NA            NA
##  7            0               0                0          0             0
##  8            1               1                1          1             0
##  9            0               1                1          0             0
## 10            1               1                1          1             1
## # ℹ 121 more rows
## # ℹ 12 more variables: owns_radio &lt;int&gt;, owns_cow_plough &lt;int&gt;,
## #   owns_solar_torch &lt;int&gt;, owns_mobile_phone &lt;int&gt;, owns_motor_cycle &lt;int&gt;,
## #   owns_fridge &lt;int&gt;, owns_electricity &lt;int&gt;, owns_sofa_set &lt;int&gt;,
## #   owns_lorry &lt;int&gt;, owns_sterio &lt;int&gt;, owns_computer &lt;int&gt;, owns_car &lt;int&gt;</code></pre>
<p>One problem is our pipe started with <code>items</code>, making it a bit more difficult to
use this is a data management pipeline. To solve this, you can also iterate
over the rows in a data frame using <code>pmap()</code>, so that each element in our
list is a row:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="datawrangling.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="datawrangling.html#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pmap</span>(\(items_owned, ...) <span class="fu">str_count</span>(items_owned,items)) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="datawrangling.html#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
##  [1] 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0
## 
## [[2]]
##  [1] 1 0 1 1 1 1 1 1 1 0 0 0 0 0 0 0 1</code></pre>
<p>Note that pmap passes all variables in the data frame as arguments to the function. Here,
I only need <code>items_owned</code>, so I capture all unneeded variables with <code>...</code>.</p>
<p>To bind this together to a data frame, I need to make sure that the output
of each iteration of <code>pmap()</code> is a row with <code>as_tibble_row()</code>, using its
<code>.name_repair</code> option to assing names in the same way I did to the <code>items</code>
vector above.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="datawrangling.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="datawrangling.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap_dfr</span>(\(items_owned, ...) </span>
<span id="cb30-3"><a href="datawrangling.html#cb30-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_count</span>(items_owned,items) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="datawrangling.html#cb30-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as_tibble_row</span>(<span class="at">.name_repair =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;owns_&quot;</span>,items)))</span></code></pre></div>
<pre><code>## # A tibble: 131 × 17
##    owns_bicycle owns_television owns_solar_panel owns_table owns_cow_cart
##           &lt;int&gt;           &lt;int&gt;            &lt;int&gt;      &lt;int&gt;         &lt;int&gt;
##  1            1               1                1          1             0
##  2            1               0                1          1             1
##  3            0               0                0          0             0
##  4            1               0                1          0             0
##  5            0               0                0          0             0
##  6           NA              NA               NA         NA            NA
##  7            0               0                0          0             0
##  8            1               1                1          1             0
##  9            0               1                1          0             0
## 10            1               1                1          1             1
## # ℹ 121 more rows
## # ℹ 12 more variables: owns_radio &lt;int&gt;, owns_cow_plough &lt;int&gt;,
## #   owns_solar_torch &lt;int&gt;, owns_mobile_phone &lt;int&gt;, owns_motor_cycle &lt;int&gt;,
## #   owns_fridge &lt;int&gt;, owns_electricity &lt;int&gt;, owns_sofa_set &lt;int&gt;,
## #   owns_lorry &lt;int&gt;, owns_sterio &lt;int&gt;, owns_computer &lt;int&gt;, owns_car &lt;int&gt;</code></pre>
</div>
<div id="using-rowwise-mutate-and-unnest" class="section level3 hasAnchor">
<h3>Using rowwise(), mutate() and unnest()<a href="datawrangling.html#using-rowwise-mutate-and-unnest" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While <code>map()</code> is faster, you can use <code>mutate()</code>
to nest a data set into a variable. That, combined with
<code>as_tibble_row()</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="datawrangling.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="datawrangling.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="datawrangling.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">as_tibble_row</span>(<span class="fu">str_count</span>(items_owned,items),</span>
<span id="cb32-4"><a href="datawrangling.html#cb32-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">.name_repair =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;owns_&quot;</span>,</span>
<span id="cb32-5"><a href="datawrangling.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                                                  items))) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="datawrangling.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols=</span><span class="fu">c</span>(x))</span></code></pre></div>
<pre><code>## # A tibble: 131 × 31
##    key_ID village  interview_date      no_membrs years_liv respondent_wall_type
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
##  1      1 God      2016-11-17 00:00:00         3         4 muddaub             
##  2      2 God      2016-11-17 00:00:00         7         9 muddaub             
##  3      3 God      2016-11-17 00:00:00        10        15 burntbricks         
##  4      4 God      2016-11-17 00:00:00         7         6 burntbricks         
##  5      5 God      2016-11-17 00:00:00         7        40 burntbricks         
##  6      6 God      2016-11-17 00:00:00         3         3 muddaub             
##  7      7 God      2016-11-17 00:00:00         6        38 muddaub             
##  8      8 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
##  9      9 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
## 10     10 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
## # ℹ 121 more rows
## # ℹ 25 more variables: rooms &lt;dbl&gt;, memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
## #   liv_count &lt;dbl&gt;, items_owned &lt;chr&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;,
## #   instanceID &lt;chr&gt;, owns_bicycle &lt;int&gt;, owns_television &lt;int&gt;,
## #   owns_solar_panel &lt;int&gt;, owns_table &lt;int&gt;, owns_cow_cart &lt;int&gt;,
## #   owns_radio &lt;int&gt;, owns_cow_plough &lt;int&gt;, owns_solar_torch &lt;int&gt;,
## #   owns_mobile_phone &lt;int&gt;, owns_motor_cycle &lt;int&gt;, owns_fridge &lt;int&gt;, …</code></pre>
</div>
<div id="using-separate_longer" class="section level3 hasAnchor">
<h3>Using separate_longer()<a href="datawrangling.html#using-separate_longer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If writing a vector with possible values is too tedious/error prone/impossible:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="datawrangling.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="datawrangling.html#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_longer_delim</span>(items_owned, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="datawrangling.html#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="datawrangling.html#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> items_owned,</span>
<span id="cb34-5"><a href="datawrangling.html#cb34-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_from =</span> value,</span>
<span id="cb34-6"><a href="datawrangling.html#cb34-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_glue =</span> <span class="st">&quot;owns_{items_owned}&quot;</span>,</span>
<span id="cb34-7"><a href="datawrangling.html#cb34-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_fill =</span> <span class="dv">0</span>) </span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 131 × 31
##    key_ID village  interview_date      no_membrs years_liv respondent_wall_type
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
##  1      1 God      2016-11-17 00:00:00         3         4 muddaub             
##  2      2 God      2016-11-17 00:00:00         7         9 muddaub             
##  3      3 God      2016-11-17 00:00:00        10        15 burntbricks         
##  4      4 God      2016-11-17 00:00:00         7         6 burntbricks         
##  5      5 God      2016-11-17 00:00:00         7        40 burntbricks         
##  6      6 God      2016-11-17 00:00:00         3         3 muddaub             
##  7      7 God      2016-11-17 00:00:00         6        38 muddaub             
##  8      8 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
##  9      9 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
## 10     10 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
## # ℹ 121 more rows
## # ℹ 25 more variables: rooms &lt;dbl&gt;, memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
## #   liv_count &lt;dbl&gt;, no_meals &lt;dbl&gt;, months_lack_food &lt;chr&gt;, instanceID &lt;chr&gt;,
## #   owns_bicycle &lt;dbl&gt;, owns_television &lt;dbl&gt;, owns_solar_panel &lt;dbl&gt;,
## #   owns_table &lt;dbl&gt;, owns_cow_cart &lt;dbl&gt;, owns_radio &lt;dbl&gt;,
## #   owns_cow_plough &lt;dbl&gt;, owns_solar_torch &lt;dbl&gt;, owns_mobile_phone &lt;dbl&gt;,
## #   owns_motorcyle &lt;dbl&gt;, owns_NA &lt;dbl&gt;, owns_fridge &lt;dbl&gt;, …</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reporting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/kleuveld/r_cheatsheet/edit/main/chapters/02-datawrangling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
