<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Power Analysis using DeclareDesign | R Cheat Sheet</title>
  <meta name="description" content="This page contains some quick R tips." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Power Analysis using DeclareDesign | R Cheat Sheet" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains some quick R tips." />
  <meta name="github-repo" content="kleuveld/r_cheatsheet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Power Analysis using DeclareDesign | R Cheat Sheet" />
  
  <meta name="twitter:description" content="This page contains some quick R tips." />
  

<meta name="author" content="Koen" />


<meta name="date" content="2024-01-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estimating-and-reporting.html"/>
<link rel="next" href="functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Cheat Sheet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="setting-up.html"><a href="setting-up.html"><i class="fa fa-check"></i><b>2</b> Setting up</a></li>
<li class="chapter" data-level="3" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>3</b> Data Wrangling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-wrangling.html"><a href="data-wrangling.html#basic-data-manipulation"><i class="fa fa-check"></i><b>3.1</b> Basic Data Manipulation</a></li>
<li class="chapter" data-level="3.2" data-path="data-wrangling.html"><a href="data-wrangling.html#pivoting-or-reshaping"><i class="fa fa-check"></i><b>3.2</b> Pivoting (or reshaping)</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-wrangling.html"><a href="data-wrangling.html#creating-fake-data"><i class="fa fa-check"></i><b>3.2.1</b> Creating fake data</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-wrangling.html"><a href="data-wrangling.html#pivoting-long-to-wide"><i class="fa fa-check"></i><b>3.2.2</b> Pivoting long to wide</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-wrangling.html"><a href="data-wrangling.html#pivoting-wide-to-long"><i class="fa fa-check"></i><b>3.2.3</b> Pivoting wide to long</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-wrangling.html"><a href="data-wrangling.html#joining-or-merging-data"><i class="fa fa-check"></i><b>3.3</b> Joining (or merging) data</a></li>
<li class="chapter" data-level="3.4" data-path="data-wrangling.html"><a href="data-wrangling.html#summarizing-over-groups-or-collapsing-data"><i class="fa fa-check"></i><b>3.4</b> Summarizing over groups (or collapsing data)</a></li>
<li class="chapter" data-level="3.5" data-path="data-wrangling.html"><a href="data-wrangling.html#advanced-stuff"><i class="fa fa-check"></i><b>3.5</b> Advanced stuff</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="data-wrangling.html"><a href="data-wrangling.html#row-wise-operations"><i class="fa fa-check"></i><b>3.5.1</b> Row Wise Operations</a></li>
<li class="chapter" data-level="3.5.2" data-path="data-wrangling.html"><a href="data-wrangling.html#splitting-multi-response-variable-into-dummies"><i class="fa fa-check"></i><b>3.5.2</b> Splitting multi-response variable into dummies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="estimating-and-reporting.html"><a href="estimating-and-reporting.html"><i class="fa fa-check"></i><b>4</b> Estimating and reporting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="estimating-and-reporting.html"><a href="estimating-and-reporting.html#generating-some-fake-data"><i class="fa fa-check"></i><b>4.1</b> Generating some fake data</a></li>
<li class="chapter" data-level="4.2" data-path="estimating-and-reporting.html"><a href="estimating-and-reporting.html#making-a-table-of-summary-statistics"><i class="fa fa-check"></i><b>4.2</b> Making a table of summary statistics</a></li>
<li class="chapter" data-level="4.3" data-path="estimating-and-reporting.html"><a href="estimating-and-reporting.html#simple-regression"><i class="fa fa-check"></i><b>4.3</b> Simple regression</a></li>
<li class="chapter" data-level="4.4" data-path="estimating-and-reporting.html"><a href="estimating-and-reporting.html#robust-standard-errors"><i class="fa fa-check"></i><b>4.4</b> Robust standard errors</a></li>
<li class="chapter" data-level="4.5" data-path="estimating-and-reporting.html"><a href="estimating-and-reporting.html#exporting-to-word"><i class="fa fa-check"></i><b>4.5</b> Exporting to word</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="power-analysis-using-declaredesign.html"><a href="power-analysis-using-declaredesign.html"><i class="fa fa-check"></i><b>5</b> Power Analysis using DeclareDesign</a>
<ul>
<li class="chapter" data-level="5.1" data-path="power-analysis-using-declaredesign.html"><a href="power-analysis-using-declaredesign.html#diff-in-diff"><i class="fa fa-check"></i><b>5.1</b> Diff-in-Diff</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="functions.html"><a href="functions.html#basic-structure"><i class="fa fa-check"></i><b>6.1</b> Basic structure</a></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#using-functions-in-a-pipe"><i class="fa fa-check"></i><b>6.2</b> Using functions in a pipe</a></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#passing-variables-to-a-function"><i class="fa fa-check"></i><b>6.3</b> Passing variables to a function</a></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#function-to-create-dummies-from-text"><i class="fa fa-check"></i><b>6.4</b> Function to create dummies from text</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Cheat Sheet</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="power-analysis-using-declaredesign" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Power Analysis using DeclareDesign<a href="power-analysis-using-declaredesign.html#power-analysis-using-declaredesign" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="https://declaredesign.org/">DeclareDesign</a> is a system to simulate Research Designs. This is useful for power
analysis, because it is often hard to include things like clustering and
covariates in standard power calculators.</p>
<p>Resources for learning about DeclareDesign:</p>
<ul>
<li><a href="https://macartan.github.io/slides/202211_declaredesign_and_power.html">Slides by the authors of DeclareDesign: Graeme Blair, Alex Coppock, Macartan Humphreys</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/declaredesign.pdf">The DeclareDesign CheatSheet</a></li>
<li>The book <a href="https://book.declaredesign.org/">Research Design in the Social Sciences: Declaration, Diagnosis, and Redesign</a></li>
</ul>
<p>Read at least the slides before going forward!</p>
<div id="diff-in-diff" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Diff-in-Diff<a href="power-analysis-using-declaredesign.html#diff-in-diff" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here’s a common situation: I’ve collected some baseline data, and are
wondering if our study has sufficient power to pick up expected treatment
effects.</p>
<p>I will start off with some fake baseline data, which only contains <code>y0</code>, our outcome
indicator. We use the <code>fabricate()</code> function, from the fabricatr library, which is
loaded with DeclareDesign:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="power-analysis-using-declaredesign.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb43-2"><a href="power-analysis-using-declaredesign.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DeclareDesign)</span></code></pre></div>
<pre><code>## Error in library(DeclareDesign): there is no package called &#39;DeclareDesign&#39;</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="power-analysis-using-declaredesign.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb45-2"><a href="power-analysis-using-declaredesign.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb45-3"><a href="power-analysis-using-declaredesign.html#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="power-analysis-using-declaredesign.html#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="power-analysis-using-declaredesign.html#cb45-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb45-6"><a href="power-analysis-using-declaredesign.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="power-analysis-using-declaredesign.html#cb45-7" aria-hidden="true" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span></span>
<span id="cb45-8"><a href="power-analysis-using-declaredesign.html#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fabricate</span>(<span class="at">N =</span> N, </span>
<span id="cb45-9"><a href="power-analysis-using-declaredesign.html#cb45-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">y0 =</span> <span class="fu">runif</span>(N, <span class="dv">100</span>, <span class="dv">150</span>))</span></code></pre></div>
<pre><code>## Error in fabricate(N = N, y0 = runif(N, 100, 150)): could not find function &quot;fabricate&quot;</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="power-analysis-using-declaredesign.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fake_data)</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;fake_data&#39; not found</code></pre>
<p>Now, let’s add an extra year to our data, again using <code>fabricate()</code>, just
to demonstrate how, using <code>add_level()</code> and then <code>crosslevels()</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="power-analysis-using-declaredesign.html#cb49-1" aria-hidden="true" tabindex="-1"></a>fakedata_years <span class="ot">&lt;-</span></span>
<span id="cb49-2"><a href="power-analysis-using-declaredesign.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fabricate</span>(fake_data,</span>
<span id="cb49-3"><a href="power-analysis-using-declaredesign.html#cb49-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">years =</span> <span class="fu">add_level</span>(<span class="at">N =</span> <span class="dv">2</span>, <span class="at">t =</span> <span class="fu">as.numeric</span>(years) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">nest=</span><span class="cn">FALSE</span>),</span>
<span id="cb49-4"><a href="power-analysis-using-declaredesign.html#cb49-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">observations =</span> <span class="fu">cross_levels</span>(<span class="at">by =</span> <span class="fu">join_using</span>(ID, years)))</span></code></pre></div>
<pre><code>## Error in fabricate(fake_data, years = add_level(N = 2, t = as.numeric(years) - : could not find function &quot;fabricate&quot;</code></pre>
<p>Now it’s time to start declaring our design. The first element of the
design is the model, which essentially is my data, and I declare it
using the same synytax as <code>fabricate()</code>
above. This means you can input existing data, but also generate
random new variables.</p>
<p>The potential outcomes are generated using the <code>potential_outcomes()</code>.
This will create two variables <code>Y_Z_1</code> and <code>Y_Z_0</code>, which are
the potential outcomes if assigned to treatment (<code>Z == 1</code>) or not.</p>
<p>You can see I have created a very simple data generating
process to generate different outcomes in <code>t = 1</code> for treatment
and control, but you can go absolutely wild here to check the
assumptions you have: you can cluster the outcomes, include
compliance or treatment effectiveness, add more or less noise,
make it depend on both observable and unobservable
characteristics, etc. etc.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="power-analysis-using-declaredesign.html#cb51-1" aria-hidden="true" tabindex="-1"></a>year_shock <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb51-2"><a href="power-analysis-using-declaredesign.html#cb51-2" aria-hidden="true" tabindex="-1"></a>effect_size <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb51-3"><a href="power-analysis-using-declaredesign.html#cb51-3" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb51-4"><a href="power-analysis-using-declaredesign.html#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="power-analysis-using-declaredesign.html#cb51-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> </span>
<span id="cb51-6"><a href="power-analysis-using-declaredesign.html#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">declare_model</span>(fakedata_years,</span>
<span id="cb51-7"><a href="power-analysis-using-declaredesign.html#cb51-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">potential_outcomes</span>(Y <span class="sc">~</span> y0 <span class="sc">+</span> t <span class="sc">*</span> year_shock <span class="sc">+</span> </span>
<span id="cb51-8"><a href="power-analysis-using-declaredesign.html#cb51-8" aria-hidden="true" tabindex="-1"></a>                                       t <span class="sc">*</span> Z <span class="sc">*</span> effect_size <span class="sc">+</span> </span>
<span id="cb51-9"><a href="power-analysis-using-declaredesign.html#cb51-9" aria-hidden="true" tabindex="-1"></a>                                       t <span class="sc">*</span> <span class="fu">rnorm</span>(N,<span class="at">sd =</span> sd)))</span></code></pre></div>
<pre><code>## Error in declare_model(fakedata_years, potential_outcomes(Y ~ y0 + t * : could not find function &quot;declare_model&quot;</code></pre>
<p>Then it’s time to think about assignment. I need to assign treatment,
and reveal the outcomes based on treatment assignment.
If treatment had already been known during baseline (not
unlikely) then we would have only had to reveal the outcomes:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="power-analysis-using-declaredesign.html#cb53-1" aria-hidden="true" tabindex="-1"></a>assignment <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="power-analysis-using-declaredesign.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">declare_assignment</span>(<span class="at">Z =</span> <span class="fu">cluster_ra</span>(<span class="at">clusters =</span> ID, <span class="at">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb53-3"><a href="power-analysis-using-declaredesign.html#cb53-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Y =</span> <span class="fu">reveal_outcomes</span>(Y <span class="sc">~</span> Z)) </span></code></pre></div>
<pre><code>## Error in declare_assignment(Z = cluster_ra(clusters = ID, prob = 0.5), : could not find function &quot;declare_assignment&quot;</code></pre>
<p>Next, I declare my theoretical quantity of interest is the treatment
effect in year 1. This is useful to check for bias. This is not really
needed here, since my model will follow our data generation process exactly,
so I could have just skipped this step.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="power-analysis-using-declaredesign.html#cb55-1" aria-hidden="true" tabindex="-1"></a>inquiry <span class="ot">&lt;-</span>  </span>
<span id="cb55-2"><a href="power-analysis-using-declaredesign.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">declare_inquiry</span>(<span class="at">ATE =</span> <span class="fu">mean</span>(Y_Z_1 <span class="sc">-</span> Y_Z_0), <span class="at">subset =</span> (t <span class="sc">==</span> <span class="dv">1</span>)) </span></code></pre></div>
<pre><code>## Error in declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0), subset = (t == 1)): could not find function &quot;declare_inquiry&quot;</code></pre>
<p>And finally the estimator with which I hope to estimate the ATE:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="power-analysis-using-declaredesign.html#cb57-1" aria-hidden="true" tabindex="-1"></a>estimator <span class="ot">&lt;-</span></span>
<span id="cb57-2"><a href="power-analysis-using-declaredesign.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> t <span class="sc">*</span> Z, <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, <span class="at">.method =</span> lm_robust, <span class="at">term =</span> <span class="st">&quot;t:Z&quot;</span>, <span class="at">label =</span> <span class="st">&quot;DiD&quot;</span>)</span></code></pre></div>
<pre><code>## Error in declare_estimator(Y ~ t * Z, inquiry = &quot;ATE&quot;, .method = lm_robust, : could not find function &quot;declare_estimator&quot;</code></pre>
<p>Finally, I combine all these elements to declare my design. Note that
it’s only here that R starts actually running the code to randomize
things. The previous was just declaration!</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="power-analysis-using-declaredesign.html#cb59-1" aria-hidden="true" tabindex="-1"></a>  design <span class="ot">&lt;-</span> model <span class="sc">+</span> assignment <span class="sc">+</span> inquiry <span class="sc">+</span> estimator </span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;model&#39; not found</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="power-analysis-using-declaredesign.html#cb61-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(design)</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;design&#39; not found</code></pre>
<p>If you want to browse a version of the data created by your design,
use the <code>draw_data()</code> function. This is useful to examine the properties of the data.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="power-analysis-using-declaredesign.html#cb63-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_data</span>(design) <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="power-analysis-using-declaredesign.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## Error in draw_data(design): could not find function &quot;draw_data&quot;</code></pre>
<p>Now to calculate our power. The <code>diagnose_design()</code> will run our
model 500 times and our power is simply the fraction of times we
find a statistically significant effect.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="power-analysis-using-declaredesign.html#cb65-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(design)</span></code></pre></div>
<pre><code>## Error in diagnose_design(design): could not find function &quot;diagnose_design&quot;</code></pre>
<p>Looks good! But what if we were too optimistic? We can vary various
parameters of our design, and test all combinations by using the
<code>redesign()</code> function. Here I check a few plausible values for
our <code>year_shock</code> variable and the expected effect size.</p>
<p>I’ve set the <code>sims</code> option of <code>diagnose_design()</code> to 100, to reduce
the number of times each variation of the model is run to save me
some time.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="power-analysis-using-declaredesign.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb67-2"><a href="power-analysis-using-declaredesign.html#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="power-analysis-using-declaredesign.html#cb67-3" aria-hidden="true" tabindex="-1"></a>diagnosis <span class="ot">&lt;-</span></span>
<span id="cb67-4"><a href="power-analysis-using-declaredesign.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  design <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="power-analysis-using-declaredesign.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">effect_size =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb67-6"><a href="power-analysis-using-declaredesign.html#cb67-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">year_shock =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="power-analysis-using-declaredesign.html#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Error in diagnose_design(., sims = 100): could not find function &quot;diagnose_design&quot;</code></pre>
<p>Now, I want a nice plot. For this I use the
<code>tidy()</code> function to convert the output to a data frame, which
I then pipe into <code>ggplot()</code>. It’s now easy to see that I should
be able to pick up an effect size of 9 in most cases.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="power-analysis-using-declaredesign.html#cb69-1" aria-hidden="true" tabindex="-1"></a>diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="power-analysis-using-declaredesign.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="power-analysis-using-declaredesign.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;power&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="power-analysis-using-declaredesign.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(effect_size,year_shock,<span class="at">power =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="power-analysis-using-declaredesign.html#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_shock =</span> <span class="fu">as.factor</span>(year_shock)) <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="power-analysis-using-declaredesign.html#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> effect_size, <span class="at">y =</span> power, </span>
<span id="cb69-7"><a href="power-analysis-using-declaredesign.html#cb69-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">group=</span>year_shock, <span class="at">color=</span>year_shock)) <span class="sc">+</span></span>
<span id="cb69-8"><a href="power-analysis-using-declaredesign.html#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb69-9"><a href="power-analysis-using-declaredesign.html#cb69-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.8</span>,<span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb69-10"><a href="power-analysis-using-declaredesign.html#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">6</span>,<span class="dv">16</span>,<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Error in tidy(.): could not find function &quot;tidy&quot;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estimating-and-reporting.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/kleuveld/r_cheatsheet/edit/main/chapters/04-declaredesign.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
