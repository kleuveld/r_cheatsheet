<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Power Analysis using DeclareDesign | R Cheat Sheet</title>
  <meta name="description" content="This page contains some quick R tips." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Power Analysis using DeclareDesign | R Cheat Sheet" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains some quick R tips." />
  <meta name="github-repo" content="kleuveld/r_cheatsheet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Power Analysis using DeclareDesign | R Cheat Sheet" />
  
  <meta name="twitter:description" content="This page contains some quick R tips." />
  

<meta name="author" content="Koen" />


<meta name="date" content="2024-09-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="plotting.html"/>
<link rel="next" href="data-exploration.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Cheat Sheet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i>Setting up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i>Data Wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#basic-data-manipulation"><i class="fa fa-check"></i>Basic Data Manipulation</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-or-reshaping"><i class="fa fa-check"></i>Pivoting (or reshaping)</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#creating-fake-data"><i class="fa fa-check"></i>Creating fake data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-long-to-wide"><i class="fa fa-check"></i>Pivoting long to wide</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-wide-to-long"><i class="fa fa-check"></i>Pivoting wide to long</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#joining-or-merging-data"><i class="fa fa-check"></i>Joining (or merging) data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#summarizing-over-groups-or-collapsing-data"><i class="fa fa-check"></i>Summarizing over groups (or collapsing data)</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#row-wise-operations"><i class="fa fa-check"></i>Row-wise Operations</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#across-doing-the-same-operations-on-multiple-variables-using-across"><i class="fa fa-check"></i>across(): doing the same operations on multiple variables using across</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#c_across-passing-values-from-multiple-variables-to-summarizing-functions"><i class="fa fa-check"></i>c_across(): passing values from multiple variables to summarizing functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#seperate_longer"><i class="fa fa-check"></i>Splitting multi-response variable into dummies</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i>Estimating and reporting</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#generating-some-fake-data"><i class="fa fa-check"></i>Generating some fake data</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#making-a-table-of-summary-statistics"><i class="fa fa-check"></i>Making a table of summary statistics</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#using-modelsummary-and-flextable"><i class="fa fa-check"></i>Using modelsummary and flextable</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#balance-table"><i class="fa fa-check"></i>Balance Table</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#advanced-using-only-flextable"><i class="fa fa-check"></i>Advanced: Using only Flextable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#simple-regression"><i class="fa fa-check"></i>Simple regression</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#robust-standard-errors"><i class="fa fa-check"></i>Robust standard errors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i>Plotting using ggplot</a>
<ul>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#scatter-plot"><i class="fa fa-check"></i>Scatter plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#bar-chart"><i class="fa fa-check"></i>Bar chart</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#faceting"><i class="fa fa-check"></i>Faceting</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#stacked-wur"><i class="fa fa-check"></i>Stacked bar chart with WUR template and observation counts</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#ordering-of-labels"><i class="fa fa-check"></i>Ordering of labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#lollipop-plot"><i class="fa fa-check"></i>Lollipop plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#maps"><i class="fa fa-check"></i>Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html"><i class="fa fa-check"></i>Power Analysis using DeclareDesign</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#diff-in-diff"><i class="fa fa-check"></i>Diff-in-Diff</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#fabricating-data"><i class="fa fa-check"></i>Fabricating Data</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#diagnosing-design-and-calculating-power"><i class="fa fa-check"></i>Diagnosing Design and calculating power</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#propsensity-score-matching-with-rhomis-data"><i class="fa fa-check"></i>Propsensity score matching with Rhomis data</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#data-wrangling"><i class="fa fa-check"></i>Data Wrangling</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design-1"><i class="fa fa-check"></i>Declare Design</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#checking-balance"><i class="fa fa-check"></i>Checking balance</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#bias"><i class="fa fa-check"></i>Bias</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#power"><i class="fa fa-check"></i>Power</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i>Data Exploration</a>
<ul>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#setup-1"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#making-a-codebook-from-a-stata-.dta"><i class="fa fa-check"></i>Making a codebook from a Stata .dta</a></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#correlogram"><i class="fa fa-check"></i>Correlogram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i>Programming with R</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#loops"><i class="fa fa-check"></i>Loops</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#basic-functions"><i class="fa fa-check"></i>Basic Functions</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions-and-the-tidyverse"><i class="fa fa-check"></i>Functions and the tidyverse</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#plot-function"><i class="fa fa-check"></i>Example 1: Re-using plot specifications</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#example-2-function-to-create-dummies-from-text"><i class="fa fa-check"></i>Example 2: Function to create dummies from text</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#map"><i class="fa fa-check"></i>Map()</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Cheat Sheet</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="declaredesign" class="section level1 hasAnchor">
<h1>Power Analysis using DeclareDesign<a href="declaredesign.html#declaredesign" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="https://declaredesign.org/">DeclareDesign</a> is a system to simulate Research Designs. This is useful for power
analysis, because it is often hard to include things like clustering and
covariates in standard power calculators.</p>
<p>Resources for learning about DeclareDesign:</p>
<ul>
<li><a href="https://macartan.github.io/slides/202211_declaredesign_and_power.html">Slides by the authors of DeclareDesign: Graeme Blair, Alex Coppock, Macartan Humphreys</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/declaredesign.pdf">The DeclareDesign CheatSheet</a></li>
<li>The book <a href="https://book.declaredesign.org/">Research Design in the Social Sciences: Declaration, Diagnosis, and Redesign</a></li>
</ul>
<p>Read at least the slides before going forward!</p>
<div id="diff-in-diff" class="section level2 hasAnchor">
<h2>Diff-in-Diff<a href="declaredesign.html#diff-in-diff" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here’s a common situation: I’ve collected some baseline data, and are
wondering if our study has sufficient power to pick up expected treatment
effects.</p>
<div id="fabricating-data" class="section level3 hasAnchor">
<h3>Fabricating Data<a href="declaredesign.html#fabricating-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I will start off with some fake baseline data, which only contains <code>y0</code>, our outcome
indicator. We use the <code>fabricate()</code> function, from the fabricatr library, which is
loaded with DeclareDesign:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="declaredesign.html#cb78-1" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb78-2"><a href="declaredesign.html#cb78-2" tabindex="-1"></a></span>
<span id="cb78-3"><a href="declaredesign.html#cb78-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># data management</span></span>
<span id="cb78-4"><a href="declaredesign.html#cb78-4" tabindex="-1"></a></span>
<span id="cb78-5"><a href="declaredesign.html#cb78-5" tabindex="-1"></a><span class="fu">library</span>(fixest) <span class="co"># for estimation of fixed effects</span></span>
<span id="cb78-6"><a href="declaredesign.html#cb78-6" tabindex="-1"></a><span class="fu">library</span>(lmtest) <span class="co"># for computing standard errors</span></span>
<span id="cb78-7"><a href="declaredesign.html#cb78-7" tabindex="-1"></a><span class="fu">library</span>(sandwich) <span class="co"># provides the functions for lmtest to compute robust SEs</span></span>
<span id="cb78-8"><a href="declaredesign.html#cb78-8" tabindex="-1"></a></span>
<span id="cb78-9"><a href="declaredesign.html#cb78-9" tabindex="-1"></a><span class="fu">library</span>(DeclareDesign) <span class="co"># for power calculation</span></span>
<span id="cb78-10"><a href="declaredesign.html#cb78-10" tabindex="-1"></a><span class="fu">library</span>(broom) <span class="co"># to extract coefficients from model output</span></span>
<span id="cb78-11"><a href="declaredesign.html#cb78-11" tabindex="-1"></a></span>
<span id="cb78-12"><a href="declaredesign.html#cb78-12" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb78-13"><a href="declaredesign.html#cb78-13" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb78-14"><a href="declaredesign.html#cb78-14" tabindex="-1"></a></span>
<span id="cb78-15"><a href="declaredesign.html#cb78-15" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb78-16"><a href="declaredesign.html#cb78-16" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span></span>
<span id="cb78-17"><a href="declaredesign.html#cb78-17" tabindex="-1"></a>  <span class="fu">fabricate</span>(<span class="at">N =</span> N, </span>
<span id="cb78-18"><a href="declaredesign.html#cb78-18" tabindex="-1"></a>            <span class="at">y0 =</span> <span class="fu">runif</span>(N, <span class="dv">100</span>, <span class="dv">150</span>))</span>
<span id="cb78-19"><a href="declaredesign.html#cb78-19" tabindex="-1"></a></span>
<span id="cb78-20"><a href="declaredesign.html#cb78-20" tabindex="-1"></a>fake_data <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 100 × 2
##    ID       y0
##    &lt;chr&gt; &lt;dbl&gt;
##  1 001    113.
##  2 002    119.
##  3 003    129.
##  4 004    145.
##  5 005    110.
##  6 006    145.
##  7 007    147.
##  8 008    133.
##  9 009    131.
## 10 010    103.
## # ℹ 90 more rows</code></pre>
<p>Now, let’s add an extra year to our data, again using <code>fabricate()</code>, just
to demonstrate how, using <code>add_level()</code> and then <code>crosslevels()</code>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="declaredesign.html#cb80-1" tabindex="-1"></a>fakedata_years <span class="ot">&lt;-</span></span>
<span id="cb80-2"><a href="declaredesign.html#cb80-2" tabindex="-1"></a>  <span class="fu">fabricate</span>(fake_data,</span>
<span id="cb80-3"><a href="declaredesign.html#cb80-3" tabindex="-1"></a>            <span class="at">years =</span> <span class="fu">add_level</span>(<span class="at">N =</span> <span class="dv">2</span>, </span>
<span id="cb80-4"><a href="declaredesign.html#cb80-4" tabindex="-1"></a>                              <span class="at">t =</span> <span class="fu">as.numeric</span>(years) <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb80-5"><a href="declaredesign.html#cb80-5" tabindex="-1"></a>                              <span class="at">nest=</span><span class="cn">FALSE</span>),</span>
<span id="cb80-6"><a href="declaredesign.html#cb80-6" tabindex="-1"></a>            <span class="at">observations =</span> <span class="fu">cross_levels</span>(<span class="at">by =</span> <span class="fu">join_using</span>(ID, years)))</span>
<span id="cb80-7"><a href="declaredesign.html#cb80-7" tabindex="-1"></a></span>
<span id="cb80-8"><a href="declaredesign.html#cb80-8" tabindex="-1"></a>fakedata_years <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 200 × 5
##    ID       y0 years     t observations
##    &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;       
##  1 001    113. 1         0 001         
##  2 002    119. 1         0 002         
##  3 003    129. 1         0 003         
##  4 004    145. 1         0 004         
##  5 005    110. 1         0 005         
##  6 006    145. 1         0 006         
##  7 007    147. 1         0 007         
##  8 008    133. 1         0 008         
##  9 009    131. 1         0 009         
## 10 010    103. 1         0 010         
## # ℹ 190 more rows</code></pre>
</div>
<div id="declare-design" class="section level3 hasAnchor">
<h3>Declare Design<a href="declaredesign.html#declare-design" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now it’s time to start declaring our design. The first element of the
design is the model, which essentially is my data, and I declare it
using the same synytax as <code>fabricate()</code>
above. This means you can input existing data, but also generate
random new variables.</p>
<p>The potential outcomes are generated using <code>potential_outcomes()</code>.
This will create two variables <code>Y_Z_1</code> and <code>Y_Z_0</code>, which are
the potential outcomes if having received treatment (<code>Z == 1</code>) or not.
Note that I will generate <code>Z</code> in the next step.</p>
<p>You can see I have created a very simple data generating
process to generate different outcomes in <code>t = 1</code> for treatment
and control, but you can go absolutely wild here to check the
assumptions you have: you can cluster the outcomes, include
compliance or treatment effectiveness, add more or less noise,
make it depend on both observable and unobservable
characteristics, etc. etc.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="declaredesign.html#cb82-1" tabindex="-1"></a>year_shock <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb82-2"><a href="declaredesign.html#cb82-2" tabindex="-1"></a>effect_size <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb82-3"><a href="declaredesign.html#cb82-3" tabindex="-1"></a>stdev <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb82-4"><a href="declaredesign.html#cb82-4" tabindex="-1"></a></span>
<span id="cb82-5"><a href="declaredesign.html#cb82-5" tabindex="-1"></a>model <span class="ot">&lt;-</span> </span>
<span id="cb82-6"><a href="declaredesign.html#cb82-6" tabindex="-1"></a>  <span class="fu">declare_model</span>(fakedata_years,</span>
<span id="cb82-7"><a href="declaredesign.html#cb82-7" tabindex="-1"></a>                <span class="fu">potential_outcomes</span>(Y <span class="sc">~</span> y0 <span class="sc">+</span> t <span class="sc">*</span> year_shock <span class="sc">+</span> </span>
<span id="cb82-8"><a href="declaredesign.html#cb82-8" tabindex="-1"></a>                                            Z <span class="sc">*</span> effect_size <span class="sc">+</span> </span>
<span id="cb82-9"><a href="declaredesign.html#cb82-9" tabindex="-1"></a>                                            t <span class="sc">*</span> <span class="fu">rnorm</span>(N,<span class="at">sd =</span> stdev)))</span></code></pre></div>
<p>Then it’s time to think about assignment. I need to assign treatment,
and reveal the outcomes based on treatment assignment. Here I create
two variables for treatment so I can toy around with different model
specifications later on. The first variable is the <code>treatment_group</code>, to
indicate which households get the treatment. For this I use the
<code>cluster_ra()</code> because I have two observations per household,
so households can be thought of as a cluster. The other is <code>Z</code>,
an indicator for actually having
received the treatment (equivalent to <code>Z = treatment_group * t</code>).</p>
<p>If treatment had already been known during baseline (not
unlikely) then we would have only had to reveal the outcomes:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="declaredesign.html#cb83-1" tabindex="-1"></a>assignment <span class="ot">&lt;-</span></span>
<span id="cb83-2"><a href="declaredesign.html#cb83-2" tabindex="-1"></a>  <span class="fu">declare_assignment</span>(<span class="at">treatment_group =</span> <span class="fu">cluster_ra</span>(<span class="at">clusters =</span> ID, <span class="at">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb83-3"><a href="declaredesign.html#cb83-3" tabindex="-1"></a>                     <span class="at">Z =</span> <span class="fu">ifelse</span>(treatment_group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> t <span class="sc">==</span> <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb83-4"><a href="declaredesign.html#cb83-4" tabindex="-1"></a>                     <span class="at">Y =</span> <span class="fu">reveal_outcomes</span>(Y <span class="sc">~</span> Z)) </span></code></pre></div>
<p>Next, I declare my theoretical quantity of interest is the treatment
effect in year 1. This is useful to check for bias. This is not really
needed here, since my model will follow our data generation process exactly,
so I could have just skipped this step.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="declaredesign.html#cb84-1" tabindex="-1"></a>inquiry <span class="ot">&lt;-</span>  </span>
<span id="cb84-2"><a href="declaredesign.html#cb84-2" tabindex="-1"></a>  <span class="fu">declare_inquiry</span>(<span class="at">ATE =</span> <span class="fu">mean</span>(Y_Z_1 <span class="sc">-</span> Y_Z_0), <span class="at">subset =</span> (t <span class="sc">==</span> <span class="dv">1</span>)) </span></code></pre></div>
<p>And finally, I add three estimators. If I hadn’t declared an inquiry,
I could have declared a test here using <code>declare_test()</code>, which has
the same syntax.</p>
<p>The first estimator uses <code>lm_robust()</code>, which is included
with DeclareDesign, to estimate a simple linear model using standard
DiD notation.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="declaredesign.html#cb85-1" tabindex="-1"></a>estimator1 <span class="ot">&lt;-</span></span>
<span id="cb85-2"><a href="declaredesign.html#cb85-2" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> t <span class="sc">*</span> treatment_group, </span>
<span id="cb85-3"><a href="declaredesign.html#cb85-3" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb85-4"><a href="declaredesign.html#cb85-4" tabindex="-1"></a>                    <span class="at">.method =</span> estimatr<span class="sc">::</span>lm_robust, </span>
<span id="cb85-5"><a href="declaredesign.html#cb85-5" tabindex="-1"></a>                    <span class="at">term =</span> <span class="st">&quot;t:treatment_group&quot;</span>, </span>
<span id="cb85-6"><a href="declaredesign.html#cb85-6" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;LM&quot;</span>)</span></code></pre></div>
<p>Then I use <a href="https://lrberge.github.io/fixest/reference/feols.html"><code>feols()</code></a>
from the <a href="https://lrberge.github.io/fixest/index.html">fixest</a>
package to estimate a Two-way fixed effects (2FE) model.
This is equivalent to the model above for this case, but the
2FE can be more easily extended to more complex
designs (<a href="https://doi.org/10.1017/pan.2020.33">but beware!</a>).</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="declaredesign.html#cb86-1" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb86-2"><a href="declaredesign.html#cb86-2" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb86-3"><a href="declaredesign.html#cb86-3" tabindex="-1"></a></span>
<span id="cb86-4"><a href="declaredesign.html#cb86-4" tabindex="-1"></a>estimator2 <span class="ot">&lt;-</span></span>
<span id="cb86-5"><a href="declaredesign.html#cb86-5" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> Z <span class="sc">|</span> treatment_group <span class="sc">+</span> t,</span>
<span id="cb86-6"><a href="declaredesign.html#cb86-6" tabindex="-1"></a>                    <span class="at">vcov =</span> <span class="st">&quot;hetero&quot;</span>,</span>
<span id="cb86-7"><a href="declaredesign.html#cb86-7" tabindex="-1"></a>                    <span class="at">.method =</span> feols, </span>
<span id="cb86-8"><a href="declaredesign.html#cb86-8" tabindex="-1"></a>                    <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>, </span>
<span id="cb86-9"><a href="declaredesign.html#cb86-9" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb86-10"><a href="declaredesign.html#cb86-10" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;2FE&quot;</span>)</span></code></pre></div>
<p>As third estimator, I use a custom estimation function. The function
takes an equation, the data to be analyzed, and (optionally)
the type of standard errors to compute, and as its output
it returns a tidy dataset containing estimated coefficients
created by <a href="https://broom.tidymodels.org/articles/broom.html"><code>broom::tidy()</code></a>.
As long as you make sure the data can go into your custom function
(using an argument called <code>data</code>),
and it returns something that looks like what
<a href="https://broom.tidymodels.org/articles/broom.html"><code>broom::tidy()</code></a> would
return, there’s no limit as to how complex you can make your analysis.</p>
<p>Here, I keep it (relatively) simple. I use the lmtest/sandwich way of estimating
robust standard errors, and make sure you can easily change the equation and type of
Standard Errors to use through a parameter.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="declaredesign.html#cb87-1" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb87-2"><a href="declaredesign.html#cb87-2" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb87-3"><a href="declaredesign.html#cb87-3" tabindex="-1"></a></span>
<span id="cb87-4"><a href="declaredesign.html#cb87-4" tabindex="-1"></a>custom_robust <span class="ot">&lt;-</span> <span class="cf">function</span>(equation, data, <span class="at">type=</span><span class="st">&quot;HC1&quot;</span>){</span>
<span id="cb87-5"><a href="declaredesign.html#cb87-5" tabindex="-1"></a>  <span class="co"># function takes a formula, provided as the first argument</span></span>
<span id="cb87-6"><a href="declaredesign.html#cb87-6" tabindex="-1"></a>  <span class="co"># of declare_estimator...</span></span>
<span id="cb87-7"><a href="declaredesign.html#cb87-7" tabindex="-1"></a>  <span class="co"># .. a type of standard errors to pass to vcov (default is HC1)</span></span>
<span id="cb87-8"><a href="declaredesign.html#cb87-8" tabindex="-1"></a>  <span class="co"># ... and data</span></span>
<span id="cb87-9"><a href="declaredesign.html#cb87-9" tabindex="-1"></a>  <span class="co"># It outputs a tidy data frame with relevant coefficients.</span></span>
<span id="cb87-10"><a href="declaredesign.html#cb87-10" tabindex="-1"></a></span>
<span id="cb87-11"><a href="declaredesign.html#cb87-11" tabindex="-1"></a>  <span class="fu">lm</span>(equation, <span class="at">data =</span> data) <span class="sc">%&gt;%</span></span>
<span id="cb87-12"><a href="declaredesign.html#cb87-12" tabindex="-1"></a>    <span class="fu">coeftest</span>(., <span class="at">vcov =</span> <span class="fu">vcovHC</span>(., <span class="at">type=</span>type)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-13"><a href="declaredesign.html#cb87-13" tabindex="-1"></a>    broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-14"><a href="declaredesign.html#cb87-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-15"><a href="declaredesign.html#cb87-15" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;t:treatment_group&quot;</span>)</span>
<span id="cb87-16"><a href="declaredesign.html#cb87-16" tabindex="-1"></a>}</span>
<span id="cb87-17"><a href="declaredesign.html#cb87-17" tabindex="-1"></a></span>
<span id="cb87-18"><a href="declaredesign.html#cb87-18" tabindex="-1"></a><span class="co"># the arguments formula and type are passed to to custom_robust()</span></span>
<span id="cb87-19"><a href="declaredesign.html#cb87-19" tabindex="-1"></a><span class="co"># as is the data on which to run the estimator. </span></span>
<span id="cb87-20"><a href="declaredesign.html#cb87-20" tabindex="-1"></a>estimator3 <span class="ot">&lt;-</span> </span>
<span id="cb87-21"><a href="declaredesign.html#cb87-21" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(<span class="at">equation =</span> Y <span class="sc">~</span> t <span class="sc">*</span> treatment_group, </span>
<span id="cb87-22"><a href="declaredesign.html#cb87-22" tabindex="-1"></a>                    <span class="at">handler =</span> <span class="fu">label_estimator</span>(custom_robust), </span>
<span id="cb87-23"><a href="declaredesign.html#cb87-23" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb87-24"><a href="declaredesign.html#cb87-24" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;Custom&quot;</span>) </span></code></pre></div>
<p>Finally, I combine all these elements to declare my design. Note that
it’s only here that R starts actually running the code to randomize
things. The previous was just declaration!</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="declaredesign.html#cb88-1" tabindex="-1"></a>design <span class="ot">&lt;-</span> model <span class="sc">+</span> assignment <span class="sc">+</span> inquiry <span class="sc">+</span> estimator1 <span class="sc">+</span> estimator2 <span class="sc">+</span> estimator3</span>
<span id="cb88-2"><a href="declaredesign.html#cb88-2" tabindex="-1"></a><span class="fu">summary</span>(design)</span></code></pre></div>
<pre><code>## 
## Research design declaration summary
## 
## Step 1 (model): declare_model(fakedata_years, potential_outcomes(Y ~ y0 + t * year_shock + Z * effect_size + t * rnorm(N, sd = stdev))) 
## 
## N = 200 
## 
## Added variable: ID 
##  N_missing N_unique     class
##          0      100 character
## 
## Added variable: y0 
##     min median   mean   max    sd N_missing N_unique
##  100.67 124.39 125.89 149.6 13.35         0      100
## 
## Added variable: years 
##     1    2
##   100  100
##  0.50 0.50
## 
## Added variable: t 
##     0    1
##   100  100
##  0.50 0.50
## 
## Added variable: observations 
##  N_missing N_unique     class
##          0      200 character
## 
## Added variable: Y_Z_0 
##     min median   mean    max    sd N_missing N_unique
##  100.67 132.43 130.95 160.63 14.16         0      200
## 
## Added variable: Y_Z_1 
##     min median   mean    max    sd N_missing N_unique
##  115.67 146.79 145.69 176.27 14.24         0      200
## 
## Step 2 (assignment): declare_assignment(treatment_group = cluster_ra(clusters = ID, prob = 0.5), Z = ifelse(treatment_group == 1 &amp; t == 1, 1, 0), Y = reveal_outcomes(Y ~ Z)) 
## 
## Added variable: treatment_group 
##     0    1
##   100  100
##  0.50 0.50
## 
## Added variable: Z 
##     0    1
##   150   50
##  0.75 0.25
## 
## Added variable: Y 
##     min median   mean    max    sd N_missing N_unique
##  100.67 134.88 134.68 176.27 17.03         0      200
## 
## Step 3 (inquiry): declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0), subset = (t == 1)) 
## 
## A single draw of the inquiry:
##  inquiry estimand
##      ATE 14.47179
## 
## Step 4 (estimator): declare_estimator(Y ~ t * treatment_group, inquiry = &quot;ATE&quot;, .method = estimatr::lm_robust, term = &quot;t:treatment_group&quot;, label = &quot;LM&quot;) 
## 
## Formula: Y ~ t * treatment_group 
## 
## Method:  :: Method:  estimatr Method:    lm_robust 
## 
## A single draw of the estimator:
##               term estimator estimate std.error statistic      p.value conf.low
##  t:treatment_group        LM 15.68729  3.867435  4.056252 7.194547e-05 8.060161
##  conf.high  df outcome inquiry
##   23.31442 196       Y     ATE
## 
## Step 5 (estimator): declare_estimator(Y ~ Z | treatment_group + t, vcov = &quot;hetero&quot;, .method = feols, term = &quot;Z&quot;, inquiry = &quot;ATE&quot;, label = &quot;2FE&quot;) 
## 
## Formula: Y ~ Z | treatment_group + t 
## 
## Method:  feols 
## 
## A single draw of the estimator:
##  term estimator estimate std.error statistic      p.value conf.low conf.high
##     Z       2FE 15.68729  3.867435  4.056252 7.194547e-05 8.060161  23.31442
##  inquiry
##      ATE
## 
## Step 6 (estimator): declare_estimator(equation = Y ~ t * treatment_group, inquiry = &quot;ATE&quot;, handler = label_estimator(custom_robust), label = &quot;Custom&quot;) 
## 
## Formula: Y ~ t * treatment_group 
## 
## A single draw of the estimator:
##  estimator              term estimate std.error statistic      p.value conf.low
##     Custom t:treatment_group 15.68729  3.867435  4.056252 7.194547e-05 8.060161
##  conf.high outcome inquiry
##   23.31442       Y     ATE</code></pre>
<p>Note that the results of my three estimators are identical, which is as expected.</p>
</div>
<div id="diagnosing-design-and-calculating-power" class="section level3 hasAnchor">
<h3>Diagnosing Design and calculating power<a href="declaredesign.html#diagnosing-design-and-calculating-power" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you want to browse a version of the data created by your design,
use the <code>draw_data()</code> function. This is useful to examine the properties of the data.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="declaredesign.html#cb90-1" tabindex="-1"></a><span class="fu">draw_data</span>(design) <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="declaredesign.html#cb90-2" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 200 × 10
##    ID       y0 years     t observations Y_Z_0 Y_Z_1 treatment_group     Z     Y
##    &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 001    113. 1         0 001           113.  128.               1     0  113.
##  2 002    119. 1         0 002           119.  134.               1     0  119.
##  3 003    129. 1         0 003           129.  144.               0     0  129.
##  4 004    145. 1         0 004           145.  160.               0     0  145.
##  5 005    110. 1         0 005           110.  125.               0     0  110.
##  6 006    145. 1         0 006           145.  160.               1     0  145.
##  7 007    147. 1         0 007           147.  162.               1     0  147.
##  8 008    133. 1         0 008           133.  148.               0     0  133.
##  9 009    131. 1         0 009           131.  146.               1     0  131.
## 10 010    103. 1         0 010           103.  118.               0     0  103.
## # ℹ 190 more rows</code></pre>
<p>Now to calculate our power. The <code>diagnose_design()</code> will run our
model 500 times and our power is simply the fraction of times we
find a statistically significant effect.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="declaredesign.html#cb92-1" tabindex="-1"></a><span class="fu">diagnose_design</span>(design)</span></code></pre></div>
<pre><code>## 
## Research design diagnosis based on 500 simulations. Diagnosis completed in 18 secs. Diagnosand estimates with bootstrapped standard errors in parentheses (100 replicates).
## 
##  Design Inquiry Estimator Outcome              Term N Sims Mean Estimand
##  design     ATE       2FE    &lt;NA&gt;                 Z    500         14.97
##                                                                   (0.03)
##  design     ATE    Custom       Y t:treatment_group    500         14.97
##                                                                   (0.03)
##  design     ATE        LM       Y t:treatment_group    500         14.97
##                                                                   (0.03)
##  Mean Estimate   Bias SD Estimate   RMSE  Power Coverage
##          15.02   0.05        1.04   0.70   1.00     1.00
##         (0.05) (0.04)      (0.03) (0.02) (0.00)   (0.00)
##          15.02   0.05        1.04   0.70   1.00     1.00
##         (0.05) (0.04)      (0.03) (0.02) (0.00)   (0.00)
##          15.02   0.05        1.04   0.70   1.00     1.00
##         (0.05) (0.04)      (0.03) (0.02) (0.00)   (0.00)</code></pre>
<p>Looks good! (Except for some NAs for the 2FE model: this is due
to the summary function not providing all things needed.
To fix this, I could have created my own summary
or handler function, but it doesn’t really affect anything,
so this is good enough.)</p>
<p>But what if I was too optimistic? Using the
<code>redesign()</code> function, you can vary various
parameters of your design, and test all their combinations.
Here I check a few plausible values for
the <code>stdev</code> variable (giving the variation of the error term for
incomes in year 1) and the expected effect size.</p>
<p>Note that by default, this runs all estimators, 500 times for each
combination of the parameters. This takes a lot of time, so I update
my design to have only one estimator (estimator1, which is fast)
and I’ve set the <code>sims</code> option of <code>diagnose_design()</code> to 100.</p>
<p>I convert the output to a <code>tibble</code> as that’s easy to work with.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="declaredesign.html#cb94-1" tabindex="-1"></a>design <span class="ot">&lt;-</span> model <span class="sc">+</span> assignment <span class="sc">+</span> inquiry <span class="sc">+</span> estimator1</span>
<span id="cb94-2"><a href="declaredesign.html#cb94-2" tabindex="-1"></a></span>
<span id="cb94-3"><a href="declaredesign.html#cb94-3" tabindex="-1"></a>diagnosis <span class="ot">&lt;-</span></span>
<span id="cb94-4"><a href="declaredesign.html#cb94-4" tabindex="-1"></a>  design <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="declaredesign.html#cb94-5" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">effect_size =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>,</span>
<span id="cb94-6"><a href="declaredesign.html#cb94-6" tabindex="-1"></a>           <span class="at">stdev =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="declaredesign.html#cb94-7" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-8"><a href="declaredesign.html#cb94-8" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-9"><a href="declaredesign.html#cb94-9" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Now, I want a nice plot.
For this I filter the tibble I created, and pipe it into <code>ggplot()</code>.
It’s now easy to see that I should
be able to pick up an effect size of 10 in most cases.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="declaredesign.html#cb95-1" tabindex="-1"></a>diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="declaredesign.html#cb95-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;power&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="declaredesign.html#cb95-3" tabindex="-1"></a>  <span class="fu">select</span>(effect_size,stdev,<span class="at">power =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="declaredesign.html#cb95-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stdev =</span> <span class="fu">factor</span>(stdev)) <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="declaredesign.html#cb95-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> effect_size, <span class="at">y =</span> power, </span>
<span id="cb95-6"><a href="declaredesign.html#cb95-6" tabindex="-1"></a>             <span class="at">shape =</span> stdev, <span class="at">color=</span>stdev)) <span class="sc">+</span></span>
<span id="cb95-7"><a href="declaredesign.html#cb95-7" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb95-8"><a href="declaredesign.html#cb95-8" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb95-9"><a href="declaredesign.html#cb95-9" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.8</span>,<span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb95-10"><a href="declaredesign.html#cb95-10" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">7</span>,<span class="dv">11</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
</div>
<div id="propsensity-score-matching-with-rhomis-data" class="section level2 hasAnchor">
<h2>Propsensity score matching with Rhomis data<a href="declaredesign.html#propsensity-score-matching-with-rhomis-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here, I will be working on Rhomis Data, in the context of a study
that aims to increase food security.
Here’ I have some reference data, that I want to use to explore a
matching design. I need to set up a treatment indicator that is correlated
with my outcome.</p>
<div id="data-wrangling" class="section level3 hasAnchor">
<h3>Data Wrangling<a href="declaredesign.html#data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, I get the Rhomis data, and clean it up a bit. There are no village-level
identifers, so I just bin the gps latitute variable in 18 clusters. Not perfect
of course, but whatever.</p>
<p>I also do some data cleaning.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="declaredesign.html#cb96-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb96-2"><a href="declaredesign.html#cb96-2" tabindex="-1"></a><span class="fu">library</span>(DeclareDesign)</span>
<span id="cb96-3"><a href="declaredesign.html#cb96-3" tabindex="-1"></a>n_clusters <span class="ot">=</span> <span class="dv">18</span></span>
<span id="cb96-4"><a href="declaredesign.html#cb96-4" tabindex="-1"></a></span>
<span id="cb96-5"><a href="declaredesign.html#cb96-5" tabindex="-1"></a>rhomis <span class="ot">&lt;-</span></span>
<span id="cb96-6"><a href="declaredesign.html#cb96-6" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">&quot;data/RHoMIS_Indicators.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-7"><a href="declaredesign.html#cb96-7" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">&quot;Burundi&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-8"><a href="declaredesign.html#cb96-8" tabindex="-1"></a></span>
<span id="cb96-9"><a href="declaredesign.html#cb96-9" tabindex="-1"></a>  <span class="co"># split the sample in villages, by lattitude</span></span>
<span id="cb96-10"><a href="declaredesign.html#cb96-10" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(GPS_LAT)) <span class="sc">%&gt;%</span></span>
<span id="cb96-11"><a href="declaredesign.html#cb96-11" tabindex="-1"></a>  <span class="fu">arrange</span>(GPS_LAT) <span class="sc">%&gt;%</span></span>
<span id="cb96-12"><a href="declaredesign.html#cb96-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">village =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">each =</span> <span class="fu">nrow</span>(.) <span class="sc">/</span> n_clusters , <span class="at">length.out =</span>  <span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb96-13"><a href="declaredesign.html#cb96-13" tabindex="-1"></a>  <span class="fu">select</span>(village,HHsizeMAE,HouseholdType,Head_EducationLevel,LandOwned,HFIAS_status,NFertInput) <span class="sc">%&gt;%</span></span>
<span id="cb96-14"><a href="declaredesign.html#cb96-14" tabindex="-1"></a>  </span>
<span id="cb96-15"><a href="declaredesign.html#cb96-15" tabindex="-1"></a>  <span class="co"># create some variables</span></span>
<span id="cb96-16"><a href="declaredesign.html#cb96-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HFIAS_status =</span> <span class="fu">factor</span>(HFIAS_status, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FoodSecure&quot;</span>, <span class="st">&quot;MildlyFI&quot;</span>, <span class="st">&quot;ModeratelyFI&quot;</span>, <span class="st">&quot;SeverelyFI&quot;</span>)),</span>
<span id="cb96-17"><a href="declaredesign.html#cb96-17" tabindex="-1"></a>         <span class="at">food_secure =</span> <span class="dv">1</span> <span class="sc">*</span> (<span class="fu">as.numeric</span>(HFIAS_status) <span class="sc">&lt;=</span> <span class="dv">3</span>),</span>
<span id="cb96-18"><a href="declaredesign.html#cb96-18" tabindex="-1"></a>         <span class="at">educated =</span> <span class="dv">1</span><span class="sc">*</span>(Head_EducationLevel <span class="sc">!=</span> <span class="st">&quot;No_school&quot;</span>),</span>
<span id="cb96-19"><a href="declaredesign.html#cb96-19" tabindex="-1"></a>         <span class="at">female =</span> <span class="dv">1</span><span class="sc">*</span> (HouseholdType <span class="sc">==</span> <span class="st">&quot;woman_single&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-20"><a href="declaredesign.html#cb96-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hh =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb96-21"><a href="declaredesign.html#cb96-21" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>HFIAS_status) <span class="sc">%&gt;%</span></span>
<span id="cb96-22"><a href="declaredesign.html#cb96-22" tabindex="-1"></a></span>
<span id="cb96-23"><a href="declaredesign.html#cb96-23" tabindex="-1"></a>  <span class="co"># there are too many missings in my data; these seem reasonable to assume to be 0 when missing:</span></span>
<span id="cb96-24"><a href="declaredesign.html#cb96-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(LandOwned,NFertInput,educated),</span>
<span id="cb96-25"><a href="declaredesign.html#cb96-25" tabindex="-1"></a>              <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.x),<span class="dv">0</span>,.x)))</span></code></pre></div>
</div>
<div id="declare-design-1" class="section level3 hasAnchor">
<h3>Declare Design<a href="declaredesign.html#declare-design-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Then, I put it in DeclareDesign.</p>
<p>I use dplyr to fabricate data, because I like it better than fabricatr.</p>
<p>Treatment assignment is as follows:
- 50% of the villages are selected for treatment.
- Roughly 50% of the households are selected. The selection indicator will have
a correlation of <code>rho</code> with the household being educated, using <code>fabricatr</code>’s
<code>correlate()</code> function.
Education is also a strong predictor of <code>food_security</code>, creating inherent bias.</p>
<p>I then re-sample from the original data using the <code>resample_hhs</code> I define below:
- I ensure I have more control household than treatment households.
- I drop any untreated households in treated villages.
This simulates that we can’t get control households in treated villages,
for example due to fears of</p>
<p>I compare a standard difference in means, as well as a custom matching function that
uses the <code>MatchIt</code> package to create a balanced data set, that I can then use for
regular regressions, weighted by the propensity score.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="declaredesign.html#cb97-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb97-2"><a href="declaredesign.html#cb97-2" tabindex="-1"></a></span>
<span id="cb97-3"><a href="declaredesign.html#cb97-3" tabindex="-1"></a><span class="fu">library</span>(MatchIt, <span class="fu">exclude</span>(<span class="st">&quot;select&quot;</span>)) <span class="co"># the select function would conflict with dplyr</span></span></code></pre></div>
<pre><code>## Error in library(MatchIt, exclude(&quot;select&quot;)): there is no package called &#39;MatchIt&#39;</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="declaredesign.html#cb99-1" tabindex="-1"></a>                                    <span class="co"># this syntax requires R 4.0 or higher</span></span>
<span id="cb99-2"><a href="declaredesign.html#cb99-2" tabindex="-1"></a></span>
<span id="cb99-3"><a href="declaredesign.html#cb99-3" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb99-4"><a href="declaredesign.html#cb99-4" tabindex="-1"></a>effect <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb99-5"><a href="declaredesign.html#cb99-5" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb99-6"><a href="declaredesign.html#cb99-6" tabindex="-1"></a></span>
<span id="cb99-7"><a href="declaredesign.html#cb99-7" tabindex="-1"></a>clusters_treat <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb99-8"><a href="declaredesign.html#cb99-8" tabindex="-1"></a>hh_treat <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb99-9"><a href="declaredesign.html#cb99-9" tabindex="-1"></a></span>
<span id="cb99-10"><a href="declaredesign.html#cb99-10" tabindex="-1"></a>clusters_control_multi <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb99-11"><a href="declaredesign.html#cb99-11" tabindex="-1"></a>hh_control_multi <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb99-12"><a href="declaredesign.html#cb99-12" tabindex="-1"></a></span>
<span id="cb99-13"><a href="declaredesign.html#cb99-13" tabindex="-1"></a></span>
<span id="cb99-14"><a href="declaredesign.html#cb99-14" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">declare_population</span>(</span>
<span id="cb99-15"><a href="declaredesign.html#cb99-15" tabindex="-1"></a>  rhomis <span class="sc">%&gt;%</span> </span>
<span id="cb99-16"><a href="declaredesign.html#cb99-16" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb99-17"><a href="declaredesign.html#cb99-17" tabindex="-1"></a>      {.} <span class="sc">%&gt;%</span></span>
<span id="cb99-18"><a href="declaredesign.html#cb99-18" tabindex="-1"></a>        <span class="fu">select</span>(village) <span class="sc">%&gt;%</span></span>
<span id="cb99-19"><a href="declaredesign.html#cb99-19" tabindex="-1"></a>        <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb99-20"><a href="declaredesign.html#cb99-20" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">treated_vill =</span> <span class="fu">complete_ra</span>(<span class="at">N =</span> <span class="fu">nrow</span>(.),<span class="at">prob =</span> <span class="fl">0.5</span>)),</span>
<span id="cb99-21"><a href="declaredesign.html#cb99-21" tabindex="-1"></a>      <span class="at">by =</span> <span class="fu">join_by</span>(village)</span>
<span id="cb99-22"><a href="declaredesign.html#cb99-22" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb99-23"><a href="declaredesign.html#cb99-23" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb99-24"><a href="declaredesign.html#cb99-24" tabindex="-1"></a>      <span class="co"># sampling</span></span>
<span id="cb99-25"><a href="declaredesign.html#cb99-25" tabindex="-1"></a>      <span class="at">treated_hh =</span> <span class="fu">correlate</span>(<span class="at">given =</span> educated, <span class="at">draw_handler =</span> draw_binomial, <span class="at">prob =</span> <span class="fl">0.5</span> , <span class="at">rho =</span> rho),</span>
<span id="cb99-26"><a href="declaredesign.html#cb99-26" tabindex="-1"></a></span>
<span id="cb99-27"><a href="declaredesign.html#cb99-27" tabindex="-1"></a>      <span class="fu">potential_outcomes</span>(Y <span class="sc">~</span> <span class="fu">pmin</span>(<span class="dv">1</span>,food_secure <span class="sc">+</span> Z <span class="sc">*</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(.),<span class="dv">1</span>,effect)))</span>
<span id="cb99-28"><a href="declaredesign.html#cb99-28" tabindex="-1"></a>    )  </span>
<span id="cb99-29"><a href="declaredesign.html#cb99-29" tabindex="-1"></a>)</span>
<span id="cb99-30"><a href="declaredesign.html#cb99-30" tabindex="-1"></a></span>
<span id="cb99-31"><a href="declaredesign.html#cb99-31" tabindex="-1"></a>assignment <span class="ot">&lt;-</span> <span class="fu">declare_assignment</span>(</span>
<span id="cb99-32"><a href="declaredesign.html#cb99-32" tabindex="-1"></a>  <span class="at">Z =</span> treated_vill <span class="sc">*</span> treated_hh</span>
<span id="cb99-33"><a href="declaredesign.html#cb99-33" tabindex="-1"></a>)</span>
<span id="cb99-34"><a href="declaredesign.html#cb99-34" tabindex="-1"></a></span>
<span id="cb99-35"><a href="declaredesign.html#cb99-35" tabindex="-1"></a>resample_hhs <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb99-36"><a href="declaredesign.html#cb99-36" tabindex="-1"></a>  <span class="co"># this function filters any control househols in treated communities</span></span>
<span id="cb99-37"><a href="declaredesign.html#cb99-37" tabindex="-1"></a>  <span class="co"># and it sets the sample size</span></span>
<span id="cb99-38"><a href="declaredesign.html#cb99-38" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb99-39"><a href="declaredesign.html#cb99-39" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">drop =</span> <span class="fu">if_else</span>(treated_vill <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> treated_hh <span class="sc">==</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-40"><a href="declaredesign.html#cb99-40" tabindex="-1"></a>    <span class="fu">filter</span>(drop <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-41"><a href="declaredesign.html#cb99-41" tabindex="-1"></a>      <span class="co"># sample from treated villages and untreated villages</span></span>
<span id="cb99-42"><a href="declaredesign.html#cb99-42" tabindex="-1"></a>      <span class="fu">group_by</span>(treated_vill) <span class="sc">%&gt;%</span></span>
<span id="cb99-43"><a href="declaredesign.html#cb99-43" tabindex="-1"></a>      <span class="fu">do</span>({</span>
<span id="cb99-44"><a href="declaredesign.html#cb99-44" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">unique</span>(.<span class="sc">$</span>treated_vill) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb99-45"><a href="declaredesign.html#cb99-45" tabindex="-1"></a>          <span class="fu">resample_data</span>(., <span class="at">N =</span> <span class="fu">c</span>(<span class="at">village =</span> clusters_treat, <span class="at">hh =</span> hh_treat),<span class="at">unique_labels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-46"><a href="declaredesign.html#cb99-46" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb99-47"><a href="declaredesign.html#cb99-47" tabindex="-1"></a>          <span class="fu">resample_data</span>(., <span class="at">N =</span> <span class="fu">c</span>(<span class="at">village =</span> clusters_control_multi <span class="sc">*</span> clusters_treat, <span class="at">hh =</span> hh_control_multi <span class="sc">*</span> hh_treat), <span class="at">unique_labels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-48"><a href="declaredesign.html#cb99-48" tabindex="-1"></a>        }</span>
<span id="cb99-49"><a href="declaredesign.html#cb99-49" tabindex="-1"></a>      })</span>
<span id="cb99-50"><a href="declaredesign.html#cb99-50" tabindex="-1"></a>}</span>
<span id="cb99-51"><a href="declaredesign.html#cb99-51" tabindex="-1"></a></span>
<span id="cb99-52"><a href="declaredesign.html#cb99-52" tabindex="-1"></a>resampling <span class="ot">&lt;-</span> <span class="fu">declare_step</span>(</span>
<span id="cb99-53"><a href="declaredesign.html#cb99-53" tabindex="-1"></a>  <span class="at">handler =</span> resample_hhs</span>
<span id="cb99-54"><a href="declaredesign.html#cb99-54" tabindex="-1"></a>)</span>
<span id="cb99-55"><a href="declaredesign.html#cb99-55" tabindex="-1"></a></span>
<span id="cb99-56"><a href="declaredesign.html#cb99-56" tabindex="-1"></a>measurement <span class="ot">&lt;-</span> <span class="fu">declare_measurement</span>(<span class="at">Y =</span> <span class="fu">reveal_outcomes</span>(Y <span class="sc">~</span> Z)</span>
<span id="cb99-57"><a href="declaredesign.html#cb99-57" tabindex="-1"></a>) </span>
<span id="cb99-58"><a href="declaredesign.html#cb99-58" tabindex="-1"></a></span>
<span id="cb99-59"><a href="declaredesign.html#cb99-59" tabindex="-1"></a>inquiry <span class="ot">&lt;-</span> <span class="fu">declare_inquiry</span>(<span class="at">ATE =</span> <span class="fu">mean</span>(Y_Z_1 <span class="sc">-</span> Y_Z_0)</span>
<span id="cb99-60"><a href="declaredesign.html#cb99-60" tabindex="-1"></a>)</span>
<span id="cb99-61"><a href="declaredesign.html#cb99-61" tabindex="-1"></a></span>
<span id="cb99-62"><a href="declaredesign.html#cb99-62" tabindex="-1"></a>ols_estimator <span class="ot">&lt;-</span> </span>
<span id="cb99-63"><a href="declaredesign.html#cb99-63" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> Z, </span>
<span id="cb99-64"><a href="declaredesign.html#cb99-64" tabindex="-1"></a>                    <span class="at">clusters =</span> village_unique,</span>
<span id="cb99-65"><a href="declaredesign.html#cb99-65" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb99-66"><a href="declaredesign.html#cb99-66" tabindex="-1"></a>                    <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>, </span>
<span id="cb99-67"><a href="declaredesign.html#cb99-67" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;LM&quot;</span>)</span>
<span id="cb99-68"><a href="declaredesign.html#cb99-68" tabindex="-1"></a></span>
<span id="cb99-69"><a href="declaredesign.html#cb99-69" tabindex="-1"></a>custom_match <span class="ot">&lt;-</span> <span class="cf">function</span>(data, equation, <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>) {</span>
<span id="cb99-70"><a href="declaredesign.html#cb99-70" tabindex="-1"></a>  </span>
<span id="cb99-71"><a href="declaredesign.html#cb99-71" tabindex="-1"></a>  <span class="co"># the command filter(term == term) wouldn&#39;t do anything, so this is a workaround</span></span>
<span id="cb99-72"><a href="declaredesign.html#cb99-72" tabindex="-1"></a>  term_value <span class="ot">&lt;-</span> term</span>
<span id="cb99-73"><a href="declaredesign.html#cb99-73" tabindex="-1"></a></span>
<span id="cb99-74"><a href="declaredesign.html#cb99-74" tabindex="-1"></a>  <span class="co"># run the matching model</span></span>
<span id="cb99-75"><a href="declaredesign.html#cb99-75" tabindex="-1"></a>  matchit_model <span class="ot">&lt;-</span> <span class="fu">matchit</span>(equation,</span>
<span id="cb99-76"><a href="declaredesign.html#cb99-76" tabindex="-1"></a>                         <span class="at">data =</span> data,</span>
<span id="cb99-77"><a href="declaredesign.html#cb99-77" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>)</span>
<span id="cb99-78"><a href="declaredesign.html#cb99-78" tabindex="-1"></a>  matched_df <span class="ot">&lt;-</span> <span class="fu">match.data</span>(matchit_model)</span>
<span id="cb99-79"><a href="declaredesign.html#cb99-79" tabindex="-1"></a></span>
<span id="cb99-80"><a href="declaredesign.html#cb99-80" tabindex="-1"></a>  <span class="co"># run a regression, weighted by the propensity score</span></span>
<span id="cb99-81"><a href="declaredesign.html#cb99-81" tabindex="-1"></a>  <span class="fu">lm_robust</span>(Y <span class="sc">~</span> Z, <span class="at">clusters =</span> village_unique, <span class="at">data =</span> matched_df, <span class="at">weights =</span> weights) <span class="sc">%&gt;%</span></span>
<span id="cb99-82"><a href="declaredesign.html#cb99-82" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb99-83"><a href="declaredesign.html#cb99-83" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">outcome =</span> outcome) <span class="sc">%&gt;%</span></span>
<span id="cb99-84"><a href="declaredesign.html#cb99-84" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> term_value)</span>
<span id="cb99-85"><a href="declaredesign.html#cb99-85" tabindex="-1"></a>}</span>
<span id="cb99-86"><a href="declaredesign.html#cb99-86" tabindex="-1"></a></span>
<span id="cb99-87"><a href="declaredesign.html#cb99-87" tabindex="-1"></a>match_estimator <span class="ot">&lt;-</span> <span class="fu">declare_estimator</span>(</span>
<span id="cb99-88"><a href="declaredesign.html#cb99-88" tabindex="-1"></a>  Z <span class="sc">~</span> HHsizeMAE <span class="sc">+</span> educated <span class="sc">+</span> LandOwned <span class="sc">+</span> NFertInput <span class="sc">+</span> female <span class="sc">+</span> NFertInput,</span>
<span id="cb99-89"><a href="declaredesign.html#cb99-89" tabindex="-1"></a>  <span class="at">handler =</span> <span class="fu">label_estimator</span>(custom_match),</span>
<span id="cb99-90"><a href="declaredesign.html#cb99-90" tabindex="-1"></a>  <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>,  <span class="co"># Tie the estimator to the declared inquiry</span></span>
<span id="cb99-91"><a href="declaredesign.html#cb99-91" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">&quot;PSM ATE&quot;</span>,</span>
<span id="cb99-92"><a href="declaredesign.html#cb99-92" tabindex="-1"></a>  <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb99-93"><a href="declaredesign.html#cb99-93" tabindex="-1"></a>)</span>
<span id="cb99-94"><a href="declaredesign.html#cb99-94" tabindex="-1"></a></span>
<span id="cb99-95"><a href="declaredesign.html#cb99-95" tabindex="-1"></a>design <span class="ot">&lt;-</span></span>
<span id="cb99-96"><a href="declaredesign.html#cb99-96" tabindex="-1"></a>  population <span class="sc">+</span>  inquiry <span class="sc">+</span> assignment <span class="sc">+</span> resampling <span class="sc">+</span> measurement <span class="sc">+</span> ols_estimator <span class="sc">+</span> match_estimator</span></code></pre></div>
</div>
</div>
<div id="checking-balance" class="section level2 hasAnchor">
<h2>Checking balance<a href="declaredesign.html#checking-balance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It’s useful to explore the property’s of our matching estimator.
First I draw data based on my design and create matched version of that data.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="declaredesign.html#cb100-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb100-2"><a href="declaredesign.html#cb100-2" tabindex="-1"></a></span>
<span id="cb100-3"><a href="declaredesign.html#cb100-3" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> </span>
<span id="cb100-4"><a href="declaredesign.html#cb100-4" tabindex="-1"></a>  <span class="fu">draw_data</span>(design) <span class="sc">%&gt;%</span></span>
<span id="cb100-5"><a href="declaredesign.html#cb100-5" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb100-6"><a href="declaredesign.html#cb100-6" tabindex="-1"></a></span>
<span id="cb100-7"><a href="declaredesign.html#cb100-7" tabindex="-1"></a></span>
<span id="cb100-8"><a href="declaredesign.html#cb100-8" tabindex="-1"></a>  matchit_model <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Z <span class="sc">~</span> HHsizeMAE <span class="sc">+</span> educated <span class="sc">+</span> LandOwned <span class="sc">+</span> NFertInput <span class="sc">+</span> female <span class="sc">+</span> NFertInput,</span>
<span id="cb100-9"><a href="declaredesign.html#cb100-9" tabindex="-1"></a>                         <span class="at">data =</span> test_data,</span>
<span id="cb100-10"><a href="declaredesign.html#cb100-10" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>)</span></code></pre></div>
<pre><code>## Error in matchit(Z ~ HHsizeMAE + educated + LandOwned + NFertInput + female + : could not find function &quot;matchit&quot;</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="declaredesign.html#cb102-1" tabindex="-1"></a>  matched_df <span class="ot">&lt;-</span> <span class="fu">match.data</span>(matchit_model)</span></code></pre></div>
<pre><code>## Error in match.data(matchit_model): could not find function &quot;match.data&quot;</code></pre>
<p>Then I create balance table for the <code>test_data</code>:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="declaredesign.html#cb104-1" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb104-2"><a href="declaredesign.html#cb104-2" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb104-3"><a href="declaredesign.html#cb104-3" tabindex="-1"></a></span>
<span id="cb104-4"><a href="declaredesign.html#cb104-4" tabindex="-1"></a></span>
<span id="cb104-5"><a href="declaredesign.html#cb104-5" tabindex="-1"></a><span class="co"># balance table</span></span>
<span id="cb104-6"><a href="declaredesign.html#cb104-6" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span> </span>
<span id="cb104-7"><a href="declaredesign.html#cb104-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Z =</span> <span class="fu">factor</span>(Z, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treatment&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb104-8"><a href="declaredesign.html#cb104-8" tabindex="-1"></a>  <span class="fu">select</span>(Z, Y, food_secure, HHsizeMAE, educated, LandOwned, NFertInput, female, NFertInput) <span class="sc">%&gt;%</span></span>
<span id="cb104-9"><a href="declaredesign.html#cb104-9" tabindex="-1"></a>  <span class="fu">datasummary_balance</span>( <span class="sc">~</span> Z , <span class="at">data =</span> ., </span>
<span id="cb104-10"><a href="declaredesign.html#cb104-10" tabindex="-1"></a>                      <span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>, <span class="at">stars =</span> <span class="cn">TRUE</span>, </span>
<span id="cb104-11"><a href="declaredesign.html#cb104-11" tabindex="-1"></a>                      <span class="at">dinm =</span> <span class="cn">TRUE</span>, <span class="at">dinm_statistic =</span> <span class="st">&quot;p.value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-12"><a href="declaredesign.html#cb104-12" tabindex="-1"></a>  <span class="fu">fix_border_issues</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-13"><a href="declaredesign.html#cb104-13" tabindex="-1"></a>  <span class="fu">autofit</span>()</span></code></pre></div>
<div class="tabwid"><style>.cl-31649404{}.cl-315c7062{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-315ee590{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-315ef7d8{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef7e2{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef7ec{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef7ed{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef7f6{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef800{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef801{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef80a{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef814{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef815{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef81e{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef81f{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef820{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef828{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef829{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef832{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef833{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef83c{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef83d{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef846{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef850{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef851{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef852{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef853{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef85a{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef864{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef865{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef86e{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef86f{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef878{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef879{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef87a{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef882{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef88c{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef88d{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef896{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef897{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8a0{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8a1{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8aa{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8ab{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8b4{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8b5{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8b6{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8be{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8bf{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8c8{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8c9{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-315ef8ca{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-31649404'><thead><tr style="overflow-wrap:break-word;"><th class="cl-315ef7d8"><p class="cl-315ee590"><span class="cl-315c7062"> </span></p></th><th  colspan="2"class="cl-315ef7e2"><p class="cl-315ee590"><span class="cl-315c7062">Control (N=1500)</span></p></th><th  colspan="2"class="cl-315ef7ed"><p class="cl-315ee590"><span class="cl-315c7062">Treatment (N=750)</span></p></th><th  colspan="2"class="cl-315ef800"><p class="cl-315ee590"><span class="cl-315c7062"> </span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-315ef80a"><p class="cl-315ee590"><span class="cl-315c7062"> </span></p></th><th class="cl-315ef814"><p class="cl-315ee590"><span class="cl-315c7062">Mean</span></p></th><th class="cl-315ef815"><p class="cl-315ee590"><span class="cl-315c7062">Std. Dev.</span></p></th><th class="cl-315ef81e"><p class="cl-315ee590"><span class="cl-315c7062">Mean </span></p></th><th class="cl-315ef81f"><p class="cl-315ee590"><span class="cl-315c7062">Std. Dev. </span></p></th><th class="cl-315ef820"><p class="cl-315ee590"><span class="cl-315c7062">Diff. in Means</span></p></th><th class="cl-315ef828"><p class="cl-315ee590"><span class="cl-315c7062">p</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-315ef829"><p class="cl-315ee590"><span class="cl-315c7062">Y</span></p></td><td class="cl-315ef832"><p class="cl-315ee590"><span class="cl-315c7062">0.4</span></p></td><td class="cl-315ef833"><p class="cl-315ee590"><span class="cl-315c7062">0.5</span></p></td><td class="cl-315ef83c"><p class="cl-315ee590"><span class="cl-315c7062">0.5</span></p></td><td class="cl-315ef83d"><p class="cl-315ee590"><span class="cl-315c7062">0.5</span></p></td><td class="cl-315ef846"><p class="cl-315ee590"><span class="cl-315c7062">0.1***</span></p></td><td class="cl-315ef850"><p class="cl-315ee590"><span class="cl-315c7062">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-315ef851"><p class="cl-315ee590"><span class="cl-315c7062">food_secure</span></p></td><td class="cl-315ef852"><p class="cl-315ee590"><span class="cl-315c7062">0.4</span></p></td><td class="cl-315ef853"><p class="cl-315ee590"><span class="cl-315c7062">0.5</span></p></td><td class="cl-315ef85a"><p class="cl-315ee590"><span class="cl-315c7062">0.4</span></p></td><td class="cl-315ef864"><p class="cl-315ee590"><span class="cl-315c7062">0.5</span></p></td><td class="cl-315ef865"><p class="cl-315ee590"><span class="cl-315c7062">0.0</span></p></td><td class="cl-315ef86e"><p class="cl-315ee590"><span class="cl-315c7062">0.228</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-315ef829"><p class="cl-315ee590"><span class="cl-315c7062">HHsizeMAE</span></p></td><td class="cl-315ef832"><p class="cl-315ee590"><span class="cl-315c7062">4.6</span></p></td><td class="cl-315ef833"><p class="cl-315ee590"><span class="cl-315c7062">1.8</span></p></td><td class="cl-315ef83c"><p class="cl-315ee590"><span class="cl-315c7062">4.4</span></p></td><td class="cl-315ef83d"><p class="cl-315ee590"><span class="cl-315c7062">1.8</span></p></td><td class="cl-315ef846"><p class="cl-315ee590"><span class="cl-315c7062">-0.2*</span></p></td><td class="cl-315ef850"><p class="cl-315ee590"><span class="cl-315c7062">0.011</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-315ef829"><p class="cl-315ee590"><span class="cl-315c7062">educated</span></p></td><td class="cl-315ef832"><p class="cl-315ee590"><span class="cl-315c7062">0.6</span></p></td><td class="cl-315ef833"><p class="cl-315ee590"><span class="cl-315c7062">0.5</span></p></td><td class="cl-315ef83c"><p class="cl-315ee590"><span class="cl-315c7062">0.7</span></p></td><td class="cl-315ef83d"><p class="cl-315ee590"><span class="cl-315c7062">0.4</span></p></td><td class="cl-315ef846"><p class="cl-315ee590"><span class="cl-315c7062">0.1***</span></p></td><td class="cl-315ef850"><p class="cl-315ee590"><span class="cl-315c7062">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-315ef86f"><p class="cl-315ee590"><span class="cl-315c7062">LandOwned</span></p></td><td class="cl-315ef878"><p class="cl-315ee590"><span class="cl-315c7062">10.9</span></p></td><td class="cl-315ef879"><p class="cl-315ee590"><span class="cl-315c7062">92.7</span></p></td><td class="cl-315ef87a"><p class="cl-315ee590"><span class="cl-315c7062">1.6</span></p></td><td class="cl-315ef882"><p class="cl-315ee590"><span class="cl-315c7062">2.3</span></p></td><td class="cl-315ef88c"><p class="cl-315ee590"><span class="cl-315c7062">-9.3***</span></p></td><td class="cl-315ef88d"><p class="cl-315ee590"><span class="cl-315c7062">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-315ef896"><p class="cl-315ee590"><span class="cl-315c7062">NFertInput</span></p></td><td class="cl-315ef897"><p class="cl-315ee590"><span class="cl-315c7062">131.4</span></p></td><td class="cl-315ef8a0"><p class="cl-315ee590"><span class="cl-315c7062">802.5</span></p></td><td class="cl-315ef8a1"><p class="cl-315ee590"><span class="cl-315c7062">58.3</span></p></td><td class="cl-315ef8aa"><p class="cl-315ee590"><span class="cl-315c7062">251.3</span></p></td><td class="cl-315ef8ab"><p class="cl-315ee590"><span class="cl-315c7062">-73.1**</span></p></td><td class="cl-315ef8b4"><p class="cl-315ee590"><span class="cl-315c7062">0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-315ef8b5"><p class="cl-315ee590"><span class="cl-315c7062">female</span></p></td><td class="cl-315ef8b6"><p class="cl-315ee590"><span class="cl-315c7062">0.2</span></p></td><td class="cl-315ef8be"><p class="cl-315ee590"><span class="cl-315c7062">0.4</span></p></td><td class="cl-315ef8bf"><p class="cl-315ee590"><span class="cl-315c7062">0.2</span></p></td><td class="cl-315ef8c8"><p class="cl-315ee590"><span class="cl-315c7062">0.4</span></p></td><td class="cl-315ef8c9"><p class="cl-315ee590"><span class="cl-315c7062">0.0*</span></p></td><td class="cl-315ef8ca"><p class="cl-315ee590"><span class="cl-315c7062">0.013</span></p></td></tr></tbody></table></div>
<p>And for the <code>matched_df</code>, which is clearly more balanced.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="declaredesign.html#cb105-1" tabindex="-1"></a>matched_df <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="declaredesign.html#cb105-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Z =</span> <span class="fu">factor</span>(Z, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treatment&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="declaredesign.html#cb105-3" tabindex="-1"></a>  <span class="fu">select</span>(Z, Y, food_secure, HHsizeMAE, educated, LandOwned, NFertInput, female, NFertInput) <span class="sc">%&gt;%</span></span>
<span id="cb105-4"><a href="declaredesign.html#cb105-4" tabindex="-1"></a>  <span class="fu">datasummary_balance</span>( <span class="sc">~</span> Z , <span class="at">data =</span> ., </span>
<span id="cb105-5"><a href="declaredesign.html#cb105-5" tabindex="-1"></a>                      <span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>, <span class="at">stars =</span> <span class="cn">TRUE</span>, </span>
<span id="cb105-6"><a href="declaredesign.html#cb105-6" tabindex="-1"></a>                      <span class="at">dinm =</span> <span class="cn">TRUE</span>, <span class="at">dinm_statistic =</span> <span class="st">&quot;p.value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-7"><a href="declaredesign.html#cb105-7" tabindex="-1"></a>  <span class="fu">fix_border_issues</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-8"><a href="declaredesign.html#cb105-8" tabindex="-1"></a>  <span class="fu">autofit</span>()</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;matched_df&#39; not found</code></pre>
<p>Let’s run the models two times:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="declaredesign.html#cb107-1" tabindex="-1"></a>unmatched_model <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(Y <span class="sc">~</span> Z, <span class="at">clusters =</span> village_unique, <span class="at">data =</span> test_data)</span>
<span id="cb107-2"><a href="declaredesign.html#cb107-2" tabindex="-1"></a>matched_model <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(Y<span class="sc">~</span>Z, <span class="at">clusters =</span> village_unique, <span class="at">data =</span> matched_df, <span class="at">weights =</span> weights)</span></code></pre></div>
<pre><code>## Error: object &#39;matched_df&#39; not found</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="declaredesign.html#cb109-1" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="at">lm =</span> unmatched_model, <span class="at">psm =</span> matched_model), <span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>,</span>
<span id="cb109-2"><a href="declaredesign.html#cb109-2" tabindex="-1"></a>             <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">&quot;nobs&quot;</span>,<span class="st">&quot;r.squared&quot;</span>,<span class="st">&quot;adj.r.squared&quot;</span>))</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;matched_model&#39; not found</code></pre>
<p>Both of these underestimate the treatment effect by a bit, as it should be around 0.2.</p>
<div id="bias" class="section level3 hasAnchor">
<h3>Bias<a href="declaredesign.html#bias" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, let’s diagnose the design!</p>
<p>First, let’s examine bias, given selection effects.
The strength of the selection effect is given by <code>rho</code>,
so I use <code>redesign()</code> to vary it:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="declaredesign.html#cb111-1" tabindex="-1"></a>diagnosis <span class="ot">&lt;-</span></span>
<span id="cb111-2"><a href="declaredesign.html#cb111-2" tabindex="-1"></a>  design <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="declaredesign.html#cb111-3" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">rho =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.3</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb111-4"><a href="declaredesign.html#cb111-4" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-5"><a href="declaredesign.html#cb111-5" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb111-6"><a href="declaredesign.html#cb111-6" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>And I put the result in a plot:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="declaredesign.html#cb112-1" tabindex="-1"></a>diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="declaredesign.html#cb112-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;bias&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="declaredesign.html#cb112-3" tabindex="-1"></a>  <span class="fu">select</span>(rho, <span class="at">bias =</span> estimate, estimator) <span class="sc">%&gt;%</span></span>
<span id="cb112-4"><a href="declaredesign.html#cb112-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rho, <span class="at">y =</span> bias, </span>
<span id="cb112-5"><a href="declaredesign.html#cb112-5" tabindex="-1"></a>             <span class="at">shape =</span> estimator, <span class="at">color=</span>estimator)) <span class="sc">+</span></span>
<span id="cb112-6"><a href="declaredesign.html#cb112-6" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb112-7"><a href="declaredesign.html#cb112-7" tabindex="-1"></a>    <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>Clearly, the more treatment is correlated to education,
the higher the bias in the regular model.
Bias is never extreme, however.</p>
</div>
<div id="power" class="section level3 hasAnchor">
<h3>Power<a href="declaredesign.html#power" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Then, let’s examine power.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="declaredesign.html#cb113-1" tabindex="-1"></a>diagnosis <span class="ot">&lt;-</span></span>
<span id="cb113-2"><a href="declaredesign.html#cb113-2" tabindex="-1"></a>  design <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="declaredesign.html#cb113-3" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">clusters_treat =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>),</span>
<span id="cb113-4"><a href="declaredesign.html#cb113-4" tabindex="-1"></a>           <span class="at">effect =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.4</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb113-5"><a href="declaredesign.html#cb113-5" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb113-6"><a href="declaredesign.html#cb113-6" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb113-7"><a href="declaredesign.html#cb113-7" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>When we plot the results, it seems sample size doesn’t affect power much
(not sure why, perhaps the resampling?).
The design can pick up a treatment effect of 0.4,
meaning that 40% of the food insecure beneficaries become food secure.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="declaredesign.html#cb114-1" tabindex="-1"></a>diagnosis <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="declaredesign.html#cb114-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;power&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="declaredesign.html#cb114-3" tabindex="-1"></a>  <span class="fu">select</span>(clusters_treat, <span class="at">power =</span> estimate, estimator, effect) <span class="sc">%&gt;%</span></span>
<span id="cb114-4"><a href="declaredesign.html#cb114-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> clusters_treat, <span class="at">y =</span> power, </span>
<span id="cb114-5"><a href="declaredesign.html#cb114-5" tabindex="-1"></a>             <span class="at">shape =</span> estimator, <span class="at">color=</span>estimator)) <span class="sc">+</span></span>
<span id="cb114-6"><a href="declaredesign.html#cb114-6" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb114-7"><a href="declaredesign.html#cb114-7" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-8"><a href="declaredesign.html#cb114-8" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.8</span>,<span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb114-9"><a href="declaredesign.html#cb114-9" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>effect)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="plotting.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-exploration.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/kleuveld/r_cheatsheet/edit/main/chapters/04-declaredesign.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
