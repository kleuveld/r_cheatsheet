<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Power Analysis using DeclareDesign | R Cheat Sheet</title>
  <meta name="description" content="This page contains some quick R tips." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Power Analysis using DeclareDesign | R Cheat Sheet" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains some quick R tips." />
  <meta name="github-repo" content="kleuveld/r_cheatsheet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Power Analysis using DeclareDesign | R Cheat Sheet" />
  
  <meta name="twitter:description" content="This page contains some quick R tips." />
  

<meta name="author" content="Koen" />


<meta name="date" content="2024-10-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="plotting.html"/>
<link rel="next" href="data-exploration.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Cheat Sheet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i>Setting up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i>Data Wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#basic-data-manipulation"><i class="fa fa-check"></i>Basic Data Manipulation</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-or-reshaping"><i class="fa fa-check"></i>Pivoting (or reshaping)</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#creating-fake-data"><i class="fa fa-check"></i>Creating fake data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-long-to-wide"><i class="fa fa-check"></i>Pivoting long to wide</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-wide-to-long"><i class="fa fa-check"></i>Pivoting wide to long</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#joining-or-merging-data"><i class="fa fa-check"></i>Joining (or merging) data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#summarizing-over-groups-or-collapsing-data"><i class="fa fa-check"></i>Summarizing over groups (or collapsing data)</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#row-wise-operations"><i class="fa fa-check"></i>Row-wise Operations</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#across-doing-the-same-operations-on-multiple-variables-using-across"><i class="fa fa-check"></i>across(): doing the same operations on multiple variables using across</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#c_across-passing-values-from-multiple-variables-to-summarizing-functions"><i class="fa fa-check"></i>c_across(): passing values from multiple variables to summarizing functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#seperate_longer"><i class="fa fa-check"></i>Splitting multi-response variable into dummies</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#renaming-many-variables"><i class="fa fa-check"></i>Renaming many variables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i>Estimating and reporting</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#generating-some-fake-data"><i class="fa fa-check"></i>Generating some fake data</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#making-a-table-of-summary-statistics"><i class="fa fa-check"></i>Making a table of summary statistics</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#using-modelsummary-and-flextable"><i class="fa fa-check"></i>Using modelsummary and flextable</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#balance-table"><i class="fa fa-check"></i>Balance Table</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#advanced-using-only-flextable"><i class="fa fa-check"></i>Advanced: Using only Flextable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#simple-regression"><i class="fa fa-check"></i>Simple regression</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#robust-standard-errors"><i class="fa fa-check"></i>Robust standard errors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i>Plotting using ggplot</a>
<ul>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#scatter-plot"><i class="fa fa-check"></i>Scatter plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#bar-chart"><i class="fa fa-check"></i>Bar chart</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#faceting"><i class="fa fa-check"></i>Faceting</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#stacked-wur"><i class="fa fa-check"></i>Stacked bar chart with WUR template and observation counts</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#ordering-of-labels"><i class="fa fa-check"></i>Ordering of labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#lollipop-plot"><i class="fa fa-check"></i>Lollipop plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#maps"><i class="fa fa-check"></i>Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html"><i class="fa fa-check"></i>Power Analysis using DeclareDesign</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#simple-power-calculation"><i class="fa fa-check"></i>Simple Power Calculation</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#loading-data"><i class="fa fa-check"></i>Loading data</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#diagnosing-design-and-calculating-power"><i class="fa fa-check"></i>Diagnosing Design and calculating power</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#dif-in-diff"><i class="fa fa-check"></i>Dif in diff</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#propsensity-score-matching"><i class="fa fa-check"></i>Propsensity score matching</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design-1"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#checking-balance"><i class="fa fa-check"></i>Checking balance</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#bias"><i class="fa fa-check"></i>Bias</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#power"><i class="fa fa-check"></i>Power</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i>Data Exploration</a>
<ul>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#setup-1"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#making-a-codebook-from-a-stata-.dta"><i class="fa fa-check"></i>Making a codebook from a Stata .dta</a></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#correlogram"><i class="fa fa-check"></i>Correlogram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i>Programming with R</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#loops"><i class="fa fa-check"></i>Loops</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#basic-functions"><i class="fa fa-check"></i>Basic Functions</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions-and-the-tidyverse"><i class="fa fa-check"></i>Functions and the tidyverse</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#plot-function"><i class="fa fa-check"></i>Example 1: Re-using plot specifications</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#example-2-function-to-create-dummies-from-text"><i class="fa fa-check"></i>Example 2: Function to create dummies from text</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#map"><i class="fa fa-check"></i>Map()</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Cheat Sheet</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="declaredesign" class="section level1 hasAnchor">
<h1>Power Analysis using DeclareDesign<a href="declaredesign.html#declaredesign" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="https://declaredesign.org/">DeclareDesign</a> is a system to simulate Research Designs. This is useful for power
analysis, because it is often hard to include things like clustering and
covariates in standard power calculators.</p>
<p>Resources for learning about DeclareDesign:</p>
<ul>
<li><a href="https://macartan.github.io/slides/202211_declaredesign_and_power.html">Slides by the authors of DeclareDesign: Graeme Blair, Alex Coppock, Macartan Humphreys</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/declaredesign.pdf">The DeclareDesign CheatSheet</a></li>
<li>The book <a href="https://book.declaredesign.org/">Research Design in the Social Sciences: Declaration, Diagnosis, and Redesign</a></li>
</ul>
<p>Read at least the slides before going forward!</p>
<div id="simple-power-calculation" class="section level2 hasAnchor">
<h2>Simple Power Calculation<a href="declaredesign.html#simple-power-calculation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s first do some power calcuations.
I will use Rhomis data from Burundi, you can get the data
<a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/9M6EHS">here</a>.</p>
<div id="loading-data" class="section level3 hasAnchor">
<h3>Loading data<a href="declaredesign.html#loading-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I do some data wrangling, like creating village codes based on y-coordinates,
and some assorted cleaning.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="declaredesign.html#cb81-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb81-2"><a href="declaredesign.html#cb81-2" tabindex="-1"></a><span class="fu">library</span>(DeclareDesign)</span>
<span id="cb81-3"><a href="declaredesign.html#cb81-3" tabindex="-1"></a></span>
<span id="cb81-4"><a href="declaredesign.html#cb81-4" tabindex="-1"></a>n_clusters <span class="ot">=</span> <span class="dv">18</span></span>
<span id="cb81-5"><a href="declaredesign.html#cb81-5" tabindex="-1"></a></span>
<span id="cb81-6"><a href="declaredesign.html#cb81-6" tabindex="-1"></a>rhomis <span class="ot">&lt;-</span></span>
<span id="cb81-7"><a href="declaredesign.html#cb81-7" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">&quot;data/RHoMIS_Indicators.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-8"><a href="declaredesign.html#cb81-8" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">&quot;Burundi&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="declaredesign.html#cb81-9" tabindex="-1"></a></span>
<span id="cb81-10"><a href="declaredesign.html#cb81-10" tabindex="-1"></a>  <span class="co"># split the sample in villages, by lattitude</span></span>
<span id="cb81-11"><a href="declaredesign.html#cb81-11" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(GPS_LAT)) <span class="sc">%&gt;%</span></span>
<span id="cb81-12"><a href="declaredesign.html#cb81-12" tabindex="-1"></a>  <span class="fu">arrange</span>(GPS_LAT) <span class="sc">%&gt;%</span></span>
<span id="cb81-13"><a href="declaredesign.html#cb81-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">village =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">each =</span> <span class="fu">nrow</span>(.) <span class="sc">/</span> n_clusters , <span class="at">length.out =</span>  <span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb81-14"><a href="declaredesign.html#cb81-14" tabindex="-1"></a>  <span class="fu">select</span>(village,HHsizeMAE,HouseholdType,Head_EducationLevel,LandOwned,HFIAS_status,NFertInput) <span class="sc">%&gt;%</span></span>
<span id="cb81-15"><a href="declaredesign.html#cb81-15" tabindex="-1"></a>  </span>
<span id="cb81-16"><a href="declaredesign.html#cb81-16" tabindex="-1"></a>  <span class="co"># create some variables</span></span>
<span id="cb81-17"><a href="declaredesign.html#cb81-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HFIAS_status =</span> <span class="fu">factor</span>(HFIAS_status, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FoodSecure&quot;</span>, <span class="st">&quot;MildlyFI&quot;</span>, <span class="st">&quot;ModeratelyFI&quot;</span>, <span class="st">&quot;SeverelyFI&quot;</span>)),</span>
<span id="cb81-18"><a href="declaredesign.html#cb81-18" tabindex="-1"></a>         <span class="at">food_secure =</span> <span class="dv">1</span> <span class="sc">*</span> (<span class="fu">as.numeric</span>(HFIAS_status) <span class="sc">&lt;=</span> <span class="dv">3</span>),</span>
<span id="cb81-19"><a href="declaredesign.html#cb81-19" tabindex="-1"></a>         <span class="at">educated =</span> <span class="dv">1</span><span class="sc">*</span>(Head_EducationLevel <span class="sc">!=</span> <span class="st">&quot;No_school&quot;</span>),</span>
<span id="cb81-20"><a href="declaredesign.html#cb81-20" tabindex="-1"></a>         <span class="at">female =</span> <span class="dv">1</span><span class="sc">*</span> (HouseholdType <span class="sc">==</span> <span class="st">&quot;woman_single&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-21"><a href="declaredesign.html#cb81-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hh =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb81-22"><a href="declaredesign.html#cb81-22" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>HFIAS_status) <span class="sc">%&gt;%</span></span>
<span id="cb81-23"><a href="declaredesign.html#cb81-23" tabindex="-1"></a></span>
<span id="cb81-24"><a href="declaredesign.html#cb81-24" tabindex="-1"></a>  <span class="co"># there are too many missings in my data; these seem reasonable to assume to be 0 when missing:</span></span>
<span id="cb81-25"><a href="declaredesign.html#cb81-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(LandOwned,NFertInput,educated),</span>
<span id="cb81-26"><a href="declaredesign.html#cb81-26" tabindex="-1"></a>              <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.x),<span class="dv">0</span>,.x)))</span>
<span id="cb81-27"><a href="declaredesign.html#cb81-27" tabindex="-1"></a></span>
<span id="cb81-28"><a href="declaredesign.html#cb81-28" tabindex="-1"></a></span>
<span id="cb81-29"><a href="declaredesign.html#cb81-29" tabindex="-1"></a><span class="fu">mean</span>(rhomis<span class="sc">$</span>HFIAS_status <span class="sc">==</span> <span class="st">&quot;FoodSecure&quot;</span>)</span></code></pre></div>
<pre><code>## [1] NaN</code></pre>
</div>
<div id="declare-design" class="section level3 hasAnchor">
<h3>Declare Design<a href="declaredesign.html#declare-design" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now it’s time to start declaring our design. The first element of the
design is the model, using <code>declare_model()</code> which essentially is my data.
<code>declare_model()</code> follows the syntax of <code>fabricate()</code>,
which allows you to generate an entirely new dataset.
For now we stick with existing data,
but the syntax is still the same as <code>fabricate()</code>,
so insead of using <code>mutate()</code> we can just supply new variables
after a comma.
In this case, I add potential outcomes, using <code>potential_outcomes()</code>.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="declaredesign.html#cb83-1" tabindex="-1"></a>effect_size_simple <span class="ot">&lt;-</span> <span class="dv">70</span></span>
<span id="cb83-2"><a href="declaredesign.html#cb83-2" tabindex="-1"></a></span>
<span id="cb83-3"><a href="declaredesign.html#cb83-3" tabindex="-1"></a>model_simple <span class="ot">&lt;-</span> </span>
<span id="cb83-4"><a href="declaredesign.html#cb83-4" tabindex="-1"></a>  <span class="fu">declare_model</span>(</span>
<span id="cb83-5"><a href="declaredesign.html#cb83-5" tabindex="-1"></a>    rhomis,</span>
<span id="cb83-6"><a href="declaredesign.html#cb83-6" tabindex="-1"></a>    <span class="fu">potential_outcomes</span>(Y <span class="sc">~</span> NFertInput <span class="sc">+</span> Z <span class="sc">*</span> effect_size_simple)</span>
<span id="cb83-7"><a href="declaredesign.html#cb83-7" tabindex="-1"></a>)</span></code></pre></div>
<p>The potential outcomes are generated using <code>potential_outcomes()</code>.
This will create two variables <code>Y_Z_1</code> and <code>Y_Z_0</code>, which are
the potential outcomes if having received treatment (<code>Z == 1</code>) or not.
Note that I will generate <code>Z</code> in the next step.</p>
<p>Then it’s time to think about assignment.
I do a clustered randomization, based on the villages:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="declaredesign.html#cb84-1" tabindex="-1"></a>assignment_simple <span class="ot">&lt;-</span></span>
<span id="cb84-2"><a href="declaredesign.html#cb84-2" tabindex="-1"></a>  <span class="fu">declare_assignment</span>(<span class="at">Z =</span> <span class="fu">cluster_ra</span>(<span class="at">clusters =</span> village, <span class="at">prob =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p>Next, I declare my theoretical quantity of interest is the treatment
effect in year 1.
This is basically my research question.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="declaredesign.html#cb85-1" tabindex="-1"></a>inquiry_simple <span class="ot">&lt;-</span>  </span>
<span id="cb85-2"><a href="declaredesign.html#cb85-2" tabindex="-1"></a>  <span class="fu">declare_inquiry</span>(<span class="at">ATE =</span> <span class="fu">mean</span>(Y_Z_1 <span class="sc">-</span> Y_Z_0)) </span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="declaredesign.html#cb86-1" tabindex="-1"></a>measurement_simple <span class="ot">&lt;-</span> <span class="fu">declare_measurement</span>(</span>
<span id="cb86-2"><a href="declaredesign.html#cb86-2" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">reveal_outcomes</span>(Y<span class="sc">~</span>Z)</span>
<span id="cb86-3"><a href="declaredesign.html#cb86-3" tabindex="-1"></a>)</span></code></pre></div>
<p>Since I won’t be able to observe Y_Z_1 for the control group, nor Y_Z_0 for the treatment group,
I will need an estimation strategy.
A simple difference in means:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="declaredesign.html#cb87-1" tabindex="-1"></a>estimator_simple <span class="ot">&lt;-</span></span>
<span id="cb87-2"><a href="declaredesign.html#cb87-2" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> Z,</span>
<span id="cb87-3"><a href="declaredesign.html#cb87-3" tabindex="-1"></a>                    <span class="at">clusters =</span> village, </span>
<span id="cb87-4"><a href="declaredesign.html#cb87-4" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb87-5"><a href="declaredesign.html#cb87-5" tabindex="-1"></a>                    <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>, </span>
<span id="cb87-6"><a href="declaredesign.html#cb87-6" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;Simple&quot;</span>)</span></code></pre></div>
<p>Finally, I combine all these elements to declare my design. Note that
it’s only here that R starts actually running the code to randomize
things. The previous was just declaration!</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="declaredesign.html#cb88-1" tabindex="-1"></a>design_simple <span class="ot">&lt;-</span> model_simple <span class="sc">+</span> assignment_simple <span class="sc">+</span> inquiry_simple <span class="sc">+</span> measurement_simple <span class="sc">+</span> estimator_simple</span>
<span id="cb88-2"><a href="declaredesign.html#cb88-2" tabindex="-1"></a><span class="fu">summary</span>(design_simple)</span></code></pre></div>
<pre><code>## 
## Research design declaration summary
## 
## Step 1 (model): declare_model(rhomis, potential_outcomes(Y ~ NFertInput + Z * effect_size_simple)) 
## 
## N = 290 
## 
## Added variable: village 
##  min median mean max   sd N_missing N_unique
##    1      9 9.44  18 5.23         0       18
## 
## Added variable: HHsizeMAE 
##  min median mean  max   sd N_missing N_unique
##  0.6   4.36 4.46 9.29 1.77         0      171
## 
## Added variable: HouseholdType 
##  couple man_single polygamous woman_single
##     218          4          7           61
##    0.75       0.01       0.02         0.21
## 
## Added variable: Head_EducationLevel 
##  N_missing N_unique     class
##         70        6 character
## 
## Added variable: LandOwned 
##  min median mean  max   sd N_missing N_unique
##    0      1 5.39 1000 58.8         0       63
## 
## Added variable: NFertInput 
##  min median  mean  max     sd N_missing N_unique
##    0     16 72.71 7500 465.79         0       44
## 
## Added variable: food_secure 
##     0    1
##   160  130
##  0.55 0.45
## 
## Added variable: educated 
##     0    1
##   106  184
##  0.37 0.63
## 
## Added variable: female 
##     0    1
##   229   61
##  0.79 0.21
## 
## Added variable: hh 
##  min median  mean max    sd N_missing N_unique
##    1  145.5 145.5 290 83.86         0      290
## 
## Added variable: ID 
##  N_missing N_unique     class
##          0      290 character
## 
## Added variable: Y_Z_0 
##  min median  mean  max     sd N_missing N_unique
##    0     16 72.71 7500 465.79         0       44
## 
## Added variable: Y_Z_1 
##  min median   mean  max     sd N_missing N_unique
##   70     86 142.71 7570 465.79         0       44
## 
## Step 2 (assignment): declare_assignment(Z = cluster_ra(clusters = village, prob = 0.5)) 
## 
## Added variable: Z 
##     0    1
##   144  146
##  0.50 0.50
## 
## Step 3 (inquiry): declare_inquiry(ATE = mean(Y_Z_1 - Y_Z_0)) -------------------
## 
## A single draw of the inquiry:
##  inquiry estimand
##      ATE       70
## 
## Step 4 (measurement): declare_measurement(Y = reveal_outcomes(Y ~ Z)) ----------
## 
## Added variable: Y 
##  min median   mean  max     sd N_missing N_unique
##    0     70 107.95 7570 469.47         0       62
## 
## Step 5 (estimator): declare_estimator(Y ~ Z, clusters = village, inquiry = &quot;ATE&quot;, term = &quot;Z&quot;, label = &quot;Simple&quot;) 
## 
## Formula: Y ~ Z 
## 
## A single draw of the estimator:
##  term estimator estimate std.error statistic    p.value conf.low conf.high
##     Z    Simple 132.8381  59.24667  2.242119 0.03948933 7.231944  258.4442
##        df outcome inquiry
##  15.98618       Y     ATE</code></pre>
<p>Note that the results of my three estimators are identical, which is as expected.</p>
</div>
<div id="diagnosing-design-and-calculating-power" class="section level3 hasAnchor">
<h3>Diagnosing Design and calculating power<a href="declaredesign.html#diagnosing-design-and-calculating-power" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you want to browse a version of the data created by your design,
use the <code>draw_data()</code> function. This is useful to examine the properties of the data.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="declaredesign.html#cb90-1" tabindex="-1"></a><span class="fu">draw_data</span>(design_simple) <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="declaredesign.html#cb90-2" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>## # A tibble: 290 × 15
##    village HHsizeMAE HouseholdType Head_EducationLevel LandOwned NFertInput
##      &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt;
##  1       1      2.2  woman_single  &lt;NA&gt;                    3.12           5
##  2       1      6.9  couple        primary                 4.69          26
##  3       1      1.86 couple        No_school               2             40
##  4       1      6.92 polygamous    &lt;NA&gt;                    0.72           0
##  5       1      7.06 couple        primary                 0.312         10
##  6       1      4.3  couple        No_school               0.5           25
##  7       1      4.94 couple        primary                 1.25          25
##  8       1      5.06 couple        primary                 1             60
##  9       1      1.5  couple        primary                37              0
## 10       1      2.18 couple        primary                 1.88           0
## # ℹ 280 more rows
## # ℹ 9 more variables: food_secure &lt;dbl&gt;, educated &lt;dbl&gt;, female &lt;dbl&gt;,
## #   hh &lt;int&gt;, ID &lt;chr&gt;, Y_Z_0 &lt;dbl&gt;, Y_Z_1 &lt;dbl&gt;, Z &lt;int&gt;, Y &lt;dbl&gt;</code></pre>
<p>Now to calculate our power. The <code>diagnose_design()</code> will run our
model 500 times and our power is simply the fraction of times we
find a statistically significant effect.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="declaredesign.html#cb92-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb92-2"><a href="declaredesign.html#cb92-2" tabindex="-1"></a><span class="fu">diagnose_design</span>(design_simple)</span></code></pre></div>
<pre><code>## 
## Research design diagnosis based on 500 simulations. Diagnosis completed in 5 secs. Diagnosand estimates with bootstrapped standard errors in parentheses (100 replicates).
## 
##         Design Inquiry Estimator Outcome Term N Sims Mean Estimand
##  design_simple     ATE    Simple       Y    Z    500         70.00
##                                                             (0.00)
##  Mean Estimate   Bias SD Estimate   RMSE  Power Coverage
##          67.30  -2.70       59.82  59.82   0.23     1.00
##         (2.38) (2.38)      (0.84) (0.81) (0.02)   (0.00)</code></pre>
<p>Our power is 0.23, meaning we found a significant result in 23%
of our model runs.
That’s way lower than the traditional 80% threshold.</p>
<p>How large should our effect size be to reach a power of 0.8?
We can use the <code>redesign()</code> function for this.
Redesign allows you to vary certain parameters of your design,
and run the design 500 times for each value of the parameter.
Here I set it to run 200 times, as that takes long enough
already.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="declaredesign.html#cb94-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb94-2"><a href="declaredesign.html#cb94-2" tabindex="-1"></a>diagnosis_simple <span class="ot">&lt;-</span></span>
<span id="cb94-3"><a href="declaredesign.html#cb94-3" tabindex="-1"></a>  design_simple <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="declaredesign.html#cb94-4" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">effect_size_simple =</span> <span class="fu">seq</span>(<span class="dv">100</span>,<span class="dv">300</span>,<span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="declaredesign.html#cb94-5" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-6"><a href="declaredesign.html#cb94-6" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="declaredesign.html#cb94-7" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Now, I want a nice plot.
For this I filter the tibble I created, and pipe it into <code>ggplot()</code>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="declaredesign.html#cb95-1" tabindex="-1"></a>diagnosis_simple <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="declaredesign.html#cb95-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;power&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="declaredesign.html#cb95-3" tabindex="-1"></a>  <span class="fu">select</span>(effect_size_simple,<span class="at">power =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="declaredesign.html#cb95-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> effect_size_simple, <span class="at">y =</span> power)) <span class="sc">+</span></span>
<span id="cb95-5"><a href="declaredesign.html#cb95-5" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb95-6"><a href="declaredesign.html#cb95-6" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb95-7"><a href="declaredesign.html#cb95-7" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.8</span>,<span class="at">linetype=</span><span class="dv">2</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>We can reliably detect an effect size between 150 and 200 kgs of fertilizer.
The mean fertilizer use is 70kg, so that seems unlikely to be realistic.
Perhaps we should add covariates?</p>
<div id="adding-more-estimators" class="section level4 hasAnchor">
<h4>Adding more estimators<a href="declaredesign.html#adding-more-estimators" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>I define another estimator that includes covariates in
its model specification, and add it to my original design,
hoping this will increase power.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="declaredesign.html#cb96-1" tabindex="-1"></a>estimator_simple_cov <span class="ot">&lt;-</span></span>
<span id="cb96-2"><a href="declaredesign.html#cb96-2" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> Z <span class="sc">+</span> LandOwned <span class="sc">+</span> educated <span class="sc">+</span> female,</span>
<span id="cb96-3"><a href="declaredesign.html#cb96-3" tabindex="-1"></a>                    <span class="at">clusters =</span> village, </span>
<span id="cb96-4"><a href="declaredesign.html#cb96-4" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb96-5"><a href="declaredesign.html#cb96-5" tabindex="-1"></a>                    <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>, </span>
<span id="cb96-6"><a href="declaredesign.html#cb96-6" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;Simple Cov&quot;</span>)</span>
<span id="cb96-7"><a href="declaredesign.html#cb96-7" tabindex="-1"></a></span>
<span id="cb96-8"><a href="declaredesign.html#cb96-8" tabindex="-1"></a></span>
<span id="cb96-9"><a href="declaredesign.html#cb96-9" tabindex="-1"></a>design_simple_cov <span class="ot">&lt;-</span> design_simple <span class="sc">+</span> estimator_simple_cov</span>
<span id="cb96-10"><a href="declaredesign.html#cb96-10" tabindex="-1"></a></span>
<span id="cb96-11"><a href="declaredesign.html#cb96-11" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb96-12"><a href="declaredesign.html#cb96-12" tabindex="-1"></a>diagnosis_simple_cov <span class="ot">&lt;-</span></span>
<span id="cb96-13"><a href="declaredesign.html#cb96-13" tabindex="-1"></a>  design_simple_cov <span class="sc">%&gt;%</span></span>
<span id="cb96-14"><a href="declaredesign.html#cb96-14" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">effect_size_simple =</span> <span class="fu">seq</span>(<span class="dv">100</span>,<span class="dv">300</span>,<span class="dv">50</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-15"><a href="declaredesign.html#cb96-15" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-16"><a href="declaredesign.html#cb96-16" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb96-17"><a href="declaredesign.html#cb96-17" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="declaredesign.html#cb97-1" tabindex="-1"></a>diagnosis_simple_cov <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="declaredesign.html#cb97-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;power&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="declaredesign.html#cb97-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">power =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="declaredesign.html#cb97-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> effect_size_simple, <span class="at">y =</span> power, <span class="at">color =</span> estimator, <span class="at">shape =</span> estimator)) <span class="sc">+</span></span>
<span id="cb97-5"><a href="declaredesign.html#cb97-5" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb97-6"><a href="declaredesign.html#cb97-6" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb97-7"><a href="declaredesign.html#cb97-7" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.8</span>,<span class="at">linetype=</span><span class="dv">2</span>) </span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;diagnosis_simple_cov&#39; not found</code></pre>
<p>Turns out it doesn’t help at all…</p>
</div>
</div>
</div>
<div id="dif-in-diff" class="section level2 hasAnchor">
<h2>Dif in diff<a href="declaredesign.html#dif-in-diff" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can of course also opt for a diff-in-diff design.
But then we have to pretend we have two rounds of data collection.</p>
<p>For that, I prefer to use <code>dplyr</code>,
but it should be possible with <code>fabricate()</code> as well.
I first rename all our time-variant varaible to have <code>_0</code> at the end,
create a bunch of correlated varaibles with <code>_1</code> at the end, and then <code>pivot_longer</code>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="declaredesign.html#cb99-1" tabindex="-1"></a>effect_size_dd <span class="ot">&lt;-</span> <span class="dv">70</span></span>
<span id="cb99-2"><a href="declaredesign.html#cb99-2" tabindex="-1"></a>sd_dd <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb99-3"><a href="declaredesign.html#cb99-3" tabindex="-1"></a></span>
<span id="cb99-4"><a href="declaredesign.html#cb99-4" tabindex="-1"></a>model_dd <span class="ot">&lt;-</span> <span class="fu">declare_model</span>(</span>
<span id="cb99-5"><a href="declaredesign.html#cb99-5" tabindex="-1"></a>    rhomis <span class="sc">%&gt;%</span></span>
<span id="cb99-6"><a href="declaredesign.html#cb99-6" tabindex="-1"></a>        <span class="co"># add one more year</span></span>
<span id="cb99-7"><a href="declaredesign.html#cb99-7" tabindex="-1"></a>        <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_0&quot;</span>), HHsizeMAE<span class="sc">:</span>female) <span class="sc">%&gt;%</span></span>
<span id="cb99-8"><a href="declaredesign.html#cb99-8" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">food_secure_1 =</span> <span class="fu">correlate</span>(<span class="at">given =</span> food_secure_0, <span class="at">draw_handler =</span> draw_binomial, <span class="at">prob =</span> <span class="fu">mean</span>(food_secure_0) , <span class="at">rho =</span> <span class="fl">0.9</span>),</span>
<span id="cb99-9"><a href="declaredesign.html#cb99-9" tabindex="-1"></a>               <span class="at">HHsizeMAE_1 =</span> HHsizeMAE_0 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb99-10"><a href="declaredesign.html#cb99-10" tabindex="-1"></a>               <span class="at">NFertInput_1 =</span> <span class="fu">pmax</span>(<span class="dv">0</span>,NFertInput_0 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd_dd))) <span class="sc">%&gt;%</span></span>
<span id="cb99-11"><a href="declaredesign.html#cb99-11" tabindex="-1"></a>        <span class="fu">pivot_longer</span>(<span class="fu">ends_with</span>(<span class="fu">c</span>(<span class="st">&quot;_0&quot;</span>,<span class="st">&quot;_1&quot;</span>)), </span>
<span id="cb99-12"><a href="declaredesign.html#cb99-12" tabindex="-1"></a>                     <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;t&quot;</span>),</span>
<span id="cb99-13"><a href="declaredesign.html#cb99-13" tabindex="-1"></a>                     <span class="at">names_pattern =</span> <span class="st">&quot;(.*)_([0-9]+)$&quot;</span>,</span>
<span id="cb99-14"><a href="declaredesign.html#cb99-14" tabindex="-1"></a>                     <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>,</span>
<span id="cb99-15"><a href="declaredesign.html#cb99-15" tabindex="-1"></a>                     <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">t =</span> as.integer)),</span>
<span id="cb99-16"><a href="declaredesign.html#cb99-16" tabindex="-1"></a>    <span class="fu">potential_outcomes</span>(Y <span class="sc">~</span> NFertInput <span class="sc">+</span> Z <span class="sc">*</span> effect_size_dd)</span>
<span id="cb99-17"><a href="declaredesign.html#cb99-17" tabindex="-1"></a></span>
<span id="cb99-18"><a href="declaredesign.html#cb99-18" tabindex="-1"></a></span>
<span id="cb99-19"><a href="declaredesign.html#cb99-19" tabindex="-1"></a>)</span></code></pre></div>
<p>I modify the inquiry and assignment to only take into account <code>t == 1</code></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="declaredesign.html#cb100-1" tabindex="-1"></a>inquiry_dd <span class="ot">&lt;-</span>  </span>
<span id="cb100-2"><a href="declaredesign.html#cb100-2" tabindex="-1"></a>  <span class="fu">declare_inquiry</span>(<span class="at">ATE =</span> <span class="fu">mean</span>(Y_Z_1 <span class="sc">-</span> Y_Z_0), <span class="at">subset =</span> (t <span class="sc">==</span> <span class="dv">1</span>)) </span>
<span id="cb100-3"><a href="declaredesign.html#cb100-3" tabindex="-1"></a></span>
<span id="cb100-4"><a href="declaredesign.html#cb100-4" tabindex="-1"></a></span>
<span id="cb100-5"><a href="declaredesign.html#cb100-5" tabindex="-1"></a></span>
<span id="cb100-6"><a href="declaredesign.html#cb100-6" tabindex="-1"></a></span>
<span id="cb100-7"><a href="declaredesign.html#cb100-7" tabindex="-1"></a>assignment_dd <span class="ot">&lt;-</span></span>
<span id="cb100-8"><a href="declaredesign.html#cb100-8" tabindex="-1"></a>  <span class="fu">declare_assignment</span>(<span class="at">treatment_group =</span> <span class="fu">cluster_ra</span>(<span class="at">clusters =</span> village, <span class="at">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb100-9"><a href="declaredesign.html#cb100-9" tabindex="-1"></a>                     <span class="at">Z =</span> t <span class="sc">*</span> treatment_group)</span></code></pre></div>
<p>Measurement is unchanged:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="declaredesign.html#cb101-1" tabindex="-1"></a>measurement_dd <span class="ot">&lt;-</span> <span class="fu">declare_measurement</span>(</span>
<span id="cb101-2"><a href="declaredesign.html#cb101-2" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">reveal_outcomes</span>(Y<span class="sc">~</span>Z)</span>
<span id="cb101-3"><a href="declaredesign.html#cb101-3" tabindex="-1"></a></span>
<span id="cb101-4"><a href="declaredesign.html#cb101-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Then I use <a href="https://lrberge.github.io/fixest/reference/feols.html"><code>feols()</code></a>
from the <a href="https://lrberge.github.io/fixest/index.html">fixest</a>
package to estimate a Two-way fixed effects (2FE) model.
This can be easily extended to more complex
designs (<a href="https://doi.org/10.1017/pan.2020.33">but beware!</a>).</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="declaredesign.html#cb102-1" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb102-2"><a href="declaredesign.html#cb102-2" tabindex="-1"></a><span class="co"># library(broom)</span></span>
<span id="cb102-3"><a href="declaredesign.html#cb102-3" tabindex="-1"></a></span>
<span id="cb102-4"><a href="declaredesign.html#cb102-4" tabindex="-1"></a>estimator_dd <span class="ot">&lt;-</span></span>
<span id="cb102-5"><a href="declaredesign.html#cb102-5" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> Z <span class="sc">|</span> treatment_group <span class="sc">+</span> t,</span>
<span id="cb102-6"><a href="declaredesign.html#cb102-6" tabindex="-1"></a>                    <span class="at">cluster =</span> <span class="st">&quot;village&quot;</span>,</span>
<span id="cb102-7"><a href="declaredesign.html#cb102-7" tabindex="-1"></a>                    <span class="at">.method =</span> feols, </span>
<span id="cb102-8"><a href="declaredesign.html#cb102-8" tabindex="-1"></a>                    <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>, </span>
<span id="cb102-9"><a href="declaredesign.html#cb102-9" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb102-10"><a href="declaredesign.html#cb102-10" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;2FE&quot;</span>)</span></code></pre></div>
<p>Let’s have a look at our power now!
Of course, in a DiD setting, power depends not only on the effect size, but also on how well the years correlate.
I therefore also vary the <code>sd_dd</code> variable, which adds increase between-year variation</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="declaredesign.html#cb103-1" tabindex="-1"></a>design_dd <span class="ot">&lt;-</span> model_dd <span class="sc">+</span> assignment_dd <span class="sc">+</span> inquiry_dd <span class="sc">+</span> measurement_dd <span class="sc">+</span> estimator_dd</span>
<span id="cb103-2"><a href="declaredesign.html#cb103-2" tabindex="-1"></a></span>
<span id="cb103-3"><a href="declaredesign.html#cb103-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb103-4"><a href="declaredesign.html#cb103-4" tabindex="-1"></a>diagnosis_dd <span class="ot">&lt;-</span></span>
<span id="cb103-5"><a href="declaredesign.html#cb103-5" tabindex="-1"></a>  design_dd <span class="sc">%&gt;%</span></span>
<span id="cb103-6"><a href="declaredesign.html#cb103-6" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">effect_size_dd =</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">90</span>,<span class="dv">20</span>),</span>
<span id="cb103-7"><a href="declaredesign.html#cb103-7" tabindex="-1"></a>           <span class="at">sd_dd =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">200</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb103-8"><a href="declaredesign.html#cb103-8" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-9"><a href="declaredesign.html#cb103-9" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb103-10"><a href="declaredesign.html#cb103-10" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Our power is now a lot better, even if we turn up the variance</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="declaredesign.html#cb104-1" tabindex="-1"></a>diagnosis_dd <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="declaredesign.html#cb104-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;power&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="declaredesign.html#cb104-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">power =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="declaredesign.html#cb104-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sd_dd =</span> <span class="fu">factor</span>(sd_dd)) <span class="sc">%&gt;%</span></span>
<span id="cb104-5"><a href="declaredesign.html#cb104-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> effect_size_dd, <span class="at">y =</span> power, <span class="at">color =</span> sd_dd, <span class="at">shape =</span> sd_dd)) <span class="sc">+</span></span>
<span id="cb104-6"><a href="declaredesign.html#cb104-6" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb104-7"><a href="declaredesign.html#cb104-7" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb104-8"><a href="declaredesign.html#cb104-8" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.8</span>,<span class="at">linetype=</span><span class="dv">2</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
</div>
<div id="propsensity-score-matching" class="section level2 hasAnchor">
<h2>Propsensity score matching<a href="declaredesign.html#propsensity-score-matching" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finally, let’s imagine a Propensity Score matching scenario. We therefore need
to pretend treatment isn’t random, but is correlated to the outcome.</p>
<p>Let’s also look at <code>food_secure</code>, since it’s binary, and thus adds a twist here and there.</p>
<p>Finally, I will use the <code>resample_data()</code> function to pretend that we can visit
more households than are in my original data set.</p>
<div id="declare-design-1" class="section level3 hasAnchor">
<h3>Declare Design<a href="declaredesign.html#declare-design-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s put this in declare design.</p>
<p>Treatment assignment is as follows:</p>
<ul>
<li>50% of the villages are selected for treatment. This is just random.</li>
<li>Roughly 50% of the households are selected. The selection indicator will have
a correlation of <code>rho</code> with the household being educated, using <code>fabricatr</code>’s
<code>correlate()</code> function.
Education is also a strong predictor of <code>food_security</code>, creating inherent bias.</li>
</ul>
<p>I compare a standard difference in means, as well as a custom matching function that
uses the <code>MatchIt</code> package to create a balanced data set, that I can then use for
regular regressions, weighted by the propensity score.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="declaredesign.html#cb105-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb105-2"><a href="declaredesign.html#cb105-2" tabindex="-1"></a></span>
<span id="cb105-3"><a href="declaredesign.html#cb105-3" tabindex="-1"></a><span class="fu">library</span>(MatchIt, <span class="fu">exclude</span>(<span class="st">&quot;select&quot;</span>)) <span class="co"># the select function would conflict with dplyr</span></span>
<span id="cb105-4"><a href="declaredesign.html#cb105-4" tabindex="-1"></a>                                    <span class="co"># this syntax requires R 4.0 or higher</span></span>
<span id="cb105-5"><a href="declaredesign.html#cb105-5" tabindex="-1"></a></span>
<span id="cb105-6"><a href="declaredesign.html#cb105-6" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb105-7"><a href="declaredesign.html#cb105-7" tabindex="-1"></a>effect <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb105-8"><a href="declaredesign.html#cb105-8" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb105-9"><a href="declaredesign.html#cb105-9" tabindex="-1"></a></span>
<span id="cb105-10"><a href="declaredesign.html#cb105-10" tabindex="-1"></a></span>
<span id="cb105-11"><a href="declaredesign.html#cb105-11" tabindex="-1"></a>population_psm <span class="ot">&lt;-</span> <span class="fu">declare_population</span>(</span>
<span id="cb105-12"><a href="declaredesign.html#cb105-12" tabindex="-1"></a>  <span class="co"># rhomis %&gt;%</span></span>
<span id="cb105-13"><a href="declaredesign.html#cb105-13" tabindex="-1"></a>  <span class="co">#   mutate(treated_hh = correlate(given = educated, draw_handler = draw_binary, prob = 0.5 , rho = rho),</span></span>
<span id="cb105-14"><a href="declaredesign.html#cb105-14" tabindex="-1"></a>  <span class="co">#          potential_outcomes(Y ~ pmin(1,food_secure + Z * draw_binary(effect,nrow(.)))))</span></span>
<span id="cb105-15"><a href="declaredesign.html#cb105-15" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(rhomis),</span>
<span id="cb105-16"><a href="declaredesign.html#cb105-16" tabindex="-1"></a>  rhomis,</span>
<span id="cb105-17"><a href="declaredesign.html#cb105-17" tabindex="-1"></a>  <span class="fu">potential_outcomes</span>(Y <span class="sc">~</span> <span class="fu">pmin</span>(<span class="dv">1</span>,food_secure <span class="sc">+</span> Z <span class="sc">*</span> <span class="fu">draw_binary</span>(effect,N)))</span>
<span id="cb105-18"><a href="declaredesign.html#cb105-18" tabindex="-1"></a>)</span>
<span id="cb105-19"><a href="declaredesign.html#cb105-19" tabindex="-1"></a></span>
<span id="cb105-20"><a href="declaredesign.html#cb105-20" tabindex="-1"></a></span>
<span id="cb105-21"><a href="declaredesign.html#cb105-21" tabindex="-1"></a></span>
<span id="cb105-22"><a href="declaredesign.html#cb105-22" tabindex="-1"></a>assignment_psm <span class="ot">&lt;-</span> <span class="fu">declare_assignment</span>(</span>
<span id="cb105-23"><a href="declaredesign.html#cb105-23" tabindex="-1"></a>  <span class="at">treated_hh =</span> <span class="fu">correlate</span>(<span class="at">given =</span> educated, <span class="at">draw_handler =</span> draw_binary, <span class="at">prob =</span> <span class="fl">0.5</span> , <span class="at">rho =</span> rho),</span>
<span id="cb105-24"><a href="declaredesign.html#cb105-24" tabindex="-1"></a>  <span class="at">treated_vill =</span> <span class="fu">cluster_ra</span>(<span class="at">clusters =</span> village, <span class="at">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb105-25"><a href="declaredesign.html#cb105-25" tabindex="-1"></a>  <span class="at">Z =</span> treated_hh <span class="sc">*</span> treated_vill</span>
<span id="cb105-26"><a href="declaredesign.html#cb105-26" tabindex="-1"></a>)</span></code></pre></div>
<p>I then re-sample from the original data using <code>resample_hhs()</code> I define below.
To include the funciton in our design, we need to use <code>declare_step()</code></p>
<ul>
<li>I ensure I have more control household than treatment households.</li>
<li>I drop any untreated households in treated villages.</li>
<li>Compared to the treatment hhs in each cluster,
I sample twice the number of control hhs.</li>
</ul>
<p>This simulates that we can’t get control households in treated villages,
for example due to fears of</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="declaredesign.html#cb106-1" tabindex="-1"></a>clusters_treat <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb106-2"><a href="declaredesign.html#cb106-2" tabindex="-1"></a>hh_treat <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb106-3"><a href="declaredesign.html#cb106-3" tabindex="-1"></a></span>
<span id="cb106-4"><a href="declaredesign.html#cb106-4" tabindex="-1"></a>clusters_control_multi <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># multiplier for oversampling control clusters</span></span>
<span id="cb106-5"><a href="declaredesign.html#cb106-5" tabindex="-1"></a>hh_control_multi <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># multiplier for oversampling control hhs</span></span>
<span id="cb106-6"><a href="declaredesign.html#cb106-6" tabindex="-1"></a></span>
<span id="cb106-7"><a href="declaredesign.html#cb106-7" tabindex="-1"></a>resample_hhs <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb106-8"><a href="declaredesign.html#cb106-8" tabindex="-1"></a>  <span class="co"># this function filters any control househols in treated communities</span></span>
<span id="cb106-9"><a href="declaredesign.html#cb106-9" tabindex="-1"></a>  <span class="co"># and it sets the sample size</span></span>
<span id="cb106-10"><a href="declaredesign.html#cb106-10" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb106-11"><a href="declaredesign.html#cb106-11" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">drop =</span> <span class="fu">if_else</span>(treated_vill <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> treated_hh <span class="sc">==</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-12"><a href="declaredesign.html#cb106-12" tabindex="-1"></a>    <span class="fu">filter</span>(drop <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-13"><a href="declaredesign.html#cb106-13" tabindex="-1"></a>      <span class="co"># sample from treated villages and untreated villages</span></span>
<span id="cb106-14"><a href="declaredesign.html#cb106-14" tabindex="-1"></a>      <span class="fu">group_by</span>(treated_vill) <span class="sc">%&gt;%</span></span>
<span id="cb106-15"><a href="declaredesign.html#cb106-15" tabindex="-1"></a>      <span class="fu">do</span>({</span>
<span id="cb106-16"><a href="declaredesign.html#cb106-16" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">unique</span>(.<span class="sc">$</span>treated_vill) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb106-17"><a href="declaredesign.html#cb106-17" tabindex="-1"></a>          <span class="fu">resample_data</span>(., <span class="at">N =</span> <span class="fu">c</span>(<span class="at">village =</span> clusters_treat, <span class="at">hh =</span> hh_treat),<span class="at">unique_labels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-18"><a href="declaredesign.html#cb106-18" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb106-19"><a href="declaredesign.html#cb106-19" tabindex="-1"></a>          <span class="fu">resample_data</span>(., <span class="at">N =</span> <span class="fu">c</span>(<span class="at">village =</span> clusters_control_multi <span class="sc">*</span> clusters_treat, <span class="at">hh =</span> hh_control_multi <span class="sc">*</span> hh_treat), <span class="at">unique_labels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-20"><a href="declaredesign.html#cb106-20" tabindex="-1"></a>        }</span>
<span id="cb106-21"><a href="declaredesign.html#cb106-21" tabindex="-1"></a>      })</span>
<span id="cb106-22"><a href="declaredesign.html#cb106-22" tabindex="-1"></a>}</span>
<span id="cb106-23"><a href="declaredesign.html#cb106-23" tabindex="-1"></a></span>
<span id="cb106-24"><a href="declaredesign.html#cb106-24" tabindex="-1"></a>resampling_psm <span class="ot">&lt;-</span> <span class="fu">declare_step</span>(</span>
<span id="cb106-25"><a href="declaredesign.html#cb106-25" tabindex="-1"></a>  <span class="at">handler =</span> resample_hhs</span>
<span id="cb106-26"><a href="declaredesign.html#cb106-26" tabindex="-1"></a>)</span></code></pre></div>
<p>Measurement and inquiry are standard. I also add an OLS estimator to check for bias.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="declaredesign.html#cb107-1" tabindex="-1"></a>measurement_psm <span class="ot">&lt;-</span> <span class="fu">declare_measurement</span>(<span class="at">Y =</span> <span class="fu">reveal_outcomes</span>(Y <span class="sc">~</span> Z)</span>
<span id="cb107-2"><a href="declaredesign.html#cb107-2" tabindex="-1"></a>) </span>
<span id="cb107-3"><a href="declaredesign.html#cb107-3" tabindex="-1"></a></span>
<span id="cb107-4"><a href="declaredesign.html#cb107-4" tabindex="-1"></a>inquiry_psm <span class="ot">&lt;-</span> <span class="fu">declare_inquiry</span>(<span class="at">ATE =</span> <span class="fu">mean</span>(Y_Z_1 <span class="sc">-</span> Y_Z_0)</span>
<span id="cb107-5"><a href="declaredesign.html#cb107-5" tabindex="-1"></a>)</span>
<span id="cb107-6"><a href="declaredesign.html#cb107-6" tabindex="-1"></a></span>
<span id="cb107-7"><a href="declaredesign.html#cb107-7" tabindex="-1"></a>estimator_notmatched_psm <span class="ot">&lt;-</span> </span>
<span id="cb107-8"><a href="declaredesign.html#cb107-8" tabindex="-1"></a>  <span class="fu">declare_estimator</span>(Y <span class="sc">~</span> Z, </span>
<span id="cb107-9"><a href="declaredesign.html#cb107-9" tabindex="-1"></a>                    <span class="at">clusters =</span> village_unique,</span>
<span id="cb107-10"><a href="declaredesign.html#cb107-10" tabindex="-1"></a>                    <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>, </span>
<span id="cb107-11"><a href="declaredesign.html#cb107-11" tabindex="-1"></a>                    <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>, </span>
<span id="cb107-12"><a href="declaredesign.html#cb107-12" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;Not matched&quot;</span>)</span></code></pre></div>
<p>Finally, I need to somehow put my matching model in DeclareDesign.
Fortunately, you can put any the output of any function into the <code>declare_estimator()</code> function
using the <code>handler</code> argument.
It does need to accept a <code>data</code> argument,
and output a <a href="https://broom.tidymodels.org/articles/broom.html"><code>tidy()</code></a> dataframe.</p>
<p>My function <code>custom_match()</code> accepts a data frame, uses <code>MatchIt</code> to create
a matched data set,
I define a function that does that, and some labelling:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="declaredesign.html#cb108-1" tabindex="-1"></a>custom_match <span class="ot">&lt;-</span> <span class="cf">function</span>(data, equation, <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>) {</span>
<span id="cb108-2"><a href="declaredesign.html#cb108-2" tabindex="-1"></a>  </span>
<span id="cb108-3"><a href="declaredesign.html#cb108-3" tabindex="-1"></a>  <span class="co"># the command filter(term == term) wouldn&#39;t do anything, so this is a workaround</span></span>
<span id="cb108-4"><a href="declaredesign.html#cb108-4" tabindex="-1"></a>  term_value <span class="ot">&lt;-</span> term</span>
<span id="cb108-5"><a href="declaredesign.html#cb108-5" tabindex="-1"></a></span>
<span id="cb108-6"><a href="declaredesign.html#cb108-6" tabindex="-1"></a>  <span class="co"># run the matching model</span></span>
<span id="cb108-7"><a href="declaredesign.html#cb108-7" tabindex="-1"></a>  matchit_model <span class="ot">&lt;-</span> <span class="fu">matchit</span>(equation,</span>
<span id="cb108-8"><a href="declaredesign.html#cb108-8" tabindex="-1"></a>                         <span class="at">data =</span> data,</span>
<span id="cb108-9"><a href="declaredesign.html#cb108-9" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>)</span>
<span id="cb108-10"><a href="declaredesign.html#cb108-10" tabindex="-1"></a>  matched_df <span class="ot">&lt;-</span> <span class="fu">match.data</span>(matchit_model)</span>
<span id="cb108-11"><a href="declaredesign.html#cb108-11" tabindex="-1"></a></span>
<span id="cb108-12"><a href="declaredesign.html#cb108-12" tabindex="-1"></a>  <span class="co"># run a regression, weighted by the propensity score</span></span>
<span id="cb108-13"><a href="declaredesign.html#cb108-13" tabindex="-1"></a>  <span class="fu">lm_robust</span>(Y <span class="sc">~</span> Z, <span class="at">clusters =</span> village_unique, <span class="at">data =</span> matched_df, <span class="at">weights =</span> weights) <span class="sc">%&gt;%</span></span>
<span id="cb108-14"><a href="declaredesign.html#cb108-14" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-15"><a href="declaredesign.html#cb108-15" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">outcome =</span> outcome) <span class="sc">%&gt;%</span></span>
<span id="cb108-16"><a href="declaredesign.html#cb108-16" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> term_value)</span>
<span id="cb108-17"><a href="declaredesign.html#cb108-17" tabindex="-1"></a>}</span>
<span id="cb108-18"><a href="declaredesign.html#cb108-18" tabindex="-1"></a></span>
<span id="cb108-19"><a href="declaredesign.html#cb108-19" tabindex="-1"></a>estimator_matched_psm <span class="ot">&lt;-</span> <span class="fu">declare_estimator</span>(</span>
<span id="cb108-20"><a href="declaredesign.html#cb108-20" tabindex="-1"></a>  Z <span class="sc">~</span> HHsizeMAE <span class="sc">+</span> educated <span class="sc">+</span> LandOwned <span class="sc">+</span> NFertInput <span class="sc">+</span> female <span class="sc">+</span> NFertInput,</span>
<span id="cb108-21"><a href="declaredesign.html#cb108-21" tabindex="-1"></a>  <span class="at">handler =</span> <span class="fu">label_estimator</span>(custom_match),</span>
<span id="cb108-22"><a href="declaredesign.html#cb108-22" tabindex="-1"></a>  <span class="at">inquiry =</span> <span class="st">&quot;ATE&quot;</span>,  <span class="co"># Tie the estimator to the declared inquiry</span></span>
<span id="cb108-23"><a href="declaredesign.html#cb108-23" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">&quot;Matched&quot;</span>,</span>
<span id="cb108-24"><a href="declaredesign.html#cb108-24" tabindex="-1"></a>  <span class="at">term =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb108-25"><a href="declaredesign.html#cb108-25" tabindex="-1"></a>)</span>
<span id="cb108-26"><a href="declaredesign.html#cb108-26" tabindex="-1"></a></span>
<span id="cb108-27"><a href="declaredesign.html#cb108-27" tabindex="-1"></a>design_psm <span class="ot">&lt;-</span></span>
<span id="cb108-28"><a href="declaredesign.html#cb108-28" tabindex="-1"></a>  population_psm <span class="sc">+</span>  inquiry_psm <span class="sc">+</span> assignment_psm <span class="sc">+</span> resampling_psm <span class="sc">+</span> measurement_psm <span class="sc">+</span> estimator_notmatched_psm <span class="sc">+</span> estimator_matched_psm</span></code></pre></div>
</div>
<div id="checking-balance" class="section level3 hasAnchor">
<h3>Checking balance<a href="declaredesign.html#checking-balance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It’s useful to explore the property’s of our matching estimator.
First I draw data based on my design and create matched version of that data.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="declaredesign.html#cb109-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb109-2"><a href="declaredesign.html#cb109-2" tabindex="-1"></a></span>
<span id="cb109-3"><a href="declaredesign.html#cb109-3" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> </span>
<span id="cb109-4"><a href="declaredesign.html#cb109-4" tabindex="-1"></a>  <span class="fu">draw_data</span>(design_psm) <span class="sc">%&gt;%</span></span>
<span id="cb109-5"><a href="declaredesign.html#cb109-5" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb109-6"><a href="declaredesign.html#cb109-6" tabindex="-1"></a></span>
<span id="cb109-7"><a href="declaredesign.html#cb109-7" tabindex="-1"></a></span>
<span id="cb109-8"><a href="declaredesign.html#cb109-8" tabindex="-1"></a>  matchit_model <span class="ot">&lt;-</span> <span class="fu">matchit</span>(Z <span class="sc">~</span> HHsizeMAE <span class="sc">+</span> educated <span class="sc">+</span> LandOwned <span class="sc">+</span> NFertInput <span class="sc">+</span> female <span class="sc">+</span> NFertInput,</span>
<span id="cb109-9"><a href="declaredesign.html#cb109-9" tabindex="-1"></a>                         <span class="at">data =</span> test_data,</span>
<span id="cb109-10"><a href="declaredesign.html#cb109-10" tabindex="-1"></a>                         <span class="at">method =</span> <span class="st">&quot;nearest&quot;</span>)</span>
<span id="cb109-11"><a href="declaredesign.html#cb109-11" tabindex="-1"></a>  matched_df <span class="ot">&lt;-</span> <span class="fu">match.data</span>(matchit_model)</span></code></pre></div>
<p>Then I create balance table for the <code>test_data</code>:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="declaredesign.html#cb110-1" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb110-2"><a href="declaredesign.html#cb110-2" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb110-3"><a href="declaredesign.html#cb110-3" tabindex="-1"></a></span>
<span id="cb110-4"><a href="declaredesign.html#cb110-4" tabindex="-1"></a></span>
<span id="cb110-5"><a href="declaredesign.html#cb110-5" tabindex="-1"></a><span class="co"># balance table</span></span>
<span id="cb110-6"><a href="declaredesign.html#cb110-6" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span> </span>
<span id="cb110-7"><a href="declaredesign.html#cb110-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Z =</span> <span class="fu">factor</span>(Z, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treatment&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb110-8"><a href="declaredesign.html#cb110-8" tabindex="-1"></a>  <span class="fu">select</span>(Z, Y, food_secure, HHsizeMAE, educated, LandOwned, NFertInput, female, NFertInput) <span class="sc">%&gt;%</span></span>
<span id="cb110-9"><a href="declaredesign.html#cb110-9" tabindex="-1"></a>  <span class="fu">datasummary_balance</span>( <span class="sc">~</span> Z , <span class="at">data =</span> ., </span>
<span id="cb110-10"><a href="declaredesign.html#cb110-10" tabindex="-1"></a>                      <span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>, <span class="at">stars =</span> <span class="cn">TRUE</span>, </span>
<span id="cb110-11"><a href="declaredesign.html#cb110-11" tabindex="-1"></a>                      <span class="at">dinm =</span> <span class="cn">TRUE</span>, <span class="at">dinm_statistic =</span> <span class="st">&quot;p.value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-12"><a href="declaredesign.html#cb110-12" tabindex="-1"></a>  <span class="fu">fix_border_issues</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb110-13"><a href="declaredesign.html#cb110-13" tabindex="-1"></a>  <span class="fu">autofit</span>()</span></code></pre></div>
<div class="tabwid"><style>.cl-fd526738{}.cl-fd4cb4a0{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-fd4efa80{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-fd4f0be2{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0bec{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0bed{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0bee{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0bf6{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0bf7{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0bf8{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0c00{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0c01{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0c0a{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cb4{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cbe{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cbf{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cc0{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cc8{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cc9{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cca{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cd2{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cd3{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cdc{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0ce6{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0ce7{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cf0{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cf1{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cfa{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0cfb{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d04{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d05{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d0e{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d0f{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d10{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d18{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d19{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d1a{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d22{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d23{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d24{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d2c{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d36{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d37{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d40{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d41{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d42{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d4a{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d4b{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d4c{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d54{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d55{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d5e{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d5f{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d60{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d68{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d69{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d6a{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d6b{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd4f0d72{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-fd526738'><thead><tr style="overflow-wrap:break-word;"><th class="cl-fd4f0be2"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0"> </span></p></th><th  colspan="2"class="cl-fd4f0bec"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Control (N=1500)</span></p></th><th  colspan="2"class="cl-fd4f0bee"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Treatment (N=750)</span></p></th><th  colspan="2"class="cl-fd4f0bf7"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0"> </span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-fd4f0c00"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0"> </span></p></th><th class="cl-fd4f0c01"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Mean</span></p></th><th class="cl-fd4f0c0a"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Std. Dev.</span></p></th><th class="cl-fd4f0cb4"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Mean </span></p></th><th class="cl-fd4f0cbe"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Std. Dev. </span></p></th><th class="cl-fd4f0cbf"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Diff. in Means</span></p></th><th class="cl-fd4f0cc0"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">p</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-fd4f0cc8"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">Y</span></p></td><td class="cl-fd4f0cc9"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0cca"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0cd2"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0cd3"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0cdc"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.0</span></p></td><td class="cl-fd4f0ce6"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.152</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd4f0ce7"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">food_secure</span></p></td><td class="cl-fd4f0cf0"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0cf1"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0cfa"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.3</span></p></td><td class="cl-fd4f0cfb"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0d04"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">-0.2***</span></p></td><td class="cl-fd4f0d05"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd4f0d0e"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">HHsizeMAE</span></p></td><td class="cl-fd4f0d0f"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">4.6</span></p></td><td class="cl-fd4f0d10"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">1.6</span></p></td><td class="cl-fd4f0d18"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">4.1</span></p></td><td class="cl-fd4f0d19"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">1.9</span></p></td><td class="cl-fd4f0d1a"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">-0.5***</span></p></td><td class="cl-fd4f0d22"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd4f0d0e"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">educated</span></p></td><td class="cl-fd4f0d0f"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.7</span></p></td><td class="cl-fd4f0d10"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0d18"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0d19"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0d1a"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">-0.2***</span></p></td><td class="cl-fd4f0d22"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd4f0d23"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">LandOwned</span></p></td><td class="cl-fd4f0d24"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">7.8</span></p></td><td class="cl-fd4f0d2c"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">73.0</span></p></td><td class="cl-fd4f0d36"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">1.2</span></p></td><td class="cl-fd4f0d37"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">1.4</span></p></td><td class="cl-fd4f0d40"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">-6.5***</span></p></td><td class="cl-fd4f0d41"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd4f0d42"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">NFertInput</span></p></td><td class="cl-fd4f0d4a"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">84.2</span></p></td><td class="cl-fd4f0d4b"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">473.5</span></p></td><td class="cl-fd4f0d4c"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">43.5</span></p></td><td class="cl-fd4f0d54"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">150.0</span></p></td><td class="cl-fd4f0d55"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">-40.7**</span></p></td><td class="cl-fd4f0d5e"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.002</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd4f0d5f"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">female</span></p></td><td class="cl-fd4f0d60"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.2</span></p></td><td class="cl-fd4f0d68"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.4</span></p></td><td class="cl-fd4f0d69"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.4</span></p></td><td class="cl-fd4f0d6a"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.5</span></p></td><td class="cl-fd4f0d6b"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">0.2***</span></p></td><td class="cl-fd4f0d72"><p class="cl-fd4efa80"><span class="cl-fd4cb4a0">&lt;0.001</span></p></td></tr></tbody></table></div>
<p>And for the <code>matched_df</code>, which is clearly more balanced.
Note that according to the <a href="https://modelsummary.com/reference/datasummary_balance.html#global-options">documentation</a>,
<code>datasummary_balance()</code> reports weighted means if a <code>weights</code> variable is present.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="declaredesign.html#cb111-1" tabindex="-1"></a>matched_df <span class="sc">%&gt;%</span> </span>
<span id="cb111-2"><a href="declaredesign.html#cb111-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Z =</span> <span class="fu">factor</span>(Z, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treatment&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="declaredesign.html#cb111-3" tabindex="-1"></a>  <span class="fu">select</span>(Z, Y, food_secure, HHsizeMAE, educated, LandOwned, NFertInput, female, NFertInput) <span class="sc">%&gt;%</span></span>
<span id="cb111-4"><a href="declaredesign.html#cb111-4" tabindex="-1"></a>  <span class="fu">datasummary_balance</span>( <span class="sc">~</span> Z , <span class="at">data =</span> ., </span>
<span id="cb111-5"><a href="declaredesign.html#cb111-5" tabindex="-1"></a>                      <span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>, <span class="at">stars =</span> <span class="cn">TRUE</span>, </span>
<span id="cb111-6"><a href="declaredesign.html#cb111-6" tabindex="-1"></a>                      <span class="at">dinm =</span> <span class="cn">TRUE</span>, <span class="at">dinm_statistic =</span> <span class="st">&quot;p.value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-7"><a href="declaredesign.html#cb111-7" tabindex="-1"></a>  <span class="fu">fix_border_issues</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb111-8"><a href="declaredesign.html#cb111-8" tabindex="-1"></a>  <span class="fu">autofit</span>()</span></code></pre></div>
<div class="tabwid"><style>.cl-fd7ce864{}.cl-fd772f8c{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-fd79724c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-fd7985a2{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985a3{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985ac{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985ad{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985b6{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985b7{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985b8{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985c0{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985c1{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985ca{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985d4{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985de{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985df{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985e8{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985e9{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985ea{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985f2{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985f3{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985fc{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd7985fd{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798606{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798607{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798610{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798611{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798612{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79861a{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798624{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798625{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798626{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79862e{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79862f{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798638{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798639{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79863a{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798642{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798643{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79864c{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79864d{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79864e{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798656{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798657{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798660{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798661{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79866a{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79866b{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798674{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798675{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798676{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79867e{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79867f{width:1.126in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798680{width:0.667in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798688{width:0.914in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798689{width:0.71in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd79868a{width:0.956in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798692{width:1.219in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fd798693{width:0.757in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-fd7ce864'><thead><tr style="overflow-wrap:break-word;"><th class="cl-fd7985a2"><p class="cl-fd79724c"><span class="cl-fd772f8c"> </span></p></th><th  colspan="2"class="cl-fd7985a3"><p class="cl-fd79724c"><span class="cl-fd772f8c">Control (N=750)</span></p></th><th  colspan="2"class="cl-fd7985ad"><p class="cl-fd79724c"><span class="cl-fd772f8c">Treatment (N=750)</span></p></th><th  colspan="2"class="cl-fd7985b7"><p class="cl-fd79724c"><span class="cl-fd772f8c"> </span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-fd7985c0"><p class="cl-fd79724c"><span class="cl-fd772f8c"> </span></p></th><th class="cl-fd7985c1"><p class="cl-fd79724c"><span class="cl-fd772f8c">Mean</span></p></th><th class="cl-fd7985ca"><p class="cl-fd79724c"><span class="cl-fd772f8c">Std. Dev.</span></p></th><th class="cl-fd7985d4"><p class="cl-fd79724c"><span class="cl-fd772f8c">Mean </span></p></th><th class="cl-fd7985de"><p class="cl-fd79724c"><span class="cl-fd772f8c">Std. Dev. </span></p></th><th class="cl-fd7985df"><p class="cl-fd79724c"><span class="cl-fd772f8c">Diff. in Means</span></p></th><th class="cl-fd7985e8"><p class="cl-fd79724c"><span class="cl-fd772f8c">p</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-fd7985e9"><p class="cl-fd79724c"><span class="cl-fd772f8c">Y</span></p></td><td class="cl-fd7985ea"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd7985f2"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd7985f3"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd7985fc"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd7985fd"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.0</span></p></td><td class="cl-fd798606"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.918</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd798607"><p class="cl-fd79724c"><span class="cl-fd772f8c">food_secure</span></p></td><td class="cl-fd798610"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd798611"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd798612"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.3</span></p></td><td class="cl-fd79861a"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd798624"><p class="cl-fd79724c"><span class="cl-fd772f8c">-0.1***</span></p></td><td class="cl-fd798625"><p class="cl-fd79724c"><span class="cl-fd772f8c">&lt;0.001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd798626"><p class="cl-fd79724c"><span class="cl-fd772f8c">HHsizeMAE</span></p></td><td class="cl-fd79862e"><p class="cl-fd79724c"><span class="cl-fd772f8c">4.3</span></p></td><td class="cl-fd79862f"><p class="cl-fd79724c"><span class="cl-fd772f8c">1.4</span></p></td><td class="cl-fd798638"><p class="cl-fd79724c"><span class="cl-fd772f8c">4.1</span></p></td><td class="cl-fd798639"><p class="cl-fd79724c"><span class="cl-fd772f8c">1.9</span></p></td><td class="cl-fd79863a"><p class="cl-fd79724c"><span class="cl-fd772f8c">-0.2+</span></p></td><td class="cl-fd798642"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.061</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd798626"><p class="cl-fd79724c"><span class="cl-fd772f8c">educated</span></p></td><td class="cl-fd79862e"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd79862f"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd798638"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd798639"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd79863a"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.0</span></p></td><td class="cl-fd798642"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.163</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd798643"><p class="cl-fd79724c"><span class="cl-fd772f8c">LandOwned</span></p></td><td class="cl-fd79864c"><p class="cl-fd79724c"><span class="cl-fd772f8c">1.3</span></p></td><td class="cl-fd79864d"><p class="cl-fd79724c"><span class="cl-fd772f8c">1.3</span></p></td><td class="cl-fd79864e"><p class="cl-fd79724c"><span class="cl-fd772f8c">1.2</span></p></td><td class="cl-fd798656"><p class="cl-fd79724c"><span class="cl-fd772f8c">1.4</span></p></td><td class="cl-fd798657"><p class="cl-fd79724c"><span class="cl-fd772f8c">-0.1</span></p></td><td class="cl-fd798660"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.114</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd798661"><p class="cl-fd79724c"><span class="cl-fd772f8c">NFertInput</span></p></td><td class="cl-fd79866a"><p class="cl-fd79724c"><span class="cl-fd772f8c">68.8</span></p></td><td class="cl-fd79866b"><p class="cl-fd79724c"><span class="cl-fd772f8c">246.5</span></p></td><td class="cl-fd798674"><p class="cl-fd79724c"><span class="cl-fd772f8c">43.5</span></p></td><td class="cl-fd798675"><p class="cl-fd79724c"><span class="cl-fd772f8c">150.0</span></p></td><td class="cl-fd798676"><p class="cl-fd79724c"><span class="cl-fd772f8c">-25.3*</span></p></td><td class="cl-fd79867e"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.017</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fd79867f"><p class="cl-fd79724c"><span class="cl-fd772f8c">female</span></p></td><td class="cl-fd798680"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.4</span></p></td><td class="cl-fd798688"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd798689"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.4</span></p></td><td class="cl-fd79868a"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.5</span></p></td><td class="cl-fd798692"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.0</span></p></td><td class="cl-fd798693"><p class="cl-fd79724c"><span class="cl-fd772f8c">0.747</span></p></td></tr></tbody></table></div>
<p>Let’s run the models two times:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="declaredesign.html#cb112-1" tabindex="-1"></a>unmatched_model <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(Y <span class="sc">~</span> Z, <span class="at">clusters =</span> village_unique, <span class="at">data =</span> test_data)</span>
<span id="cb112-2"><a href="declaredesign.html#cb112-2" tabindex="-1"></a>matched_model <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(Y<span class="sc">~</span>Z, <span class="at">clusters =</span> village_unique, <span class="at">data =</span> matched_df, <span class="at">weights =</span> weights)</span>
<span id="cb112-3"><a href="declaredesign.html#cb112-3" tabindex="-1"></a></span>
<span id="cb112-4"><a href="declaredesign.html#cb112-4" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="at">lm =</span> unmatched_model, <span class="at">psm =</span> matched_model), <span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>,</span>
<span id="cb112-5"><a href="declaredesign.html#cb112-5" tabindex="-1"></a>             <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">&quot;nobs&quot;</span>,<span class="st">&quot;r.squared&quot;</span>,<span class="st">&quot;adj.r.squared&quot;</span>))</span></code></pre></div>
<div class="tabwid"><style>.cl-fda94152{}.cl-fda40354{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-fda63502{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-fda6454c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fda64556{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fda64560{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-fda6456a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-fda94152'><thead><tr style="overflow-wrap:break-word;"><th class="cl-fda6454c"><p class="cl-fda63502"><span class="cl-fda40354"> </span></p></th><th class="cl-fda6454c"><p class="cl-fda63502"><span class="cl-fda40354">lm</span></p></th><th class="cl-fda6454c"><p class="cl-fda63502"><span class="cl-fda40354">psm</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">(Intercept)</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">0.503</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">0.473</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354"></span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">(0.027)</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">(0.033)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">Z</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">-0.032</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">-0.003</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354"></span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">(0.040)</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">(0.044)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fda64560"><p class="cl-fda63502"><span class="cl-fda40354">Num.Obs.</span></p></td><td class="cl-fda64560"><p class="cl-fda63502"><span class="cl-fda40354">2250</span></p></td><td class="cl-fda64560"><p class="cl-fda63502"><span class="cl-fda40354">1500</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">R2</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">0.001</span></p></td><td class="cl-fda64556"><p class="cl-fda63502"><span class="cl-fda40354">0.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-fda6456a"><p class="cl-fda63502"><span class="cl-fda40354">R2 Adj.</span></p></td><td class="cl-fda6456a"><p class="cl-fda63502"><span class="cl-fda40354">0.000</span></p></td><td class="cl-fda6456a"><p class="cl-fda63502"><span class="cl-fda40354">-0.001</span></p></td></tr></tbody></table></div>
<p>Both of these underestimate the treatment effect by a bit, as it should be around 0.2.</p>
</div>
<div id="bias" class="section level3 hasAnchor">
<h3>Bias<a href="declaredesign.html#bias" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, let’s diagnose the design!</p>
<p>First, let’s examine bias, given selection effects.
The strength of the selection effect is given by <code>rho</code>,
so I use <code>redesign()</code> to vary it:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="declaredesign.html#cb113-1" tabindex="-1"></a>diagnosis_psm_bias <span class="ot">&lt;-</span></span>
<span id="cb113-2"><a href="declaredesign.html#cb113-2" tabindex="-1"></a>  design_psm <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="declaredesign.html#cb113-3" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">rho =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.3</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb113-4"><a href="declaredesign.html#cb113-4" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb113-5"><a href="declaredesign.html#cb113-5" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb113-6"><a href="declaredesign.html#cb113-6" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>And I put the result in a plot:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="declaredesign.html#cb114-1" tabindex="-1"></a>diagnosis_psm_bias <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="declaredesign.html#cb114-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;bias&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="declaredesign.html#cb114-3" tabindex="-1"></a>  <span class="fu">select</span>(rho, <span class="at">bias =</span> estimate, estimator) <span class="sc">%&gt;%</span></span>
<span id="cb114-4"><a href="declaredesign.html#cb114-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rho, <span class="at">y =</span> bias, </span>
<span id="cb114-5"><a href="declaredesign.html#cb114-5" tabindex="-1"></a>             <span class="at">shape =</span> estimator, <span class="at">color=</span>estimator)) <span class="sc">+</span></span>
<span id="cb114-6"><a href="declaredesign.html#cb114-6" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb114-7"><a href="declaredesign.html#cb114-7" tabindex="-1"></a>    <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p>Clearly, the more treatment is correlated to education,
the higher the bias in the regular model.
Bias is never extreme, however.</p>
</div>
<div id="power" class="section level3 hasAnchor">
<h3>Power<a href="declaredesign.html#power" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Then, let’s examine power.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="declaredesign.html#cb115-1" tabindex="-1"></a>diagnosis_psm_power <span class="ot">&lt;-</span></span>
<span id="cb115-2"><a href="declaredesign.html#cb115-2" tabindex="-1"></a>  design_psm <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="declaredesign.html#cb115-3" tabindex="-1"></a>  <span class="fu">redesign</span>(<span class="at">clusters_treat =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>),</span>
<span id="cb115-4"><a href="declaredesign.html#cb115-4" tabindex="-1"></a>           <span class="at">effect =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.4</span>,<span class="fl">0.1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb115-5"><a href="declaredesign.html#cb115-5" tabindex="-1"></a>  <span class="fu">diagnose_design</span>(<span class="at">sims =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-6"><a href="declaredesign.html#cb115-6" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-7"><a href="declaredesign.html#cb115-7" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>When we plot the results, it seems sample size doesn’t affect power much
(not sure why, perhaps the resampling?).
The design can pick up an <code>effect</code> of 0.4,
meaning that 40% of the food insecure beneficaries become food secure.
The actual treatment effect would be lower, as some beneficiaries would
have been food secure before the intervention.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="declaredesign.html#cb116-1" tabindex="-1"></a>diagnosis_psm_power <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="declaredesign.html#cb116-2" tabindex="-1"></a>  <span class="fu">filter</span>(diagnosand <span class="sc">==</span> <span class="st">&quot;power&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="declaredesign.html#cb116-3" tabindex="-1"></a>  <span class="fu">select</span>(clusters_treat, <span class="at">power =</span> estimate, estimator, effect) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="declaredesign.html#cb116-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> clusters_treat, <span class="at">y =</span> power, </span>
<span id="cb116-5"><a href="declaredesign.html#cb116-5" tabindex="-1"></a>             <span class="at">shape =</span> estimator, <span class="at">color=</span>estimator)) <span class="sc">+</span></span>
<span id="cb116-6"><a href="declaredesign.html#cb116-6" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb116-7"><a href="declaredesign.html#cb116-7" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb116-8"><a href="declaredesign.html#cb116-8" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.8</span>,<span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb116-9"><a href="declaredesign.html#cb116-9" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>effect)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="plotting.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-exploration.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/kleuveld/r_cheatsheet/edit/main/chapters/04-declaredesign.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
