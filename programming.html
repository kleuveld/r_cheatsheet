<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Programming with R | R Cheat Sheet</title>
  <meta name="description" content="This page contains some quick R tips." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Programming with R | R Cheat Sheet" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains some quick R tips." />
  <meta name="github-repo" content="kleuveld/r_cheatsheet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Programming with R | R Cheat Sheet" />
  
  <meta name="twitter:description" content="This page contains some quick R tips." />
  

<meta name="author" content="Koen" />


<meta name="date" content="2024-09-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-exploration.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Cheat Sheet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i>Setting up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i>Data Wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#basic-data-manipulation"><i class="fa fa-check"></i>Basic Data Manipulation</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-or-reshaping"><i class="fa fa-check"></i>Pivoting (or reshaping)</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#creating-fake-data"><i class="fa fa-check"></i>Creating fake data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-long-to-wide"><i class="fa fa-check"></i>Pivoting long to wide</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-wide-to-long"><i class="fa fa-check"></i>Pivoting wide to long</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#joining-or-merging-data"><i class="fa fa-check"></i>Joining (or merging) data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#summarizing-over-groups-or-collapsing-data"><i class="fa fa-check"></i>Summarizing over groups (or collapsing data)</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#row-wise-operations"><i class="fa fa-check"></i>Row-wise Operations</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#across-doing-the-same-operations-on-multiple-variables-using-across"><i class="fa fa-check"></i>across(): doing the same operations on multiple variables using across</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#c_across-passing-values-from-multiple-variables-to-summarizing-functions"><i class="fa fa-check"></i>c_across(): passing values from multiple variables to summarizing functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#seperate_longer"><i class="fa fa-check"></i>Splitting multi-response variable into dummies</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i>Estimating and reporting</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#generating-some-fake-data"><i class="fa fa-check"></i>Generating some fake data</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#making-a-table-of-summary-statistics"><i class="fa fa-check"></i>Making a table of summary statistics</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#using-modelsummary-and-flextable"><i class="fa fa-check"></i>Using modelsummary and flextable</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#balance-table"><i class="fa fa-check"></i>Balance Table</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#advanced-using-only-flextable"><i class="fa fa-check"></i>Advanced: Using only Flextable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#simple-regression"><i class="fa fa-check"></i>Simple regression</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#robust-standard-errors"><i class="fa fa-check"></i>Robust standard errors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i>Plotting using ggplot</a>
<ul>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#scatter-plot"><i class="fa fa-check"></i>Scatter plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#bar-chart"><i class="fa fa-check"></i>Bar chart</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#faceting"><i class="fa fa-check"></i>Faceting</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#stacked-wur"><i class="fa fa-check"></i>Stacked bar chart with WUR template and observation counts</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#ordering-of-labels"><i class="fa fa-check"></i>Ordering of labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#lollipop-plot"><i class="fa fa-check"></i>Lollipop plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#maps"><i class="fa fa-check"></i>Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html"><i class="fa fa-check"></i>Power Analysis using DeclareDesign</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#simple-power-calculation"><i class="fa fa-check"></i>Simple Power Calculation</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#loading-data"><i class="fa fa-check"></i>Loading data</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#diagnosing-design-and-calculating-power"><i class="fa fa-check"></i>Diagnosing Design and calculating power</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#dif-in-diff"><i class="fa fa-check"></i>Dif in diff</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#propsensity-score-matching"><i class="fa fa-check"></i>Propsensity score matching</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design-1"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#checking-balance"><i class="fa fa-check"></i>Checking balance</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#bias"><i class="fa fa-check"></i>Bias</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#power"><i class="fa fa-check"></i>Power</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i>Data Exploration</a>
<ul>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#setup-1"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#making-a-codebook-from-a-stata-.dta"><i class="fa fa-check"></i>Making a codebook from a Stata .dta</a></li>
<li class="chapter" data-level="" data-path="data-exploration.html"><a href="data-exploration.html#correlogram"><i class="fa fa-check"></i>Correlogram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i>Programming with R</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#loops"><i class="fa fa-check"></i>Loops</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#basic-functions"><i class="fa fa-check"></i>Basic Functions</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions-and-the-tidyverse"><i class="fa fa-check"></i>Functions and the tidyverse</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#plot-function"><i class="fa fa-check"></i>Example 1: Re-using plot specifications</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#example-2-function-to-create-dummies-from-text"><i class="fa fa-check"></i>Example 2: Function to create dummies from text</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#map"><i class="fa fa-check"></i>Map()</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Cheat Sheet</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programming" class="section level1 hasAnchor">
<h1>Programming with R<a href="programming.html#programming" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>You can improve your R code by using programming features such as
loops and functions to make your code reusable. This prevents errors,
while saving you time.</p>
<div id="loops" class="section level2 hasAnchor">
<h2>Loops<a href="programming.html#loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Loops repeat code a number of time, they have the following structure:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="programming.html#cb130-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb130-2"><a href="programming.html#cb130-2" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb130-3"><a href="programming.html#cb130-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4</code></pre>
<p>The <code>i</code> is the iterator, and each iteration of the loop it takes on the value of
a different element of the object that follows the <code>in</code>; in this case, <code>i</code> takes
on 1,2,3 and finally 4 as its values. Therefore, this code is equivalent to:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="programming.html#cb132-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="programming.html#cb134-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="programming.html#cb136-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="programming.html#cb138-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>But it’s much easier to maintain! Imagine having to do 86 iterations: you would
need to copy paste the code 85 times every time you want to update something.
Using loops, you don’t need to copy-paste a thing, leading to fewer errors.</p>
<p>While loops can be a perfectly fine way of doing repeated work, most R
programmers prefer not to use loops, but instead use functions such as
<code>lapply()</code> and <code>map()</code>. However, for this you will need to know functions.</p>
</div>
<div id="functions" class="section level2 hasAnchor">
<h2>Functions<a href="programming.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="basic-functions" class="section level3 hasAnchor">
<h3>Basic Functions<a href="programming.html#basic-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A function is an R object that’s essentially a shortcut to run a bit of code.
Usually, a function takes an argument (the input), and returns an output. The
argument is always provided within parentheses. The <code>sqrt()</code> function, for
example, takes a number as its argument and returns the square root.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="programming.html#cb140-1" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>The beauty of functions is that they allow you to define a set of operations in
one place, and re-use it as often as you want. If you then need to update the
operations, all you need to do is update the function, instead of hunting down
every instance of the operations throughout your script.</p>
<p>Take for example the following code that cleans missing data.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="programming.html#cb142-1" tabindex="-1"></a><span class="co">#define an example variable</span></span>
<span id="cb142-2"><a href="programming.html#cb142-2" tabindex="-1"></a>variable1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="sc">-</span><span class="dv">99</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb142-3"><a href="programming.html#cb142-3" tabindex="-1"></a></span>
<span id="cb142-4"><a href="programming.html#cb142-4" tabindex="-1"></a></span>
<span id="cb142-5"><a href="programming.html#cb142-5" tabindex="-1"></a><span class="co">#change missing</span></span>
<span id="cb142-6"><a href="programming.html#cb142-6" tabindex="-1"></a>variable1_cleaned <span class="ot">=</span> <span class="fu">if_else</span>(variable1 <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>, <span class="cn">NA</span>,variable1)</span>
<span id="cb142-7"><a href="programming.html#cb142-7" tabindex="-1"></a></span>
<span id="cb142-8"><a href="programming.html#cb142-8" tabindex="-1"></a>variable1_cleaned </span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  5  6</code></pre>
<p>This works, but I need to do this at many different places in my code, and when
copying the code to other places, it’s easy to make small mistakes. Moreover, if
I notice my procedure for cleaning missing data is wrong, I will have to hunt
down all the places I’ve copied this code to, and change it (which, again, is
an error prone process).</p>
<p>A common piece of advice is to put any code that you
have to copy-paste more than twice in a function. Once I do that, I can just
call the function wherever I need to clean data; if I want to change how I deal
with missings, I now only have to make changes in one place:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="programming.html#cb144-1" tabindex="-1"></a>clean_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data) {</span>
<span id="cb144-2"><a href="programming.html#cb144-2" tabindex="-1"></a></span>
<span id="cb144-3"><a href="programming.html#cb144-3" tabindex="-1"></a>    returned_data <span class="ot">&lt;-</span> <span class="fu">if_else</span>(input_data <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>, <span class="cn">NA</span>, input_data)</span>
<span id="cb144-4"><a href="programming.html#cb144-4" tabindex="-1"></a>    </span>
<span id="cb144-5"><a href="programming.html#cb144-5" tabindex="-1"></a>    <span class="fu">return</span>(returned_data)</span>
<span id="cb144-6"><a href="programming.html#cb144-6" tabindex="-1"></a>}</span></code></pre></div>
<p>I’ve pretty much copied the code I had above. Note that I could have used any
name for my argument (defined in the parentheses after function); I just thought
<code>input_data</code> made sense. I use the <code>return()</code> function to return data.</p>
<p>I can now just use the <code>clean_data()</code> wherever I want:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="programming.html#cb145-1" tabindex="-1"></a>variable1_cleaned <span class="ot">&lt;-</span> <span class="fu">clean_missing</span>(variable1)</span>
<span id="cb145-2"><a href="programming.html#cb145-2" tabindex="-1"></a></span>
<span id="cb145-3"><a href="programming.html#cb145-3" tabindex="-1"></a>variable1_cleaned</span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  5  6</code></pre>
<p>Note that any variables we created in the function are kept within the function,
and you can’t access them later:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="programming.html#cb147-1" tabindex="-1"></a>variable1_clean <span class="ot">&lt;-</span> <span class="fu">clean_missing</span>(variable1)</span>
<span id="cb147-2"><a href="programming.html#cb147-2" tabindex="-1"></a>returned_data</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;returned_data&#39; not found</code></pre>
<p>This keeps your working environment nice and clean, which again prevents
problems.</p>
<p>Above I used the return function. This is not needed. Anything on the
last line of the function that would normally be returned to the console, is
used a return value of the function:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="programming.html#cb149-1" tabindex="-1"></a>clean_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data) {</span>
<span id="cb149-2"><a href="programming.html#cb149-2" tabindex="-1"></a></span>
<span id="cb149-3"><a href="programming.html#cb149-3" tabindex="-1"></a>    <span class="fu">if_else</span>(input_data <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>, <span class="cn">NA</span>, input_data)</span>
<span id="cb149-4"><a href="programming.html#cb149-4" tabindex="-1"></a>    </span>
<span id="cb149-5"><a href="programming.html#cb149-5" tabindex="-1"></a>}</span>
<span id="cb149-6"><a href="programming.html#cb149-6" tabindex="-1"></a></span>
<span id="cb149-7"><a href="programming.html#cb149-7" tabindex="-1"></a><span class="fu">clean_missing</span>(variable1)</span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  5  6</code></pre>
</div>
<div id="functions-and-the-tidyverse" class="section level3 hasAnchor">
<h3>Functions and the tidyverse<a href="programming.html#functions-and-the-tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the previous function I passed a vector to clean, what if want to use it
in a data cleaning pipe?</p>
<p>It’s useful to start with the code without a function, and then to generalize
from there:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="programming.html#cb151-1" tabindex="-1"></a>data_frame <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">variable1 =</span> variable1)</span>
<span id="cb151-2"><a href="programming.html#cb151-2" tabindex="-1"></a></span>
<span id="cb151-3"><a href="programming.html#cb151-3" tabindex="-1"></a>data_frame <span class="sc">%&gt;%</span></span>
<span id="cb151-4"><a href="programming.html#cb151-4" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variable1 =</span> <span class="fu">if_else</span>(variable1 <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,<span class="cn">NA</span>,variable1))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   variable1
##       &lt;dbl&gt;
## 1         1
## 2         2
## 3         3
## 4        NA
## 5         5
## 6         6</code></pre>
<p>Let’s try to put that in a function. The function will need to take
a data frame and a variable name as its arguments. Results from one step in the
pipe, are passed as the first argument for the next step. So make sure the data
is the first argument!</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="programming.html#cb153-1" tabindex="-1"></a>clean_missing_df <span class="ot">&lt;-</span> <span class="cf">function</span>(input_dataframe, variablename){</span>
<span id="cb153-2"><a href="programming.html#cb153-2" tabindex="-1"></a>    input_dataframe <span class="sc">%&gt;%</span></span>
<span id="cb153-3"><a href="programming.html#cb153-3" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">variablename =</span> <span class="fu">if_else</span>(variablename <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,<span class="cn">NA</span>, variablename))</span>
<span id="cb153-4"><a href="programming.html#cb153-4" tabindex="-1"></a>    </span>
<span id="cb153-5"><a href="programming.html#cb153-5" tabindex="-1"></a>}</span>
<span id="cb153-6"><a href="programming.html#cb153-6" tabindex="-1"></a></span>
<span id="cb153-7"><a href="programming.html#cb153-7" tabindex="-1"></a>data_frame <span class="sc">%&gt;%</span></span>
<span id="cb153-8"><a href="programming.html#cb153-8" tabindex="-1"></a>    <span class="fu">clean_missing_df</span>(variable1)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   variable1 variablename
##       &lt;dbl&gt;        &lt;dbl&gt;
## 1         1            1
## 2         2            2
## 3         3            3
## 4       -99           NA
## 5         5            5
## 6         6            6</code></pre>
<p>Wait, something went wrong! R just created a new variable called “variablename”.
For a technical note on why this is, see
<a href="https://dplyr.tidyverse.org/articles/programming.html">here</a>. In short, we want
R too look what’s <em>in</em> <code>variablename</code>, not just use it as is. To do so, wrap the
variable name in your function definition
in <code>{{</code> and <code>}}</code>, and change the <code>=</code> in <code>mutatate</code> to <code>:=</code>.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="programming.html#cb155-1" tabindex="-1"></a>clean_missing_df <span class="ot">&lt;-</span> <span class="cf">function</span>(input_dataframe, variablename){</span>
<span id="cb155-2"><a href="programming.html#cb155-2" tabindex="-1"></a>        input_dataframe <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="programming.html#cb155-3" tabindex="-1"></a>        <span class="fu">mutate</span>({{ variablename }} <span class="sc">:=</span> <span class="fu">if_else</span>({{ variablename }} <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,</span>
<span id="cb155-4"><a href="programming.html#cb155-4" tabindex="-1"></a>                                             <span class="cn">NA</span>,</span>
<span id="cb155-5"><a href="programming.html#cb155-5" tabindex="-1"></a>                                             {{ variablename }}))</span>
<span id="cb155-6"><a href="programming.html#cb155-6" tabindex="-1"></a>    </span>
<span id="cb155-7"><a href="programming.html#cb155-7" tabindex="-1"></a>}</span>
<span id="cb155-8"><a href="programming.html#cb155-8" tabindex="-1"></a></span>
<span id="cb155-9"><a href="programming.html#cb155-9" tabindex="-1"></a></span>
<span id="cb155-10"><a href="programming.html#cb155-10" tabindex="-1"></a>data_frame <span class="sc">%&gt;%</span></span>
<span id="cb155-11"><a href="programming.html#cb155-11" tabindex="-1"></a>    <span class="fu">clean_missing_df</span>(variable1)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   variable1
##       &lt;dbl&gt;
## 1         1
## 2         2
## 3         3
## 4        NA
## 5         5
## 6         6</code></pre>
</div>
<div id="plot-function" class="section level3 hasAnchor">
<h3>Example 1: Re-using plot specifications<a href="programming.html#plot-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you’re writing a report that includes the same type of plot in many
places, it makes sense to make it into a function.</p>
<p>Let’s take the <a href="plotting.html#stacked-wur">stacked bar plot from the plotting chapter</a>:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="programming.html#cb157-1" tabindex="-1"></a><span class="fu">library</span>(ggthemewur)</span>
<span id="cb157-2"><a href="programming.html#cb157-2" tabindex="-1"></a></span>
<span id="cb157-3"><a href="programming.html#cb157-3" tabindex="-1"></a>stacked_bar_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df, by, fill) {</span>
<span id="cb157-4"><a href="programming.html#cb157-4" tabindex="-1"></a>  <span class="co"># outputs a stacked bar chart</span></span>
<span id="cb157-5"><a href="programming.html#cb157-5" tabindex="-1"></a>  </span>
<span id="cb157-6"><a href="programming.html#cb157-6" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb157-7"><a href="programming.html#cb157-7" tabindex="-1"></a>    <span class="fu">mutate</span>( {{ by }} <span class="sc">:=</span> <span class="fu">count_label</span>( {{ by }})) <span class="sc">%&gt;%</span></span>
<span id="cb157-8"><a href="programming.html#cb157-8" tabindex="-1"></a></span>
<span id="cb157-9"><a href="programming.html#cb157-9" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> {{ by }}, <span class="at">fill =</span> {{ fill }})) <span class="sc">+</span></span>
<span id="cb157-10"><a href="programming.html#cb157-10" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb157-11"><a href="programming.html#cb157-11" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-12"><a href="programming.html#cb157-12" tabindex="-1"></a>      <span class="fu">theme_wur</span>() <span class="sc">+</span></span>
<span id="cb157-13"><a href="programming.html#cb157-13" tabindex="-1"></a>      <span class="fu">scale_fill_wur_discrete</span>() <span class="sc">+</span></span>
<span id="cb157-14"><a href="programming.html#cb157-14" tabindex="-1"></a>       <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">&quot;count&quot;</span>, </span>
<span id="cb157-15"><a href="programming.html#cb157-15" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), </span>
<span id="cb157-16"><a href="programming.html#cb157-16" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">reverse =</span> <span class="cn">TRUE</span>), </span>
<span id="cb157-17"><a href="programming.html#cb157-17" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-18"><a href="programming.html#cb157-18" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb157-19"><a href="programming.html#cb157-19" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb157-20"><a href="programming.html#cb157-20" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>, </span>
<span id="cb157-21"><a href="programming.html#cb157-21" tabindex="-1"></a>                                 <span class="at">title.position=</span><span class="st">&quot;top&quot;</span>, </span>
<span id="cb157-22"><a href="programming.html#cb157-22" tabindex="-1"></a>                                 <span class="at">title.hjust =</span> <span class="fl">0.5</span>)) </span>
<span id="cb157-23"><a href="programming.html#cb157-23" tabindex="-1"></a>}</span>
<span id="cb157-24"><a href="programming.html#cb157-24" tabindex="-1"></a></span>
<span id="cb157-25"><a href="programming.html#cb157-25" tabindex="-1"></a>count_label <span class="ot">&lt;-</span> <span class="cf">function</span>(vector) {</span>
<span id="cb157-26"><a href="programming.html#cb157-26" tabindex="-1"></a>  <span class="co"># takes a vector of strings or factor, </span></span>
<span id="cb157-27"><a href="programming.html#cb157-27" tabindex="-1"></a>  <span class="co"># output a factor vector with N = N included in the labels</span></span>
<span id="cb157-28"><a href="programming.html#cb157-28" tabindex="-1"></a>  <span class="fu">fct_recode</span>(<span class="fu">factor</span>(vector), </span>
<span id="cb157-29"><a href="programming.html#cb157-29" tabindex="-1"></a>             <span class="sc">!!!</span>vector <span class="sc">%&gt;%</span></span>
<span id="cb157-30"><a href="programming.html#cb157-30" tabindex="-1"></a>               <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb157-31"><a href="programming.html#cb157-31" tabindex="-1"></a>               <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb157-32"><a href="programming.html#cb157-32" tabindex="-1"></a>               <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb157-33"><a href="programming.html#cb157-33" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.character</span>(value),</span>
<span id="cb157-34"><a href="programming.html#cb157-34" tabindex="-1"></a>                      <span class="at">newlabel =</span> <span class="fu">paste0</span>(value,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">n=&quot;</span>,n)) <span class="sc">%&gt;%</span></span>
<span id="cb157-35"><a href="programming.html#cb157-35" tabindex="-1"></a>               <span class="fu">pull</span>(value, <span class="at">name =</span> newlabel))</span>
<span id="cb157-36"><a href="programming.html#cb157-36" tabindex="-1"></a>  </span>
<span id="cb157-37"><a href="programming.html#cb157-37" tabindex="-1"></a>}</span>
<span id="cb157-38"><a href="programming.html#cb157-38" tabindex="-1"></a></span>
<span id="cb157-39"><a href="programming.html#cb157-39" tabindex="-1"></a></span>
<span id="cb157-40"><a href="programming.html#cb157-40" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-41"><a href="programming.html#cb157-41" tabindex="-1"></a>  <span class="fu">stacked_bar_plot</span>(village,respondent_wall_type)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="programming.html#cb158-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb158-2"><a href="programming.html#cb158-2" tabindex="-1"></a>  <span class="fu">stacked_bar_plot</span>(village,affect_conflicts)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-110-2.png" width="672" /></p>
<p>Note that the <code>count_label()</code> function adds group counts to factor variable labels.
This is useful for the <code>by</code> variable.
I am not sure if I understand what the <code>!!!</code> operator means, but it works.
The function basically creates a named vector, where the vector values are the old
factor labels, and the vector names are new factor labels.
The new labels include the N, which is computed using a
standard <code>group_by() %&gt;% summarize()</code> pipeline.</p>
</div>
<div id="example-2-function-to-create-dummies-from-text" class="section level3 hasAnchor">
<h3>Example 2: Function to create dummies from text<a href="programming.html#example-2-function-to-create-dummies-from-text" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remember our code to generate dummies based on text:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="programming.html#cb159-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-2"><a href="programming.html#cb159-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">items_owned =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(items_owned),<span class="st">&quot;None&quot;</span>,items_owned)) <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="programming.html#cb159-3" tabindex="-1"></a>    <span class="fu">select</span>(key_ID,items_owned) <span class="sc">%&gt;%</span></span>
<span id="cb159-4"><a href="programming.html#cb159-4" tabindex="-1"></a>    <span class="fu">separate_longer_delim</span>(items_owned, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-5"><a href="programming.html#cb159-5" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-6"><a href="programming.html#cb159-6" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> items_owned,</span>
<span id="cb159-7"><a href="programming.html#cb159-7" tabindex="-1"></a>                <span class="at">values_from =</span> value,</span>
<span id="cb159-8"><a href="programming.html#cb159-8" tabindex="-1"></a>                <span class="at">names_prefix =</span> <span class="st">&quot;owns_&quot;</span>,</span>
<span id="cb159-9"><a href="programming.html#cb159-9" tabindex="-1"></a>                <span class="at">values_fill =</span> <span class="dv">0</span>) </span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 131 × 19
##    key_ID owns_bicycle owns_television owns_solar_panel owns_table owns_cow_cart
##     &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;
##  1      1            1               1                1          1             0
##  2      2            1               0                1          1             1
##  3      3            0               0                0          0             0
##  4      4            1               0                1          0             0
##  5      5            0               0                0          0             0
##  6      6            0               0                0          0             0
##  7      7            0               0                0          0             0
##  8      8            1               1                1          1             0
##  9      9            0               1                1          0             0
## 10     10            1               1                1          1             1
## # ℹ 121 more rows
## # ℹ 13 more variables: owns_radio &lt;dbl&gt;, owns_cow_plough &lt;dbl&gt;,
## #   owns_solar_torch &lt;dbl&gt;, owns_mobile_phone &lt;dbl&gt;, owns_motorcyle &lt;dbl&gt;,
## #   owns_None &lt;dbl&gt;, owns_fridge &lt;dbl&gt;, owns_electricity &lt;dbl&gt;,
## #   owns_sofa_set &lt;dbl&gt;, owns_lorry &lt;dbl&gt;, owns_sterio &lt;dbl&gt;,
## #   owns_computer &lt;dbl&gt;, owns_car &lt;dbl&gt;</code></pre>
<p>I now want to apply this same principle to <code>months_lack_food</code> column.
I could copy-paste the code, but the better solution is to make a function:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="programming.html#cb162-1" tabindex="-1"></a>create_dummies <span class="ot">&lt;-</span> <span class="cf">function</span>(df,stringvar,<span class="at">prefix=</span><span class="st">&quot;&quot;</span>,<span class="at">delim =</span> <span class="st">&quot;;&quot;</span>) {</span>
<span id="cb162-2"><a href="programming.html#cb162-2" tabindex="-1"></a>    <span class="co">#Function that generates dummies from a string variable</span></span>
<span id="cb162-3"><a href="programming.html#cb162-3" tabindex="-1"></a>    <span class="co">#containing multi-response answers</span></span>
<span id="cb162-4"><a href="programming.html#cb162-4" tabindex="-1"></a>    <span class="co">#returns dataset without original var, but with dummies.</span></span>
<span id="cb162-5"><a href="programming.html#cb162-5" tabindex="-1"></a></span>
<span id="cb162-6"><a href="programming.html#cb162-6" tabindex="-1"></a>    df <span class="sc">%&gt;%</span></span>
<span id="cb162-7"><a href="programming.html#cb162-7" tabindex="-1"></a>        <span class="fu">separate_longer_delim</span>({{ stringvar }}, <span class="at">delim =</span> delim) <span class="sc">%&gt;%</span></span>
<span id="cb162-8"><a href="programming.html#cb162-8" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">value =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb162-9"><a href="programming.html#cb162-9" tabindex="-1"></a>        <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> {{stringvar}},</span>
<span id="cb162-10"><a href="programming.html#cb162-10" tabindex="-1"></a>                    <span class="at">values_from =</span> value,</span>
<span id="cb162-11"><a href="programming.html#cb162-11" tabindex="-1"></a>                    <span class="at">names_prefix =</span> prefix,</span>
<span id="cb162-12"><a href="programming.html#cb162-12" tabindex="-1"></a>                    <span class="at">values_fill =</span> <span class="dv">0</span>) </span>
<span id="cb162-13"><a href="programming.html#cb162-13" tabindex="-1"></a>}</span>
<span id="cb162-14"><a href="programming.html#cb162-14" tabindex="-1"></a></span>
<span id="cb162-15"><a href="programming.html#cb162-15" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/SAFI_clean.csv&quot;</span>), <span class="at">na =</span> <span class="st">&quot;NULL&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb162-16"><a href="programming.html#cb162-16" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">items_owned =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(items_owned),<span class="st">&quot;None&quot;</span>,items_owned)) <span class="sc">%&gt;%</span></span>
<span id="cb162-17"><a href="programming.html#cb162-17" tabindex="-1"></a>    <span class="fu">create_dummies</span>(<span class="at">stringvar =</span> items_owned, <span class="at">prefix =</span> <span class="st">&quot;owns_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb162-18"><a href="programming.html#cb162-18" tabindex="-1"></a>    <span class="fu">create_dummies</span>(months_lack_food,<span class="st">&quot;lack_food_&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 131 Columns: 14
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): village, respondent_wall_type, memb_assoc, affect_conflicts, items...
## dbl  (6): key_ID, no_membrs, years_liv, rooms, liv_count, no_meals
## dttm (1): interview_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 131 × 43
##    key_ID village  interview_date      no_membrs years_liv respondent_wall_type
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;               
##  1      1 God      2016-11-17 00:00:00         3         4 muddaub             
##  2      2 God      2016-11-17 00:00:00         7         9 muddaub             
##  3      3 God      2016-11-17 00:00:00        10        15 burntbricks         
##  4      4 God      2016-11-17 00:00:00         7         6 burntbricks         
##  5      5 God      2016-11-17 00:00:00         7        40 burntbricks         
##  6      6 God      2016-11-17 00:00:00         3         3 muddaub             
##  7      7 God      2016-11-17 00:00:00         6        38 muddaub             
##  8      8 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
##  9      9 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
## 10     10 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
## # ℹ 121 more rows
## # ℹ 37 more variables: rooms &lt;dbl&gt;, memb_assoc &lt;chr&gt;, affect_conflicts &lt;chr&gt;,
## #   liv_count &lt;dbl&gt;, no_meals &lt;dbl&gt;, instanceID &lt;chr&gt;, owns_bicycle &lt;dbl&gt;,
## #   owns_television &lt;dbl&gt;, owns_solar_panel &lt;dbl&gt;, owns_table &lt;dbl&gt;,
## #   owns_cow_cart &lt;dbl&gt;, owns_radio &lt;dbl&gt;, owns_cow_plough &lt;dbl&gt;,
## #   owns_solar_torch &lt;dbl&gt;, owns_mobile_phone &lt;dbl&gt;, owns_motorcyle &lt;dbl&gt;,
## #   owns_None &lt;dbl&gt;, owns_fridge &lt;dbl&gt;, owns_electricity &lt;dbl&gt;, …</code></pre>
<p>The code is now clear, I can update the function in one place and all variables will
be updated accordingly. Plus, if I want to use the same code in another project, I can
easily do it.</p>
</div>
</div>
<div id="map" class="section level2 hasAnchor">
<h2>Map()<a href="programming.html#map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>map()</code> works just like loop, but generally faster. It takes two arguments:</p>
<ul>
<li>An iterable object, like a vector or list</li>
<li>A function</li>
</ul>
<p>It will then apply the function to each element of the object. It will return
a list with the results of each iteration.</p>
<p>For example, to get the the square root for each of the numbers in a vector:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="programming.html#cb165-1" tabindex="-1"></a>vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">16</span>) </span>
<span id="cb165-2"><a href="programming.html#cb165-2" tabindex="-1"></a><span class="fu">map</span>(vector,sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 3
## 
## [[3]]
## [1] 4</code></pre>
<p>You may not quite like the fact that map returns a list, but quite a few things in
R use lists. <code>modelsummary()</code> for example. Suppose I want to regress the same y on
a number of combinations of independent variables, I can put the combination of
varaibles in a list, and then run my model for each element of the list.</p>
<p>I use <code>reformulate()</code> to convert strings into a formula ‘lm()’ can use. Also,
I use <code>~</code> to create
<a href="https://adv-r.hadley.nz/functionals.html#purrr-shortcuts">a purrr-style inline anonymous function</a>
within <code>map()</code>.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="programming.html#cb167-1" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb167-2"><a href="programming.html#cb167-2" tabindex="-1"></a></span>
<span id="cb167-3"><a href="programming.html#cb167-3" tabindex="-1"></a><span class="co"># generate some sample data</span></span>
<span id="cb167-4"><a href="programming.html#cb167-4" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>),<span class="at">x1 =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>),<span class="at">x2 =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>))</span>
<span id="cb167-5"><a href="programming.html#cb167-5" tabindex="-1"></a></span>
<span id="cb167-6"><a href="programming.html#cb167-6" tabindex="-1"></a></span>
<span id="cb167-7"><a href="programming.html#cb167-7" tabindex="-1"></a><span class="co"># define a list of models: </span></span>
<span id="cb167-8"><a href="programming.html#cb167-8" tabindex="-1"></a><span class="co"># the left-hand sides are the labels</span></span>
<span id="cb167-9"><a href="programming.html#cb167-9" tabindex="-1"></a><span class="co"># the right-hand sides the independent variables I will pass to reformulate.</span></span>
<span id="cb167-10"><a href="programming.html#cb167-10" tabindex="-1"></a></span>
<span id="cb167-11"><a href="programming.html#cb167-11" tabindex="-1"></a>models <span class="ot">&lt;-</span></span>
<span id="cb167-12"><a href="programming.html#cb167-12" tabindex="-1"></a><span class="fu">list</span>(<span class="st">&quot;X1 only&quot;</span> <span class="ot">=</span> <span class="st">&quot;x1&quot;</span>, </span>
<span id="cb167-13"><a href="programming.html#cb167-13" tabindex="-1"></a>     <span class="st">&quot;X2 only&quot;</span> <span class="ot">=</span> <span class="st">&quot;x2&quot;</span>, </span>
<span id="cb167-14"><a href="programming.html#cb167-14" tabindex="-1"></a>      <span class="st">&quot;Both&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>))</span>
<span id="cb167-15"><a href="programming.html#cb167-15" tabindex="-1"></a></span>
<span id="cb167-16"><a href="programming.html#cb167-16" tabindex="-1"></a></span>
<span id="cb167-17"><a href="programming.html#cb167-17" tabindex="-1"></a><span class="co"># map() works nicely in  dplyr pipe!</span></span>
<span id="cb167-18"><a href="programming.html#cb167-18" tabindex="-1"></a><span class="co"># the ~ creates a purrr-style anonymous function, where .x is current element of the list</span></span>
<span id="cb167-19"><a href="programming.html#cb167-19" tabindex="-1"></a>models <span class="sc">%&gt;%</span></span>
<span id="cb167-20"><a href="programming.html#cb167-20" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span><span class="fu">lm</span>(<span class="fu">reformulate</span>(.x, <span class="at">response=</span><span class="st">&quot;y&quot;</span>),<span class="at">data =</span> df)) <span class="sc">%&gt;%</span></span>
<span id="cb167-21"><a href="programming.html#cb167-21" tabindex="-1"></a>    <span class="fu">modelsummary</span>(<span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>)</span></code></pre></div>
<div class="tabwid"><style>.cl-08d8b53a{}.cl-08d33ee8{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-08d57898{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-08d58978{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08d58979{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08d58982{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08d5898c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-08d8b53a'><thead><tr style="overflow-wrap:break-word;"><th class="cl-08d58978"><p class="cl-08d57898"><span class="cl-08d33ee8"> </span></p></th><th class="cl-08d58978"><p class="cl-08d57898"><span class="cl-08d33ee8">X1 only</span></p></th><th class="cl-08d58978"><p class="cl-08d57898"><span class="cl-08d33ee8">X2 only</span></p></th><th class="cl-08d58978"><p class="cl-08d57898"><span class="cl-08d33ee8">Both</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(Intercept)</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.105</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.128</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.129</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8"></span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(0.139)</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(0.142)</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(0.143)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">x1</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-0.102</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8"></span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-0.104</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8"></span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(0.157)</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8"></span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(0.158)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">x2</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8"></span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.120</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.122</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8"></span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8"></span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(0.157)</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">(0.158)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58982"><p class="cl-08d57898"><span class="cl-08d33ee8">Num.Obs.</span></p></td><td class="cl-08d58982"><p class="cl-08d57898"><span class="cl-08d33ee8">50</span></p></td><td class="cl-08d58982"><p class="cl-08d57898"><span class="cl-08d33ee8">50</span></p></td><td class="cl-08d58982"><p class="cl-08d57898"><span class="cl-08d33ee8">50</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">R2</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.009</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.012</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.021</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">R2 Adj.</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-0.012</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-0.009</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-0.021</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">AIC</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">143.9</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">143.7</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">145.2</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">BIC</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">149.6</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">149.4</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">152.9</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">Log.Lik.</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-68.937</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-68.854</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">-68.624</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">F</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.420</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.582</span></p></td><td class="cl-08d58979"><p class="cl-08d57898"><span class="cl-08d33ee8">0.504</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08d5898c"><p class="cl-08d57898"><span class="cl-08d33ee8">RMSE</span></p></td><td class="cl-08d5898c"><p class="cl-08d57898"><span class="cl-08d33ee8">0.96</span></p></td><td class="cl-08d5898c"><p class="cl-08d57898"><span class="cl-08d33ee8">0.96</span></p></td><td class="cl-08d5898c"><p class="cl-08d57898"><span class="cl-08d33ee8">0.95</span></p></td></tr></tbody></table></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-exploration.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/kleuveld/r_cheatsheet/edit/main/chapters/06_programming.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
