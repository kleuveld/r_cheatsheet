<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Programming with R | Field guide to reproducible and reusable social science with R:</title>
  <meta name="description" content="This page contains tips to make your R code reproducible." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Programming with R | Field guide to reproducible and reusable social science with R:" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This page contains tips to make your R code reproducible." />
  <meta name="github-repo" content="kleuveld/r_cheatsheet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Programming with R | Field guide to reproducible and reusable social science with R:" />
  
  <meta name="twitter:description" content="This page contains tips to make your R code reproducible." />
  

<meta name="author" content="Koen" />


<meta name="date" content="2026-01-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reproducible-workflows.html"/>
<link rel="next" href="datawrangling.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Cheat Sheet</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i>Setting up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html"><i class="fa fa-check"></i>Reproducible Workflows</a>
<ul>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#projects"><i class="fa fa-check"></i>Projects</a>
<ul>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#here"><i class="fa fa-check"></i>Here</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#using-machine-specific-paths"><i class="fa fa-check"></i>Using machine-specific paths</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#renv"><i class="fa fa-check"></i>renv</a>
<ul>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#starting-a-project-with-renv"><i class="fa fa-check"></i>Starting a project with Renv</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#installing-new-packages-with-renv"><i class="fa fa-check"></i>Installing new packages with Renv</a></li>
<li class="chapter" data-level="" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html#restoring-a-project"><i class="fa fa-check"></i>Restoring a project</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i>Programming with R</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#loops"><i class="fa fa-check"></i>Loops</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#basic-functions"><i class="fa fa-check"></i>Basic Functions</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#functions-and-the-tidyverse"><i class="fa fa-check"></i>Functions and the tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#map"><i class="fa fa-check"></i>Map()</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#making-functions-re-usable-with-box"><i class="fa fa-check"></i>Making functions re-usable with box</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html"><i class="fa fa-check"></i>Data Wrangling</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#the-basic-pattern"><i class="fa fa-check"></i>The basic pattern</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#using-plots-to-identify-data-issues-reproducibly"><i class="fa fa-check"></i>Using plots to identify data issues reproducibly</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#dealing-with-multiple-levels-of-data"><i class="fa fa-check"></i>Dealing with multiple levels of data</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-long-to-wide"><i class="fa fa-check"></i>Pivoting long to wide</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting-wide-to-long"><i class="fa fa-check"></i>Pivoting wide to long</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#joining-or-merging-data"><i class="fa fa-check"></i>Joining (or merging) data</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#summarizing-over-groups-or-collapsing-data"><i class="fa fa-check"></i>Summarizing over groups (or collapsing data)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#editing-many-variables-at-once"><i class="fa fa-check"></i>Editing many variables at once</a>
<ul>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#across-doing-the-same-operations-on-multiple-variables-using-across"><i class="fa fa-check"></i>across(): doing the same operations on multiple variables using across</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#pivoting"><i class="fa fa-check"></i>Pivoting</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#using-many-variables-as-inputs"><i class="fa fa-check"></i>Using many variables as inputs</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#renaming-many-variables"><i class="fa fa-check"></i>Renaming many variables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#seperate_longer"><i class="fa fa-check"></i>Splitting multi-response variable into dummies</a></li>
<li class="chapter" data-level="" data-path="datawrangling.html"><a href="datawrangling.html#cleaning-rmd"><i class="fa fa-check"></i>Structure of a cleaning Rmarkdown doc with multi-level data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i>Estimating and reporting</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#generating-some-fake-data"><i class="fa fa-check"></i>Generating some fake data</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#making-a-table-of-summary-statistics"><i class="fa fa-check"></i>Making a table of summary statistics</a>
<ul>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#using-modelsummary-and-flextable"><i class="fa fa-check"></i>Using modelsummary and flextable</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#balance-table"><i class="fa fa-check"></i>Balance Table</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#advanced-using-only-flextable"><i class="fa fa-check"></i>Advanced: Using only Flextable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#simple-regression"><i class="fa fa-check"></i>Simple regression</a></li>
<li class="chapter" data-level="" data-path="reporting.html"><a href="reporting.html#robust-standard-errors"><i class="fa fa-check"></i>Robust standard errors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i>Plotting using ggplot</a>
<ul>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#introduction-2"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#scatter-plot"><i class="fa fa-check"></i>Scatter plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#boxplot"><i class="fa fa-check"></i>Boxplot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#bar-chart"><i class="fa fa-check"></i>Bar chart</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#labels"><i class="fa fa-check"></i>Labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#faceting"><i class="fa fa-check"></i>Faceting</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#stacked-wur"><i class="fa fa-check"></i>Stacked bar chart with WUR template and observation counts</a>
<ul>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#as-a-re-usable-function"><i class="fa fa-check"></i>As a re-usable function</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#ordering-of-labels"><i class="fa fa-check"></i>Ordering of labels</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#lollipop-plot"><i class="fa fa-check"></i>Lollipop plot</a></li>
<li class="chapter" data-level="" data-path="plotting.html"><a href="plotting.html#maps"><i class="fa fa-check"></i>Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html"><i class="fa fa-check"></i>Power Analysis using DeclareDesign</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#simple-power-calculation"><i class="fa fa-check"></i>Simple Power Calculation</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#loading-data"><i class="fa fa-check"></i>Loading data</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#diagnosing-design-and-calculating-power"><i class="fa fa-check"></i>Diagnosing Design and calculating power</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#dif-in-diff"><i class="fa fa-check"></i>Dif in diff</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#propsensity-score-matching"><i class="fa fa-check"></i>Propsensity score matching</a>
<ul>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#declare-design-1"><i class="fa fa-check"></i>Declare Design</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#checking-balance"><i class="fa fa-check"></i>Checking balance</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#bias"><i class="fa fa-check"></i>Bias</a></li>
<li class="chapter" data-level="" data-path="declaredesign.html"><a href="declaredesign.html#power"><i class="fa fa-check"></i>Power</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Field guide to reproducible and reusable social science with R:</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programming" class="section level1 hasAnchor">
<h1>Programming with R<a href="programming.html#programming" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Before diving into specific R techniques about managing social science research,
first some general programming concepts that will help you make your R code
more reusable.
These techniques help you move away from the specifics of your data,
and make generalizable solutions that you can then reapply to other data sets.
This also prevents mistakes,
where you copy-paste code and fail to make the necessary changes.
But perhaps most importantly, it saves you time: these concepts allow you to do
a lot of work with just a few simple building blocks of code.</p>
<p>This chapter will cover ways to iterate code
(using either loops or the <code>map()</code> function),
functions (which will let you easily reuse code snippets you often need),
and making code more reusable with the <code>box</code> package.</p>
<div id="loops" class="section level2 hasAnchor">
<h2>Loops<a href="programming.html#loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Loops are a fundamental programming concept that allow you to repeat code multiple times without duplicating it. In R, a loop has the following structure:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="programming.html#cb4-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb4-2"><a href="programming.html#cb4-2" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb4-3"><a href="programming.html#cb4-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4</code></pre>
<p>The <code>i</code> is the iterator,
and each iteration of the loop it takes on the value of a different element of
the object that follows the <code>in</code>;
in this case, <code>i</code> takes on 1,2,3 and finally 4 as its values.
Therefore, this code is equivalent to:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="programming.html#cb6-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="programming.html#cb8-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="programming.html#cb10-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="programming.html#cb12-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>But it’s much easier to maintain! Imagine having to do 86 iterations: you would
need to copy paste the code 85 times every time you want to update something.
Using loops, you don’t need to copy-paste a thing, leading to fewer errors.</p>
<p>While loops can be a perfectly fine way of doing repeated work, most R
programmers prefer not to use loops, but instead use functions such as
<code>lapply()</code> and <code>map()</code>.
However, for this you will need to know how to write functions.</p>
</div>
<div id="functions" class="section level2 hasAnchor">
<h2>Functions<a href="programming.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="basic-functions" class="section level3 hasAnchor">
<h3>Basic Functions<a href="programming.html#basic-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A function is an R object that’s essentially a shortcut to run a bit of code.
Usually, a function takes an argument (the input), and returns an output. The
argument is always provided within parentheses. The <code>sqrt()</code> function, for
example, takes a number as its argument and returns the square root of that number.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="programming.html#cb14-1" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>The beauty of functions is that they allow you to define a set of operations in
one place, and re-use it as often as you want. If you then need to update the
operations, all you need to do is update the function, instead of hunting down
every instance of the operations throughout your script.</p>
<p>Take for example the following code that cleans missing data.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="programming.html#cb16-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># needed for if_else()</span></span>
<span id="cb16-2"><a href="programming.html#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="programming.html#cb16-3" tabindex="-1"></a><span class="co">#define an example variable</span></span>
<span id="cb16-4"><a href="programming.html#cb16-4" tabindex="-1"></a>variable1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="sc">-</span><span class="dv">99</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-5"><a href="programming.html#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="programming.html#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="programming.html#cb16-7" tabindex="-1"></a><span class="co">#change missing</span></span>
<span id="cb16-8"><a href="programming.html#cb16-8" tabindex="-1"></a>variable1_cleaned <span class="ot">=</span> <span class="fu">if_else</span>(variable1 <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>, <span class="cn">NA</span>,variable1)</span>
<span id="cb16-9"><a href="programming.html#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="programming.html#cb16-10" tabindex="-1"></a>variable1_cleaned </span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  5  6</code></pre>
<p>This works, but I need to do this at many different places in my code, and when
copying the code to other places, it’s easy to make small mistakes.
Moreover, if
I notice my procedure for cleaning missing data is wrong, I will have to hunt
down all the places I’ve copied this code to, and change it (which, again, is
an error prone process).</p>
<p>A common piece of advice is to put any code that you
have to copy-paste more than twice in a function. Once I do that, I can just
call the function wherever I need to clean data; if I want to change how I deal
with missings, I now only have to make changes in one place:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="programming.html#cb18-1" tabindex="-1"></a>clean_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data) {</span>
<span id="cb18-2"><a href="programming.html#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="programming.html#cb18-3" tabindex="-1"></a>  returned_data <span class="ot">&lt;-</span> <span class="fu">if_else</span>(input_data <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>, <span class="cn">NA</span>, input_data)</span>
<span id="cb18-4"><a href="programming.html#cb18-4" tabindex="-1"></a>  </span>
<span id="cb18-5"><a href="programming.html#cb18-5" tabindex="-1"></a>  <span class="fu">return</span>(returned_data)</span>
<span id="cb18-6"><a href="programming.html#cb18-6" tabindex="-1"></a>}</span></code></pre></div>
<p>I’ve pretty much copied the code I had above. Note that I could have used any
name for my argument (defined in the parentheses after function); I just thought
<code>input_data</code> made sense. I use the <code>return()</code> function to return data.</p>
<p>I can now just use the <code>clean_data()</code> wherever I want:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="programming.html#cb19-1" tabindex="-1"></a>variable1_cleaned <span class="ot">&lt;-</span> <span class="fu">clean_missing</span>(variable1)</span>
<span id="cb19-2"><a href="programming.html#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="programming.html#cb19-3" tabindex="-1"></a>variable1_cleaned</span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  5  6</code></pre>
<p>Note that any variables we created in the function are kept within the function,
and you can’t access them later:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="programming.html#cb21-1" tabindex="-1"></a>variable1_clean <span class="ot">&lt;-</span> <span class="fu">clean_missing</span>(variable1)</span>
<span id="cb21-2"><a href="programming.html#cb21-2" tabindex="-1"></a>returned_data</span></code></pre></div>
<pre><code>## Error: object &#39;returned_data&#39; not found</code></pre>
<p>This keeps your working environment nice and clean, which again prevents
problems.</p>
<p>Above I used the return function. This is not needed. Anything on the
last line of the function that would normally be returned to the console, is
used a return value of the function:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="programming.html#cb23-1" tabindex="-1"></a>clean_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data) {</span>
<span id="cb23-2"><a href="programming.html#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="programming.html#cb23-3" tabindex="-1"></a>  <span class="fu">if_else</span>(input_data <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>, <span class="cn">NA</span>, input_data)</span>
<span id="cb23-4"><a href="programming.html#cb23-4" tabindex="-1"></a>  </span>
<span id="cb23-5"><a href="programming.html#cb23-5" tabindex="-1"></a>}</span>
<span id="cb23-6"><a href="programming.html#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="programming.html#cb23-7" tabindex="-1"></a><span class="fu">clean_missing</span>(variable1)</span></code></pre></div>
<pre><code>## [1]  1  2  3 NA  5  6</code></pre>
</div>
<div id="functions-and-the-tidyverse" class="section level3 hasAnchor">
<h3>Functions and the tidyverse<a href="programming.html#functions-and-the-tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the previous function I passed a vector to clean, what if want to use it
in a data cleaning pipe?</p>
<p>It’s useful to start with the code without a function, and then to generalize
from there:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="programming.html#cb25-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb25-2"><a href="programming.html#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="programming.html#cb25-3" tabindex="-1"></a>data_frame <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">variable1 =</span> variable1)</span>
<span id="cb25-4"><a href="programming.html#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="programming.html#cb25-5" tabindex="-1"></a>data_frame <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="programming.html#cb25-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable1 =</span> <span class="fu">if_else</span>(variable1 <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,<span class="cn">NA</span>,variable1))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   variable1
##       &lt;dbl&gt;
## 1         1
## 2         2
## 3         3
## 4        NA
## 5         5
## 6         6</code></pre>
<p>Let’s try to put that in a function. The function will need to take
a data frame and a variable name as its arguments. Results from one step in the
pipe, are passed as the first argument for the next step. So make sure the data
is the first argument!</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="programming.html#cb27-1" tabindex="-1"></a>clean_missing_df <span class="ot">&lt;-</span> <span class="cf">function</span>(input_dataframe, variablename){</span>
<span id="cb27-2"><a href="programming.html#cb27-2" tabindex="-1"></a>  input_dataframe <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="programming.html#cb27-3" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">variablename =</span> <span class="fu">if_else</span>(variablename <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,<span class="cn">NA</span>, variablename))</span>
<span id="cb27-4"><a href="programming.html#cb27-4" tabindex="-1"></a>  </span>
<span id="cb27-5"><a href="programming.html#cb27-5" tabindex="-1"></a>}</span>
<span id="cb27-6"><a href="programming.html#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="programming.html#cb27-7" tabindex="-1"></a>data_frame <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="programming.html#cb27-8" tabindex="-1"></a>  <span class="fu">clean_missing_df</span>(variable1)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   variable1 variablename
##       &lt;dbl&gt;        &lt;dbl&gt;
## 1         1            1
## 2         2            2
## 3         3            3
## 4       -99           NA
## 5         5            5
## 6         6            6</code></pre>
<p>Wait, something went wrong! R just created a new variable called “variablename”.
For a technical note on why this is, see
<a href="https://dplyr.tidyverse.org/articles/programming.html">here</a>. In short, we want
R too look what’s <em>in</em> <code>variablename</code>, not just use it as is. To do so, wrap the
variable name in your function definition
in <code>{{</code> and <code>}}</code>, and change the <code>=</code> in <code>mutatate</code> to <code>:=</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="programming.html#cb29-1" tabindex="-1"></a>clean_missing_df <span class="ot">&lt;-</span> <span class="cf">function</span>(input_dataframe, variablename){</span>
<span id="cb29-2"><a href="programming.html#cb29-2" tabindex="-1"></a>    input_dataframe <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="programming.html#cb29-3" tabindex="-1"></a>    <span class="fu">mutate</span>({{ variablename }} <span class="sc">:=</span> <span class="fu">if_else</span>({{ variablename }} <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>,</span>
<span id="cb29-4"><a href="programming.html#cb29-4" tabindex="-1"></a>                                         <span class="cn">NA</span>,</span>
<span id="cb29-5"><a href="programming.html#cb29-5" tabindex="-1"></a>                                         {{ variablename }}))</span>
<span id="cb29-6"><a href="programming.html#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="programming.html#cb29-7" tabindex="-1"></a>}</span>
<span id="cb29-8"><a href="programming.html#cb29-8" tabindex="-1"></a></span>
<span id="cb29-9"><a href="programming.html#cb29-9" tabindex="-1"></a>data_frame <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="programming.html#cb29-10" tabindex="-1"></a>  <span class="fu">clean_missing_df</span>(variable1)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   variable1
##       &lt;dbl&gt;
## 1         1
## 2         2
## 3         3
## 4        NA
## 5         5
## 6         6</code></pre>
</div>
</div>
<div id="map" class="section level2 hasAnchor">
<h2>Map()<a href="programming.html#map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>map()</code> works just like loop, but generally faster. It takes two arguments:</p>
<ul>
<li>An iterable object, like a vector or list</li>
<li>A function</li>
</ul>
<p>It will then apply the function to each element of the object. It will return
a list with the results of each iteration.</p>
<p>For example, to get the the square root for each of the numbers in a vector:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="programming.html#cb31-1" tabindex="-1"></a>vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">16</span>) </span>
<span id="cb31-2"><a href="programming.html#cb31-2" tabindex="-1"></a><span class="fu">map</span>(vector,sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 3
## 
## [[3]]
## [1] 4</code></pre>
<p>You may not quite like the fact that map returns a list, but quite a few things in
R use lists. <code>modelsummary()</code> for example. Suppose I want to regress the same y on
a number of combinations of independent variables, I can put the combination of
varaibles in a list, and then run my model for each element of the list.</p>
<p>I use <code>reformulate()</code> to convert strings into a formula ‘lm()’ can use. Also,
I use <code>~</code> to create
<a href="https://adv-r.hadley.nz/functionals.html#purrr-shortcuts">a purrr-style inline anonymous function</a>
within <code>map()</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="programming.html#cb33-1" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb33-2"><a href="programming.html#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="programming.html#cb33-3" tabindex="-1"></a><span class="co"># generate some sample data</span></span>
<span id="cb33-4"><a href="programming.html#cb33-4" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>),<span class="at">x1 =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>),<span class="at">x2 =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>))</span>
<span id="cb33-5"><a href="programming.html#cb33-5" tabindex="-1"></a></span>
<span id="cb33-6"><a href="programming.html#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="programming.html#cb33-7" tabindex="-1"></a><span class="co"># define a list of models: </span></span>
<span id="cb33-8"><a href="programming.html#cb33-8" tabindex="-1"></a><span class="co"># the left-hand sides are the labels</span></span>
<span id="cb33-9"><a href="programming.html#cb33-9" tabindex="-1"></a><span class="co"># the right-hand sides the independent variables I will pass to reformulate.</span></span>
<span id="cb33-10"><a href="programming.html#cb33-10" tabindex="-1"></a></span>
<span id="cb33-11"><a href="programming.html#cb33-11" tabindex="-1"></a>models <span class="ot">&lt;-</span></span>
<span id="cb33-12"><a href="programming.html#cb33-12" tabindex="-1"></a><span class="fu">list</span>(<span class="st">&quot;X1 only&quot;</span> <span class="ot">=</span> <span class="st">&quot;x1&quot;</span>, </span>
<span id="cb33-13"><a href="programming.html#cb33-13" tabindex="-1"></a>   <span class="st">&quot;X2 only&quot;</span> <span class="ot">=</span> <span class="st">&quot;x2&quot;</span>, </span>
<span id="cb33-14"><a href="programming.html#cb33-14" tabindex="-1"></a>    <span class="st">&quot;Both&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>))</span>
<span id="cb33-15"><a href="programming.html#cb33-15" tabindex="-1"></a></span>
<span id="cb33-16"><a href="programming.html#cb33-16" tabindex="-1"></a></span>
<span id="cb33-17"><a href="programming.html#cb33-17" tabindex="-1"></a><span class="co"># map() works nicely in  dplyr pipe!</span></span>
<span id="cb33-18"><a href="programming.html#cb33-18" tabindex="-1"></a><span class="co"># the ~ creates a purrr-style anonymous function, where .x is current element of the list</span></span>
<span id="cb33-19"><a href="programming.html#cb33-19" tabindex="-1"></a>models <span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="programming.html#cb33-20" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">lm</span>(<span class="fu">reformulate</span>(.x, <span class="at">response=</span><span class="st">&quot;y&quot;</span>),<span class="at">data =</span> df)) <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="programming.html#cb33-21" tabindex="-1"></a>  <span class="fu">modelsummary</span>(<span class="at">output =</span> <span class="st">&quot;flextable&quot;</span>)</span></code></pre></div>
<div class="tabwid"><style>.cl-3a953c30{}.cl-3a8e01a4{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-3a90c43e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3a90e216{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3a90e220{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3a90e221{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3a90e222{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-3a953c30'><thead><tr style="overflow-wrap:break-word;"><th class="cl-3a90e216"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"> </span></p></th><th class="cl-3a90e216"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">X1 only</span></p></th><th class="cl-3a90e216"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">X2 only</span></p></th><th class="cl-3a90e216"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">Both</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(Intercept)</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.206</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.191</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.211</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"></span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(0.163)</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(0.154)</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(0.163)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">x1</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.067</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"></span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.069</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"></span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(0.167)</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"></span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(0.167)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">x2</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"></span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.151</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.152</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"></span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4"></span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(0.162)</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">(0.163)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e221"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">Num.Obs.</span></p></td><td class="cl-3a90e221"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">50</span></p></td><td class="cl-3a90e221"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">50</span></p></td><td class="cl-3a90e221"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">50</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">R2</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.003</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.018</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.021</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">R2 Adj.</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.017</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.003</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-0.020</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">AIC</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">155.3</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">154.6</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">156.4</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">BIC</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">161.0</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">160.3</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">164.0</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">Log.Lik.</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-74.640</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-74.276</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">-74.185</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">F</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.163</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.868</span></p></td><td class="cl-3a90e220"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">0.512</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-3a90e222"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">RMSE</span></p></td><td class="cl-3a90e222"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">1.08</span></p></td><td class="cl-3a90e222"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">1.07</span></p></td><td class="cl-3a90e222"><p class="cl-3a90c43e"><span class="cl-3a8e01a4">1.07</span></p></td></tr></tbody></table></div>
</div>
<div id="making-functions-re-usable-with-box" class="section level2 hasAnchor">
<h2>Making functions re-usable with box<a href="programming.html#making-functions-re-usable-with-box" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that you have a bunch of functions,
it’s a good idea to make them re-usable across projects.
The <a href="https://box.r-lib.org/">box package</a> makes this easy.</p>
<p>You define your functions in a script, say <code>box_modules/functions.R</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="programming.html#cb34-1" tabindex="-1"></a>prop_miss <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">na.rm =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb34-2"><a href="programming.html#cb34-2" tabindex="-1"></a>  box<span class="sc">::</span><span class="fu">use</span>(r<span class="sc">/</span>core[...])  </span>
<span id="cb34-3"><a href="programming.html#cb34-3" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">is.na</span>(x))</span>
<span id="cb34-4"><a href="programming.html#cb34-4" tabindex="-1"></a>}</span></code></pre></div>
<p>This is just a function that returns the proportion of missing values in a vector.
<code>box::use(r/core[...])</code> loads all functions from the core package,
so you can use them in your function (box modules don’t load anything you don’t tell them to).<br />
You can then use this function in any project loading the entire script:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="programming.html#cb35-1" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">use</span>(.<span class="sc">/</span>box_modules<span class="sc">/</span>functions)</span></code></pre></div>
<p>This looks in the folder where your script is located for a folder called box_modules,
and loads all functions in the functions.R script.</p>
<p>You can run the function by:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="programming.html#cb36-1" tabindex="-1"></a>functions<span class="sc">$</span><span class="fu">prop_miss</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="cn">NA</span>,<span class="dv">4</span>))</span></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
<p>Box even allows you to load packages:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="programming.html#cb38-1" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">use</span>(dplyr)</span>
<span id="cb38-2"><a href="programming.html#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="programming.html#cb38-3" tabindex="-1"></a></span>
<span id="cb38-4"><a href="programming.html#cb38-4" tabindex="-1"></a>dplyr<span class="sc">$</span>starwars <span class="sc">|&gt;</span></span>
<span id="cb38-5"><a href="programming.html#cb38-5" tabindex="-1"></a>  dplyr<span class="sc">$</span><span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">&quot;Droid&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name   height  mass hair_color skin_color  eye_color birth_year sex   gender  
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   
## 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow           112 none  masculi…
## 2 R2-D2      96    32 &lt;NA&gt;       white, blue red               33 none  masculi…
## 3 R5-D4      97    32 &lt;NA&gt;       white, red  red               NA none  masculi…
## 4 IG-88     200   140 none       metal       red               15 none  masculi…
## 5 R4-P17     96    NA none       silver, red red, blue         NA none  feminine
## 6 BB8        NA    NA none       none        black             NA none  masculi…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>In fact, when writing your own box modules,
this is the only way to load packages (hence thr <code>box::use(r/core[...]</code> in the function above).
Note that you have to use the <code>$</code> operator to access functions and data
from the package or module you loaded.
If you dont want that you can also attach specific functions:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="programming.html#cb40-1" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">use</span>(dplyr[filter, <span class="st">`</span><span class="at">%&gt;%</span><span class="st">`</span>])</span>
<span id="cb40-2"><a href="programming.html#cb40-2" tabindex="-1"></a></span>
<span id="cb40-3"><a href="programming.html#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="programming.html#cb40-4" tabindex="-1"></a>dplyr<span class="sc">$</span>starwars <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="programming.html#cb40-5" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">&quot;Droid&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name   height  mass hair_color skin_color  eye_color birth_year sex   gender  
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   
## 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow           112 none  masculi…
## 2 R2-D2      96    32 &lt;NA&gt;       white, blue red               33 none  masculi…
## 3 R5-D4      97    32 &lt;NA&gt;       white, red  red               NA none  masculi…
## 4 IG-88     200   140 none       metal       red               15 none  masculi…
## 5 R4-P17     96    NA none       silver, red red, blue         NA none  feminine
## 6 BB8        NA    NA none       none        black             NA none  masculi…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Or just attach everything just like you would with <code>library()</code>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="programming.html#cb42-1" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">use</span>(dplyr[...])</span>
<span id="cb42-2"><a href="programming.html#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="programming.html#cb42-3" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="programming.html#cb42-4" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">&quot;Droid&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name   height  mass hair_color skin_color  eye_color birth_year sex   gender  
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   
## 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow           112 none  masculi…
## 2 R2-D2      96    32 &lt;NA&gt;       white, blue red               33 none  masculi…
## 3 R5-D4      97    32 &lt;NA&gt;       white, red  red               NA none  masculi…
## 4 IG-88     200   140 none       metal       red               15 none  masculi…
## 5 R4-P17     96    NA none       silver, red red, blue         NA none  feminine
## 6 BB8        NA    NA none       none        black             NA none  masculi…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Alright, let’s unload our own function, so we can load it in another way, using:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="programming.html#cb44-1" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">unload</span>(functions)</span></code></pre></div>
<p>Alternatively, you can specify a search path,
where <code>box</code> will look for modules.
I will put my box modules in <code>C:/Users/koen/documents/box_modules</code>.</p>
<p>The following code will allow box to look in that folder for modules:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="programming.html#cb45-1" tabindex="-1"></a><span class="fu">options</span>(<span class="st">&#39;box.path&#39;</span> <span class="ot">=</span> <span class="st">&quot;C:/Users/koen/documents/&quot;</span>) <span class="co"># &lt;-- the parent folder!!</span></span></code></pre></div>
<p>Note that I have used the parent folder of box_modules,
because for whatever reason you have to do that
(the .R files need to be in a subfolder).
By adding this to your <code>[.Rprofile](https://docs.posit.co/ide/user/ide/guide/environments/r/managing-r.html)</code> file,
it will be run any time you open R.</p>
<p>Now I can just use the following code in any project to access my functions:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="programming.html#cb46-1" tabindex="-1"></a>box<span class="sc">::</span><span class="fu">use</span>(box_modules<span class="sc">/</span>functions)</span>
<span id="cb46-2"><a href="programming.html#cb46-2" tabindex="-1"></a></span>
<span id="cb46-3"><a href="programming.html#cb46-3" tabindex="-1"></a>functions<span class="sc">$</span><span class="fu">prop_miss</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="cn">NA</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="cn">NA</span>))</span></code></pre></div>
<pre><code>## [1] 0.3333333</code></pre>
<p>Of course you are no longer working project-oriented:
your box modules aren’t in your project folder!</p>
<p>If you want to use box modules within your project folder,
best to add the root folder as search path:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="programming.html#cb48-1" tabindex="-1"></a><span class="fu">options</span>(<span class="st">&#39;box.path&#39;</span> <span class="ot">=</span> h <span class="fu">c</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="fu">getOption</span>(<span class="st">&#39;box.path&#39;</span>))</span></code></pre></div>
<p>The function <code>getOption('box.path')</code> gets your current box search path,
and <code>c()</code> combines it with your project root folder returned by <code>here()</code>.</p>
<p>One way I like to organize my box modules
is to have them in a git repository
and use it as a <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">submodule</a> in my projects.
That way you can have a specific version or branch of all your box modules in every
project.
You can also merge changes you make to you box modules of one project,
back to all your other active projects.
It’s fantastic, but a bit finnicky to set up.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reproducible-workflows.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="datawrangling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": false,
    "twitter": false,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/kleuveld/r_cheatsheet/edit/main/chapters/02-programming.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "none"
  }
});
});
</script>

</body>

</html>
